<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Attendance Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 30px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #f2f2f2; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>Attendance Dashboard</h1>

  <div id="attendanceSection">
    <h2>Attendance</h2>
    <div id="attendance"></div>
  </div>

  <div id="holidaysSection">
    <h2>Holidays</h2>
    <div id="holidays"></div>
  </div>

  <div id="leavesSection">
    <h2>Leaves</h2>
    <div id="leaves"></div>
  </div>

  <div id="balancesSection">
    <h2>Balances</h2>
    <div id="balances"></div>
  </div>

  <div id="settingsSection">
    <h2>Settings</h2>
    <div id="settings"></div>
  </div>

  <script>
    const API_BASE = "https://script.google.com/macros/s/AKfycbwyjG0ZS22iohHqM8N78KELf8xWYM2ARBdcGN-vn448eewSbuCSYoyI4MC3adEDcSiVkA/exec";

    async function fetchData(sheet) {
      try {
        const res = await fetch(`${API_BASE}?sheet=${sheet}`);
        const json = await res.json();
        console.log(`${sheet} API Response`, json);
        if (!json.ok) throw new Error(json.error);
        return json;
      } catch (err) {
        console.error(`Error loading ${sheet}:`, err);
        return { ok: false, error: err.message };
      }
    }

    function renderTable(sheet, data) {
      if (!data || data.length === 0) return "<p>No data available</p>";
      let headers = Object.keys(data[0]);
      let html = "<table><thead><tr>";
      headers.forEach(h => html += `<th>${h}</th>`);
      html += "</tr></thead><tbody>";
      data.forEach(row => {
        html += "<tr>";
        headers.forEach(h => html += `<td>${row[h] ?? ""}</td>`);
        html += "</tr>";
      });
      html += "</tbody></table>";
      return html;
    }

    async function loadData() {
      const [attendance, holidays, leaves, balances, settings] = await Promise.all([
        fetchData("attendance"),  // âœ… FIXED name
        fetchData("holidays"),
        fetchData("leaves"),
        fetchData("balances"),
        fetchData("settings")
      ]);

      document.getElementById("attendance").innerHTML =
        attendance.ok ? renderTable("attendance", attendance.data) : `<p class="error">${attendance.error}</p>`;

      document.getElementById("holidays").innerHTML =
        holidays.ok ? renderTable("holidays", holidays.data) : `<p class="error">${holidays.error}</p>`;

      document.getElementById("leaves").innerHTML =
        leaves.ok ? renderTable("leaves", leaves.data) : `<p class="error">${leaves.error}</p>`;

      document.getElementById("balances").innerHTML =
        balances.ok ? renderTable("balances", balances.data) : `<p class="error">${balances.error}</p>`;

      document.getElementById("settings").innerHTML =
        settings.ok ? renderTable("settings", settings.data) : `<p class="error">${settings.error}</p>`;
    }

    loadData();
  </script>
</body>
</html>
