<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>InCheck Pro ‚Äì Issues ¬∑ Ops ¬∑ AI Copilot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />

  <!-- FullCalendar CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" />

  <!-- Fonts (optional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">IC</div>
      <div class="brand-text">
        <span>InCheck Pro</span>
        <span>Issues ¬∑ Ops ¬∑ AI Copilot</span>
      </div>
    </div>

    <button id="drawerBtn" class="btn ghost sm drawer-toggle" aria-label="Toggle filters" aria-expanded="false">
      <span class="icon">‚ò∞</span>
      Filters
    </button>

    <div class="toolbar">
      <div class="statusline">
        <span class="dot ok" id="syncIssuesDot"></span>
        <span class="chip" id="syncIssuesText">Issues: never</span>

        <span class="dot ok" id="syncEventsDot"></span>
        <span class="chip" id="syncEventsText">Events: never</span>

        <span class="chip" id="loadingStatus"></span>
        <span class="chip online" id="onlineStatusChip">Online</span>
      </div>

      <button type="button" class="btn sm" id="refreshNow">
        <span class="icon">‚ü≥</span> Refresh
      </button>

      <button type="button" class="btn ghost sm" id="exportCsv">
        <span class="icon">‚á©</span> Export CSV
      </button>

      <button type="button" class="btn primary sm" id="createTicketBtn">
        <span class="icon">Ôºã</span> New Ticket
      </button>

      <select id="themeSelect" class="select sm" aria-label="Theme">
        <option value="system">System</option>
        <option value="dark">Dark</option>
        <option value="light">Light</option>
      </select>

      <input type="color" id="accentColor" aria-label="Accent color" />

      <button type="button" class="btn ghost sm" id="shortcutsHelp">
        ‚å®
      </button>
    </div>
  </header>

  <main class="wrap">
    <!-- Sidebar / Filters -->
    <aside class="sidebar" id="sidebar" aria-label="Filters and summary">
      <h3>Filters</h3>

      <div class="filter-group">
        <div class="filter-row">
          <label class="muted" for="searchInput">Search</label>
          <input
            id="searchInput"
            class="input"
            type="search"
            placeholder="Search ID, title, module, log..."
          />
        </div>

        <div class="filter-row">
          <label class="muted" for="moduleFilter">Module</label>
          <select id="moduleFilter" class="select">
            <option>All</option>
          </select>
        </div>

        <div class="filter-row">
          <label class="muted" for="priorityFilter">Priority</label>
          <select id="priorityFilter" class="select">
            <option>All</option>
          </select>
        </div>

        <div class="filter-row">
          <label class="muted" for="statusFilter">Status</label>
          <select id="statusFilter" class="select">
            <option>All</option>
          </select>
        </div>

        <div class="filter-row">
          <label class="muted" for="startDateFilter">From date</label>
          <input id="startDateFilter" class="input" type="date" />
        </div>

        <div class="filter-row">
          <label class="muted" for="endDateFilter">To date</label>
          <input id="endDateFilter" class="input" type="date" />
        </div>

        <button type="button" class="btn sm" id="resetBtn">
          Reset filters
        </button>
      </div>

      <div class="divider"></div>

      <h3>Summary</h3>
      <div class="muted" id="issuesSummaryText">
        Loading‚Ä¶
      </div>

      <div style="margin-top:8px;">
        <div class="muted" style="font-size:11px;margin-bottom:4px;">Active filters</div>
        <div id="activeFiltersChips" class="filter-chips">
          <span class="muted" style="font-size:11px;">No filters applied.</span>
        </div>
      </div>
    </aside>

    <!-- Main content -->
    <section class="content">
      <!-- Tabs -->
      <div class="view-tabs" role="tablist">
        <button
          type="button"
          id="issuesTab"
          class="view-tab active"
          role="tab"
          aria-selected="true"
          data-view="issues"
        >
          <span class="icon">üìã</span> Issues
        </button>
        <button
          type="button"
          id="calendarTab"
          class="view-tab"
          role="tab"
          aria-selected="false"
          data-view="calendar"
        >
          <span class="icon">üìÖ</span> Calendar
        </button>
        <button
          type="button"
          id="insightsTab"
          class="view-tab"
          role="tab"
          aria-selected="false"
          data-view="insights"
        >
          <span class="icon">ü§ñ</span> AI &amp; Ops
        </button>
      </div>

      <!-- ISSUES VIEW -->
      <section id="issuesView" class="view active" aria-label="Issues view">
        <!-- KPIs -->
        <div class="grid cols-4" id="kpis"></div>

        <!-- Summary bar -->
        <div class="card summary-bar">
          <div id="rowCount" class="muted">No rows</div>
          <div class="shortcut-chip">
            Shortcuts: 1/2/3 switch tabs ¬∑ ‚Äú/‚Äù focus search ¬∑ Ctrl+K AI query
          </div>
        </div>

        <!-- Charts -->
        <div class="charts">
          <div class="card">
            <strong>By Module</strong>
            <div style="height:220px;margin-top:8px;">
              <canvas id="byModule"></canvas>
            </div>
          </div>
          <div class="card">
            <strong>By Priority</strong>
            <div style="height:220px;margin-top:8px;">
              <canvas id="byPriority"></canvas>
            </div>
          </div>
          <div class="card">
            <strong>By Status</strong>
            <div style="height:220px;margin-top:8px;">
              <canvas id="byStatus"></canvas>
            </div>
          </div>
          <div class="card">
            <strong>By Type</strong>
            <div style="height:220px;margin-top:8px;">
              <canvas id="byType"></canvas>
            </div>
          </div>
        </div>

        <!-- Table -->
        <div class="card">
          <div class="table-wrap">
            <table id="issuesTable" aria-label="Issues table">
              <thead>
                <tr>
                  <th class="sortable" data-key="id">ID</th>
                  <th class="sortable" data-key="module">Module</th>
                  <th class="sortable" data-key="title">Title</th>
                  <th class="sortable" data-key="priority">Priority</th>
                  <th class="sortable" data-key="status">Status</th>
                  <th class="sortable" data-key="date">Date</th>
                  <th>Log</th>
                  <th>Link</th>
                </tr>
              </thead>
              <tbody id="tbodySkeleton">
                <!-- skeleton rows -->
                <tr>
                  <td colspan="8">
                    <div class="skeleton" style="height:16px;margin:4px 0;"></div>
                    <div class="skeleton" style="height:16px;margin:4px 0;"></div>
                    <div class="skeleton" style="height:16px;margin:4px 0;"></div>
                  </td>
                </tr>
              </tbody>
              <tbody id="issuesTbody"></tbody>
            </table>
          </div>

          <!-- Pagination / page size -->
          <div class="table-actions">
            <div>
              <label class="muted" for="pageSize">Rows per page:</label>
              <select id="pageSize" class="select sm">
                <option value="10">10</option>
                <option value="20" selected>20</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
            </div>
            <div class="pagination">
              <button type="button" class="chip-btn" id="firstPage">¬´ First</button>
              <button type="button" class="chip-btn" id="prevPage">‚Äπ Prev</button>
              <span id="pageInfo" class="muted">Page 1 / 1</span>
              <button type="button" class="chip-btn" id="nextPage">Next ‚Ä∫</button>
              <button type="button" class="chip-btn" id="lastPage">Last ¬ª</button>
            </div>
          </div>
        </div>
      </section>

      <!-- CALENDAR VIEW -->
      <section id="calendarView" class="view" aria-label="Calendar view">
        <div class="card">
          <div class="summary-bar">
            <div>
              <strong>Change Calendar</strong>
              <div id="calendarTz" class="muted" style="margin-top:4px;"></div>
            </div>
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
              <label class="chip">
                <input type="checkbox" id="eventFilterDeployment" checked /> Deployment
              </label>
              <label class="chip">
                <input type="checkbox" id="eventFilterMaintenance" checked /> Maintenance
              </label>
              <label class="chip">
                <input type="checkbox" id="eventFilterRelease" checked /> Release
              </label>
              <label class="chip">
                <input type="checkbox" id="eventFilterOther" checked /> Other
              </label>
              <button type="button" class="btn sm" id="addEventBtn">
                <span class="icon">Ôºã</span> Add event
              </button>
            </div>
          </div>
          <div id="calendar"></div>
        </div>
      </section>

      <!-- INSIGHTS / AI VIEW -->
      <section id="insightsView" class="view" aria-label="Insights and AI">
        <div class="grid cols-4">
          <!-- AI overview -->
          <div class="card">
            <strong>AI Overview</strong>
            <p class="muted" id="aiScopeText" style="margin-top:6px;">No data yet.</p>
            <p class="muted" id="aiSignalsText" style="margin-top:4px;">No strong signals yet.</p>
            <div id="aiAnalyzing" class="chip" style="margin-top:8px;display:none;">
              Analyzing‚Ä¶
            </div>
          </div>

          <!-- Patterns & labels -->
          <div class="card">
            <strong>Patterns (recent)</strong>
            <ul id="aiPatternsList" class="muted" style="margin-top:8px;padding-left:18px;">
              <li>No data yet.</li>
            </ul>
          </div>

          <div class="card">
            <strong>Suggested labels</strong>
            <ul id="aiLabelsList" class="muted" style="margin-top:8px;padding-left:18px;">
              <li>No data yet.</li>
            </ul>
          </div>

          <!-- Trends -->
          <div class="card">
            <strong>Trends</strong>
            <ul id="aiTrendsList" class="muted" style="margin-top:8px;padding-left:18px;">
              <li>No data yet.</li>
            </ul>
          </div>

          <!-- Per-module risk table -->
          <div class="card" id="aiModulesCard">
            <strong>Module risk (last 30d)</strong>
            <div class="table-wrap" style="margin-top:8px;">
              <table>
                <thead>
                  <tr>
                    <th>Module</th>
                    <th>Open</th>
                    <th>High</th>
                    <th>Risk sum</th>
                    <th>Top term</th>
                  </tr>
                </thead>
                <tbody id="aiModulesTableBody">
                  <tr>
                    <td colspan="5" style="text-align:center;color:var(--muted);">
                      No modules.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Top risks -->
          <div class="card">
            <strong>Top risks (recent)</strong>
            <ul id="aiRisksList" class="muted" style="margin-top:8px;padding-left:18px;">
              <li>No data yet.</li>
            </ul>
          </div>

          <!-- Clusters -->
          <div class="card">
            <strong>Similar issues (clusters)</strong>
            <div id="aiClusters" style="margin-top:8px;">
              <div class="muted">No similar issue groups ‚â•2.</div>
            </div>
          </div>

          <!-- Triage -->
          <div class="card">
            <strong>Triage queue (missing / misaligned)</strong>
            <ul id="aiTriageList" class="muted" style="margin-top:8px;padding-left:18px;">
              <li>No data yet.</li>
            </ul>
          </div>

          <!-- Event risk -->
          <div class="card">
            <strong>Upcoming change risk (next 7d)</strong>
            <ul id="aiEventsList" class="muted" style="margin-top:8px;padding-left:18px;">
              <li>No data yet.</li>
            </ul>
          </div>

          <!-- Incidents + emerging vs stable -->
          <div class="card">
            <strong>Incidents &amp; stability</strong>
            <div>
              <div class="muted" style="margin-top:6px;">Incident-like issues</div>
              <ul id="aiIncidentsList" class="muted" style="margin-top:4px;padding-left:18px;">
                <li>No data yet.</li>
              </ul>
            </div>
            <div>
              <div class="muted" style="margin-top:6px;">Emerging vs stable signals</div>
              <ul id="aiEmergingStable" class="muted" style="margin-top:4px;padding-left:18px;">
                <li>Emerging: ‚Äî</li>
                <li>Stable: ‚Äî</li>
              </ul>
            </div>
          </div>

          <!-- Ops cockpit -->
          <div class="card">
            <strong>Ops cockpit</strong>
            <ul id="aiOpsCockpit" class="muted" style="margin-top:8px;padding-left:18px;">
              <li>No ops signals yet.</li>
            </ul>
          </div>

          <!-- AI Query -->
          <div class="card">
            <strong>AI DSL query</strong>
            <p class="muted" style="margin-top:6px;font-size:12px;">
              Example: <code>status:open module:payments risk>=9 last:7d sort:risk</code>
            </p>
            <div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap;">
              <input
                id="aiQueryInput"
                class="input"
                type="text"
                style="flex:1;min-width:200px;"
                placeholder="Type query‚Ä¶ e.g. module:auth severity>=3 last:14d"
              />
              <button type="button" class="btn sm" id="aiQueryRun">Run</button>
              <button type="button" class="btn ghost sm" id="aiQueryApplyFilters">
                Apply to Issues tab
              </button>
              <button type="button" class="btn ghost sm" id="aiQueryExport">
                Export results
              </button>
            </div>
            <div id="aiQueryResults" class="muted" style="margin-top:8px;font-size:13px;">
              Type a query with keywords and filters like <code>module:payments risk>=9</code>.
            </div>
          </div>

          <!-- F&B Release Planner (MENA) -->
          <div class="card" id="fnbReleasePlannerCard" aria-label="F&B release planner for MENA">
            <strong>F&amp;B Release Planner (MENA)</strong>
            <div class="muted" style="margin-top:4px;">
              Suggest safer release windows using F&amp;B tickets, releases and calendar signals in the Middle East
              to recommend safer release windows for your clients.
            </div>
            <div class="muted" style="margin-top:4px;font-size:11px;">
              Assumes <strong>Prod</strong> customer-facing releases. Staging / Dev changes are ignored for this planner.
            </div>

            <div class="fnb-controls">
              <div class="filter-row">
                <label class="muted" for="fnbModuleSelect">Module / product</label>
                <select id="fnbModuleSelect" class="select">
                  <option>All F&amp;B</option>
                </select>
              </div>

              <div class="filter-row">
                <label class="muted" for="fnbDateInput">Start date</label>
                <input id="fnbDateInput" class="input" type="date">
              </div>

              <div class="filter-row">
                <label class="muted" for="fnbDurationInput">Release duration (minutes)</label>
                <input id="fnbDurationInput" class="input" type="number" min="5" max="240" value="30">
              </div>

              <div class="filter-row">
                <label class="muted" for="fnbHorizonSelect">Planning horizon</label>
                <select id="fnbHorizonSelect" class="select">
                  <option value="3">Next 3 days</option>
                  <option value="7" selected>Next 7 days</option>
                  <option value="14">Next 14 days</option>
                  <option value="21">Next 21 days</option>
                </select>
              </div>

              <div class="filter-row fnb-scope-row">
                <label class="muted" for="fnbScopeInput">Release scope tickets (IDs)</label>
                <input id="fnbScopeInput" class="input" type="text"
                       placeholder="Comma-separated IDs e.g. INC-123, INC-456" />
                <span class="muted" style="font-size:11px;">
                  Used for risk summary and to pre-fill Prod deployment events.
                </span>
              </div>

              <div class="filter-row">
                <button type="button" class="btn sm" id="fnbSuggestBtn">
                  Suggest release windows
                </button>
              </div>
            </div>

            <ul id="fnbSlotsList" class="fnb-slots-list">
              <li class="fnb-slot-row">
                <span class="muted">
                  Planner will use F&amp;B related tickets, releases and calendar signals in the Middle East
                  to recommend safer release windows for your clients.
                </span>
              </li>
            </ul>
          </div>
        </div>
      </section>
    </section>
  </main>

  <!-- Spinner overlay -->
  <div id="spinner" class="spinner" aria-hidden="true">
    <div class="ring"></div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Issue modal -->
  <div id="issueModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-content">
      <div class="header">
        <h2 id="modalTitle">Issue</h2>
        <button type="button" id="modalClose" class="modal-close" aria-label="Close">‚úï</button>
      </div>
      <div id="modalBody"></div>
      <div class="actions" style="margin-top:10px;">
        <button type="button" class="btn sm" id="copyId">Copy ID</button>
        <button type="button" class="btn ghost sm" id="copyLink">Copy link</button>
      </div>
    </div>
  </div>

  <!-- Event modal -->
  <div id="eventModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="eventModalTitle">
    <div class="modal-content">
      <div class="header">
        <h2 id="eventModalTitle">Add Event</h2>
        <button type="button" id="eventModalClose" class="modal-close" aria-label="Close">‚úï</button>
      </div>

      <form id="eventForm">
        <div class="filter-group">
          <div class="filter-row">
            <label class="muted" for="eventTitle">Title</label>
            <input id="eventTitle" class="input" type="text" required />
          </div>

          <div class="filter-row">
            <label class="muted" for="eventType">Type</label>
            <select id="eventType" class="select">
              <option>Deployment</option>
              <option>Maintenance</option>
              <option>Release</option>
              <option>Other</option>
            </select>
          </div>

          <div class="filter-row">
            <label class="muted" for="eventEnv">Environment</label>
            <select id="eventEnv" class="select">
              <option value="Prod">Prod</option>
              <option value="Staging">Staging</option>
              <option value="Dev">Dev</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div class="filter-row">
            <label class="muted" for="eventStatus">Change status</label>
            <select id="eventStatus" class="select">
              <option>Planned</option>
              <option>In progress</option>
              <option>Completed</option>
              <option>Cancelled</option>
            </select>
          </div>

          <div class="filter-row">
            <label class="muted" for="eventOwner">Owner</label>
            <input id="eventOwner" class="input" type="text" />
          </div>

          <div class="filter-row">
            <label class="muted" for="eventModules">Modules (comma-separated)</label>
            <input id="eventModules" class="input" type="text" />
          </div>

          <div class="filter-row">
            <label class="muted" for="eventImpactType">Impact</label>
            <select id="eventImpactType" class="select">
              <option>No downtime expected</option>
              <option>Customer visible</option>
              <option>Internal only</option>
            </select>
          </div>

          <div class="filter-row">
            <label class="muted" for="eventIssueId">Linked ticket IDs</label>
            <input id="eventIssueId" class="input" type="text" />
          </div>

          <div class="filter-row">
            <label class="muted" for="eventStart">Start</label>
            <input id="eventStart" class="input" type="datetime-local" required />
          </div>

          <div class="filter-row">
            <label class="muted" for="eventEnd">End</label>
            <input id="eventEnd" class="input" type="datetime-local" />
          </div>

          <div class="filter-row">
            <label>
              <input type="checkbox" id="eventAllDay" /> All day
            </label>
          </div>

          <div class="filter-row">
            <label class="muted" for="eventDescription">Description</label>
            <textarea id="eventDescription" class="input" rows="3"></textarea>
          </div>

          <div id="eventIssueLinkedInfo" class="muted" style="display:none;"></div>
        </div>

        <div class="actions" style="margin-top:10px;">
          <button type="submit" class="btn sm" id="eventSave">Save</button>
          <button type="button" class="btn ghost sm" id="eventCancel">Cancel</button>
          <button type="button" class="btn ghost sm" id="eventDelete" style="margin-left:auto;display:none;">
            Delete
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>

  <!-- App script -->
  <script src="app.js"></script>
</body>
</html>
