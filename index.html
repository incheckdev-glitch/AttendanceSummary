<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>InCheck Pro Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Favicon to avoid 404 -->
  <link rel="icon" href="data:," />

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />

  <!-- FullCalendar + Chart.js + PapaParse -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/main.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/main.min.js"></script>

  <!-- App script -->
  <script src="script.js" defer></script>
</head>
<body>
  <header>
    <button id="drawerBtn" class="btn ghost drawer-toggle" aria-label="Toggle filters">
      <span class="icon">â˜°</span>
    </button>

    <div class="brand">
      <div class="logo">IC</div>
      <div class="brand-text">
        <span>InCheck Pro</span>
        <span>Issues Â· Calendar Â· Releases</span>
      </div>
    </div>

    <div class="toolbar">
      <span class="chip">
        <span id="syncIssuesDot" class="dot ok"></span>
        <span id="syncIssuesText">Issues: â€”</span>
      </span>
      <span class="chip">
        <span id="syncEventsDot" class="dot ok"></span>
        <span id="syncEventsText">Events: â€”</span>
      </span>
      <span id="loadingStatus" class="muted"></span>

      <span id="onlineStatusChip" class="chip online">Online</span>

      <select id="themeSelect" class="select sm" aria-label="Theme">
        <option value="system">System</option>
        <option value="dark">Dark</option>
        <option value="light">Light</option>
      </select>

      <input type="color" id="accentColor" aria-label="Accent color" />

      <button id="shortcutsHelp" class="btn ghost sm" type="button" title="Keyboard shortcuts">
        ?
      </button>
    </div>
  </header>

  <div class="wrap">
    <!-- SIDEBAR / FILTERS -->
    <aside id="sidebar" class="sidebar">
      <h3>Filters</h3>
      <div class="filter-group">
        <div class="filter-row">
          <label for="searchInput" class="muted">Search</label>
          <input
            id="searchInput"
            class="input"
            type="search"
            placeholder="Search by ID, title, logâ€¦"
          />
        </div>

        <div class="filter-row">
          <label for="moduleFilter" class="muted">Module</label>
          <select id="moduleFilter" class="select"></select>
        </div>

        <div class="filter-row">
          <label for="priorityFilter" class="muted">Priority</label>
          <select id="priorityFilter" class="select"></select>
        </div>

        <div class="filter-row">
          <label for="statusFilter" class="muted">Status</label>
          <select id="statusFilter" class="select"></select>
        </div>

        <div class="filter-row">
          <label for="startDateFilter" class="muted">From date</label>
          <input id="startDateFilter" type="date" class="input" />
        </div>

        <div class="filter-row">
          <label for="endDateFilter" class="muted">To date</label>
          <input id="endDateFilter" type="date" class="input" />
        </div>

        <button id="resetBtn" class="btn ghost sm" type="button">
          Reset filters
        </button>
      </div>

      <div class="divider"></div>

      <h3>Actions</h3>
      <div class="filter-group">
        <button id="createTicketBtn" class="btn primary sm" type="button">
          + New ticket
        </button>
        <button id="refreshNow" class="btn sm" type="button">
          â†» Refresh data
        </button>
        <button id="exportCsv" class="btn ghost sm" type="button">
          â‡© Export CSV
        </button>
      </div>

      <div class="divider"></div>

      <h3>Hints</h3>
      <p class="muted" style="font-size:11px;">
        Press <strong>/</strong> to focus search.<br />
        Press <strong>1</strong> for Issues, <strong>2</strong> for Calendar.
      </p>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="content">
      <div class="view-tabs">
        <button id="issuesTab" class="view-tab active" data-view="issues">
          <span class="icon">â˜°</span>
          <span>Issues</span>
        </button>
        <button id="calendarTab" class="view-tab" data-view="calendar">
          <span class="icon">ðŸ“…</span>
          <span>Calendar</span>
        </button>
      </div>

      <!-- ISSUES VIEW -->
      <section id="issuesView" class="view active">
        <!-- Summary + filters chips + quick actions -->
        <section class="card">
          <div class="summary-bar">
            <div>
              <div id="issuesSummaryText">Loading issuesâ€¦</div>
              <div id="activeFiltersChips" class="filter-chips"></div>
            </div>
            <div style="display:flex;gap:6px;flex-wrap:wrap;">
              <button id="refreshNowTop" class="btn ghost sm" type="button" onclick="document.getElementById('refreshNow').click()">
                â†» Refresh
              </button>
              <button id="exportCsvTop" class="btn ghost sm" type="button" onclick="document.getElementById('exportCsv').click()">
                â‡© Export
              </button>
              <button id="createTicketBtnTop" class="btn primary sm" type="button" onclick="document.getElementById('createTicketBtn').click()">
                + New ticket
              </button>
            </div>
          </div>
        </section>

        <!-- KPIs (4 cards in a row) -->
        <section class="grid cols-4" id="kpis">
          <!-- JS will inject KPI cards here -->
        </section>

        <!-- Charts: 4 cards, 2x2 -->
        <section class="charts">
          <div class="card">
            <div class="summary-bar">
              <span>By module</span>
            </div>
            <div style="height:200px;">
              <canvas id="byModule"></canvas>
            </div>
          </div>
          <div class="card">
            <div class="summary-bar">
              <span>By priority</span>
            </div>
            <div style="height:200px;">
              <canvas id="byPriority"></canvas>
            </div>
          </div>
          <div class="card">
            <div class="summary-bar">
              <span>By status</span>
            </div>
            <div style="height:200px;">
              <canvas id="byStatus"></canvas>
            </div>
          </div>
          <div class="card">
            <div class="summary-bar">
              <span>By type</span>
            </div>
            <div style="height:200px;">
              <canvas id="byType"></canvas>
            </div>
          </div>
        </section>

        <!-- Issues table -->
        <section class="card">
          <div class="summary-bar">
            <div id="rowCount">No rows</div>
            <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap;">
              <span class="muted" style="font-size:11px;">Rows per page</span>
              <select id="pageSize" class="select sm">
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
            </div>
          </div>

          <div class="table-wrap">
            <table id="issuesTable">
              <thead>
                <tr>
                  <th class="sortable" data-key="id">ID</th>
                  <th class="sortable" data-key="module">Module</th>
                  <th class="sortable" data-key="title">Title</th>
                  <th class="sortable" data-key="priority">Priority</th>
                  <th class="sortable" data-key="status">Status</th>
                  <th class="sortable" data-key="date">Date</th>
                  <th>Log</th>
                  <th>Attachment</th>
                </tr>
              </thead>
              <tbody id="tbodySkeleton">
                <tr>
                  <td colspan="8">
                    <div class="skeleton" style="height:42px;"></div>
                  </td>
                </tr>
                <tr>
                  <td colspan="8">
                    <div class="skeleton" style="height:42px;"></div>
                  </td>
                </tr>
                <tr>
                  <td colspan="8">
                    <div class="skeleton" style="height:42px;"></div>
                  </td>
                </tr>
              </tbody>
              <tbody id="issuesTbody"></tbody>
            </table>
          </div>

          <div class="table-actions">
            <div id="pageInfo">Page 1 / 1</div>
            <div class="pagination">
              <button id="firstPage" class="chip-btn" type="button">Â« First</button>
              <button id="prevPage" class="chip-btn" type="button">â€¹ Prev</button>
              <button id="nextPage" class="chip-btn" type="button">Next â€º</button>
              <button id="lastPage" class="chip-btn" type="button">Last Â»</button>
            </div>
          </div>
        </section>
      </section>

      <!-- CALENDAR VIEW -->
      <section id="calendarView" class="view">
        <!-- Calendar card -->
        <section class="card">
          <div class="summary-bar">
            <div>
              <div><strong>Calendar &amp; change schedule</strong></div>
              <div id="calendarTz" class="muted">Times shown in local time</div>
            </div>
            <div style="display:flex;gap:6px;flex-wrap:wrap;align-items:center;">
              <span class="muted" style="font-size:11px;">Show</span>
              <label class="chip">
                <input type="checkbox" id="eventFilterDeployment" checked />
                Deployment
              </label>
              <label class="chip">
                <input type="checkbox" id="eventFilterMaintenance" checked />
                Maintenance
              </label>
              <label class="chip">
                <input type="checkbox" id="eventFilterRelease" checked />
                Release
              </label>
              <label class="chip">
                <input type="checkbox" id="eventFilterOther" checked />
                Other
              </label>
              <button id="addEventBtn" class="btn primary sm" type="button">
                + Add event
              </button>
            </div>
          </div>

          <div id="calendar"></div>
        </section>

        <!-- RELEASE PLANNER BELOW CALENDAR -->
        <section class="card" id="releasePlannerCard">
          <div class="summary-bar">
            <div>
              <div><strong>Release planner â€“ F&amp;B / Middle East</strong></div>
              <div class="muted" style="font-size:12px;">
                Use issue risk + calendar events to find safer release windows.
              </div>
            </div>
            <button id="plannerRun" class="btn primary sm" type="button">
              Compute windows
            </button>
          </div>

          <div class="planner-grid" style="margin-top:8px;">
            <div>
              <label for="plannerRegion">Region profile</label>
              <select id="plannerRegion" class="select">
                <option value="gulf">Gulf (KSA / UAE / Qatar)</option>
                <option value="levant">Levant</option>
                <option value="northafrica">North Africa</option>
              </select>
            </div>
            <div>
              <label for="plannerEnv">Environment</label>
              <select id="plannerEnv" class="select">
                <option value="Prod">Production</option>
                <option value="Staging">Staging</option>
                <option value="Dev">Dev</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div>
              <label for="plannerReleaseType">Release type</label>
              <select id="plannerReleaseType" class="select">
                <option value="feature">Feature</option>
                <option value="minor">Minor / hotfix</option>
                <option value="major">Major</option>
              </select>
            </div>
            <div>
              <label for="plannerModules">Modules (comma-separated)</label>
              <input
                id="plannerModules"
                class="input"
                placeholder="e.g. POS, KDS, Payments"
              />
            </div>
            <div>
              <label for="plannerHorizon">Horizon (days)</label>
              <input
                id="plannerHorizon"
                class="input"
                type="number"
                min="1"
                max="30"
                value="7"
              />
            </div>
            <div>
              <label for="plannerSlotsPerDay">Slots per day</label>
              <input
                id="plannerSlotsPerDay"
                class="input"
                type="number"
                min="1"
                max="8"
                value="4"
              />
            </div>
          </div>

          <div
            style="margin-top:10px;display:grid;gap:10px;grid-template-columns:repeat(2,minmax(0,1fr));"
          >
            <div>
              <label for="plannerTickets">Tickets in scope</label>
              <select id="plannerTickets" class="select" multiple size="6"></select>
            </div>
            <div>
              <label for="plannerDescription">Release description / notes</label>
              <textarea
                id="plannerDescription"
                class="input"
                placeholder="Short description of this release"
              ></textarea>
            </div>
          </div>

          <div
            style="margin-top:10px;display:flex;gap:8px;align-items:center;flex-wrap:wrap;"
          >
            <div style="flex:1;min-width:200px;">
              <label for="plannerReleasePlan">Existing Release events (horizon)</label>
              <select id="plannerReleasePlan" class="select"></select>
            </div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
              <button id="plannerAssignBtn" class="btn sm" type="button">
                Assign selected tickets
              </button>
              <button id="plannerAddEvent" class="btn ghost sm" type="button">
                Add top suggestion as Release event
              </button>
            </div>
          </div>

          <div
            id="plannerResults"
            class="muted"
            style="margin-top:10px;font-size:12px;"
          >
            Run the planner to see suggested windows.
          </div>
        </section>
      </section>
    </main>
  </div>

  <!-- ISSUE MODAL -->
  <div id="issueModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <div class="header">
        <h2 id="modalTitle">Issue</h2>
        <button id="modalClose" class="modal-close" type="button">Ã—</button>
      </div>
      <div id="modalBody" style="font-size:13px;"></div>
      <div class="actions" style="margin-top:12px;justify-content:flex-end;">
        <button id="copyId" class="btn sm" type="button">Copy ID</button>
        <button id="copyLink" class="btn ghost sm" type="button">Copy link</button>
      </div>
    </div>
  </div>

  <!-- EVENT MODAL -->
  <div id="eventModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <div class="header">
        <h2 id="eventModalTitle">Add Event</h2>
        <button id="eventModalClose" class="modal-close" type="button">Ã—</button>
      </div>
      <form id="eventForm">
        <div class="grid" style="grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;">
          <div>
            <label for="eventTitle" class="muted">Title</label>
            <input id="eventTitle" class="input" required />
          </div>
          <div>
            <label for="eventType" class="muted">Type</label>
            <select id="eventType" class="select">
              <option value="Deployment">Deployment</option>
              <option value="Maintenance">Maintenance</option>
              <option value="Release">Release</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div>
            <label for="eventEnv" class="muted">Environment</label>
            <select id="eventEnv" class="select">
              <option value="Prod">Prod</option>
              <option value="Staging">Staging</option>
              <option value="Dev">Dev</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div>
            <label for="eventStatus" class="muted">Status</label>
            <select id="eventStatus" class="select">
              <option value="Planned">Planned</option>
              <option value="In progress">In progress</option>
              <option value="Completed">Completed</option>
              <option value="Canceled">Canceled</option>
            </select>
          </div>
          <div>
            <label for="eventOwner" class="muted">Owner</label>
            <input id="eventOwner" class="input" />
          </div>
          <div>
            <label for="eventModules" class="muted">Modules (comma-sep)</label>
            <input id="eventModules" class="input" />
          </div>
          <div>
            <label for="eventImpactType" class="muted">Impact</label>
            <select id="eventImpactType" class="select">
              <option value="No downtime expected">No downtime expected</option>
              <option value="Possible brief impact">Possible brief impact</option>
              <option value="High risk change">High risk change</option>
            </select>
          </div>
          <div>
            <label for="eventIssueId" class="muted">Linked ticket IDs</label>
            <input
              id="eventIssueId"
              class="input"
              placeholder="e.g. INC-123, INC-456"
            />
          </div>
          <div>
            <label for="eventStart" class="muted">Start</label>
            <input id="eventStart" type="datetime-local" class="input" />
          </div>
          <div>
            <label for="eventEnd" class="muted">End</label>
            <input id="eventEnd" type="datetime-local" class="input" />
          </div>
          <div style="display:flex;align-items:center;gap:6px;margin-top:4px;">
            <input type="checkbox" id="eventAllDay" />
            <label for="eventAllDay" class="muted" style="margin:0;font-size:12px;">
              All day
            </label>
          </div>
        </div>

        <div style="margin-top:10px;">
          <label for="eventDescription" class="muted">Description</label>
          <textarea id="eventDescription" class="input" rows="3"></textarea>
        </div>

        <div
          id="eventIssueLinkedInfo"
          class="muted"
          style="margin-top:6px;display:none;font-size:12px;"
        ></div>

        <div class="actions" style="margin-top:12px;justify-content:space-between;">
          <button id="eventDelete" class="btn ghost" type="button" style="display:none;">
            Delete
          </button>
          <div style="display:flex;gap:8px;">
            <button id="eventCancel" class="btn ghost" type="button">Cancel</button>
            <button id="eventSave" class="btn primary" type="submit">Save</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- SPINNER + TOAST -->
  <div id="spinner" class="spinner">
    <div class="ring"></div>
  </div>
  <div id="toast" class="toast"></div>
</body>
</html>
