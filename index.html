<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>InCheck Pro â€” Issues Â· Ops</title>

  <!-- Favicon (inline to avoid 404s) -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect rx='14' width='64' height='64' fill='%232563eb'/%3E%3Cpath d='M20 20h24v24H20z' fill='%23fff'/%3E%3C/svg%3E" />

  <!-- App styles -->
  <link rel="stylesheet" href="styles.css" />

  <!-- FullCalendar (global build so window.FullCalendar exists) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

  <!-- Chart.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- PapaParse (CSV loader for issues) -->
  <script defer src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <!-- Small modal layout helpers -->
  <style>
    .grid-3{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}
    .grid-2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    @media (max-width: 980px){.grid-3{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width: 640px){.grid-3,.grid-2{grid-template-columns:1fr}}
    .field>label{display:block;font-size:11px;text-transform:uppercase;letter-spacing:.12em;color:var(--muted);margin:0 0 4px}
    .field .input,.field .select,.field textarea{width:100%}
  </style>
</head>

<body>
  <!-- Header -->
  <header>
    <div class="brand" aria-label="InCheck Pro">
      <div class="logo">IC</div>
      <div class="brand-text">
        <span>InCheck Pro</span>
        <span>Issues Â· Ops</span>
      </div>
    </div>

    <!-- Search -->
    <input id="searchInput" class="input" style="min-width:260px; margin-left:12px"
           type="search" placeholder="Search issues (press /)" aria-label="Search issues" />

    <!-- Toolbar -->
    <div class="toolbar">
      <select id="themeSelect" class="select" aria-label="Theme">
        <option value="system">System</option>
        <option value="dark">Dark</option>
        <option value="light">Light</option>
      </select>

      <button id="shortcutsHelp" class="btn ghost sm" type="button">? Shortcuts</button>

      <span class="chip online" id="onlineStatusChip">Online</span>

      <button id="createTicketBtn" class="btn primary sm" type="button">+ New ticket</button>
      <button id="refreshNow" class="btn sm" type="button">â†» Refresh data</button>
      <button id="exportCsv" class="btn sm" type="button">â‡© Export CSV</button>
    </div>
  </header>

  <div class="wrap">
    <!-- Sidebar filters -->
    <aside class="sidebar" id="sidebar" aria-label="Filters">
      <h3>Filters</h3>

      <div class="filter-group">
        <div class="filter-row">
          <label for="moduleFilter" class="muted">Module</label>
          <select id="moduleFilter" class="select"></select>
        </div>

        <div class="filter-row">
          <label for="priorityFilter" class="muted">Priority</label>
          <select id="priorityFilter" class="select"></select>
        </div>

        <div class="filter-row">
          <label for="statusFilter" class="muted">Status</label>
          <select id="statusFilter" class="select"></select>
        </div>

        <div class="filter-row">
          <label for="startDateFilter" class="muted">Start date</label>
          <input id="startDateFilter" type="date" class="input" />
        </div>

        <div class="filter-row">
          <label for="endDateFilter" class="muted">End date</label>
          <input id="endDateFilter" type="date" class="input" />
        </div>

        <button id="resetBtn" class="btn sm" type="button">Reset filters</button>
      </div>

      <div class="divider"></div>

      <div class="filter-group">
        <h3>Dataset</h3>
        <div class="statusline">
          <span class="dot" id="syncIssuesDot"></span>
          <span id="syncIssuesText" class="muted">Issues: never</span>
        </div>
        <div class="statusline">
          <span class="dot" id="syncEventsDot"></span>
          <span id="syncEventsText" class="muted">Events: never</span>
        </div>
      </div>

      <div class="divider"></div>
      <div class="muted" style="font-size:11px">
        Keyboard:<br/>
        <span>1 = Issues, 2 = Calendar</span><br/>
        <span>/ = Search, Ctrl/Cmd + K = AI query (if enabled)</span>
      </div>
    </aside>

    <!-- Main content -->
    <main class="content">
      <!-- Tabs -->
      <div class="view-tabs" role="tablist" aria-label="Views">
        <button id="issuesTab" class="view-tab active" data-view="issues" role="tab" aria-selected="true">
          <span class="icon">ðŸ“„</span> Issues
        </button>
        <button id="calendarTab" class="view-tab" data-view="calendar" role="tab" aria-selected="false">
          <span class="icon">ðŸ“…</span> Calendar &amp; Releases
        </button>
      </div>

      <!-- Issues view -->
      <section id="issuesView" class="view active" role="tabpanel" aria-labelledby="issuesTab">

        <!-- Summary / loader row -->
        <div class="card summary-bar">
          <div id="issuesSummaryText">Loadingâ€¦</div>
          <div class="shortcut-chip" id="loadingStatus"></div>
        </div>

        <!-- Filter chips -->
        <div id="activeFiltersChips" class="filter-chips"></div>

        <!-- KPI cards -->
        <div id="kpis" class="grid cols-4"></div>

        <!-- Charts: 2Ã—2, each its own card -->
        <div class="charts">
          <div class="card">
            <div class="label" style="margin-bottom:6px;">Issues by module</div>
            <canvas id="byModule" height="220"></canvas>
          </div>
          <div class="card">
            <div class="label" style="margin-bottom:6px;">Issues by priority</div>
            <canvas id="byPriority" height="220"></canvas>
          </div>
        </div>

        <div class="charts">
          <div class="card">
            <div class="label" style="margin-bottom:6px;">Issues by status</div>
            <canvas id="byStatus" height="220"></canvas>
          </div>
          <div class="card">
            <div class="label" style="margin-bottom:6px;">Issues by type</div>
            <canvas id="byType" height="220"></canvas>
          </div>
        </div>

        <!-- Table -->
        <div class="table-wrap">
          <table id="issuesTable" aria-label="Issues">
            <thead>
              <tr>
                <th class="sortable" data-key="id">ID</th>
                <th class="sortable" data-key="module">Module</th>
                <th class="sortable" data-key="title">Title</th>
                <th class="sortable" data-key="priority">Priority</th>
                <th class="sortable" data-key="status">Status</th>
                <th class="sortable" data-key="date">Date</th>
                <th>Log</th>
                <th>Link</th>
              </tr>
            </thead>
            <tbody id="issuesTbody"></tbody>
          </table>

          <div id="tbodySkeleton" class="skeleton" style="height:180px; margin: 12px;"></div>
        </div>

        <!-- Pagination / table actions -->
        <div class="table-actions">
          <div id="rowCount" class="muted">â€”</div>
          <div class="pagination">
            <button id="firstPage" class="chip-btn" aria-label="First page">Â«</button>
            <button id="prevPage" class="chip-btn" aria-label="Previous page">â€¹</button>
            <span id="pageInfo" class="muted">Page 1 / 1</span>
            <button id="nextPage" class="chip-btn" aria-label="Next page">â€º</button>
            <button id="lastPage" class="chip-btn" aria-label="Last page">Â»</button>
          </div>
          <div>
            <label for="pageSize" class="muted">Rows</label>
            <select id="pageSize" class="select sm">
              <option>10</option><option selected>20</option><option>50</option><option>100</option>
            </select>
          </div>
        </div>
      </section>

      <!-- Calendar view -->
      <section id="calendarView" class="view" role="tabpanel" aria-labelledby="calendarTab">
        <div class="card">
          <div class="summary-bar" style="margin-bottom:8px">
            <div>
              <strong>Change calendar</strong>
              <div id="calendarTz" class="muted" style="margin-top:2px"></div>
            </div>
            <div class="statusline" style="gap:14px">
              <span class="muted">Event types:</span>
              <label class="chip"><input id="eventFilterDeployment" type="checkbox" checked /> Deployment</label>
              <label class="chip"><input id="eventFilterMaintenance" type="checkbox" checked /> Maintenance</label>
              <label class="chip"><input id="eventFilterRelease" type="checkbox" checked /> Release</label>
              <label class="chip"><input id="eventFilterOther" type="checkbox" checked /> Other</label>
              <button id="addEventBtn" class="btn primary sm" type="button">+ Add event</button>
            </div>
          </div>

          <div id="calendar" aria-label="Calendar"></div>
        </div>

        <!-- Release Planner under the calendar -->
        <div id="releasePlannerCard" class="card">
          <div class="summary-bar">
            <strong>Release Planner â€” F&amp;B Middle East</strong>
            <button id="plannerRun" class="btn primary sm" type="button">Suggest slots</button>
          </div>

          <div class="planner-grid" style="margin-top:8px">
            <div class="field">
              <label for="plannerRegion">Region profile</label>
              <select id="plannerRegion" class="select">
                <option value="Gulf (KSA / UAE / Qatar)">Gulf (KSA / UAE / Qatar)</option>
                <option value="Levant">Levant</option>
                <option value="North Africa">North Africa</option>
              </select>
            </div>

            <div class="field">
              <label for="plannerEnv">Environment</label>
              <select id="plannerEnv" class="select">
                <option>Prod</option><option>Staging</option><option>Dev</option><option>Other</option>
              </select>
            </div>

            <div class="field">
              <label for="plannerReleaseType">Release type</label>
              <select id="plannerReleaseType" class="select">
                <option value="feature">Feature</option>
                <option value="minor">Minor</option>
                <option value="major">Major</option>
              </select>
            </div>

            <div class="field">
              <label for="plannerModules">Modules / areas</label>
              <input id="plannerModules" class="input" placeholder="e.g. POS, kitchen, delivery" />
            </div>

            <div class="field">
              <label for="plannerHorizon">Horizon (days)</label>
              <input id="plannerHorizon" class="input" type="number" min="1" value="7" />
            </div>

            <div class="field">
              <label for="plannerSlotsPerDay">Slots per day (max)</label>
              <input id="plannerSlotsPerDay" class="input" type="number" min="1" value="4" />
            </div>

            <div class="field" style="grid-column:1/-1">
              <label for="plannerTickets">Tickets in scope</label>
              <select id="plannerTickets" class="select" multiple size="5"></select>
            </div>

            <div class="field" style="grid-column:1/-1">
              <label for="plannerDescription">Notes</label>
              <textarea id="plannerDescription" class="input" placeholder="Release / maintenance details, expected impact, comms notesâ€¦"></textarea>
            </div>
          </div>

          <div id="plannerResults" style="margin-top:10px"></div>

          <div class="summary-bar" style="margin-top:10px">
            <div class="muted">Assign selected tickets to a planned Release event:</div>
            <div style="display:flex;gap:8px;align-items:center">
              <select id="plannerReleasePlan" class="select" style="min-width:260px"></select>
              <button id="plannerAssignBtn" class="btn sm" type="button">Assign to plan</button>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Issue modal -->
  <div id="issueModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-content">
      <div class="header">
        <h3 id="modalTitle">Issue</h3>
        <button id="modalClose" class="modal-close" aria-label="Close">âœ•</button>
      </div>
      <div id="modalBody"></div>
      <div class="actions" style="margin-top:10px">
        <button id="copyId" class="btn sm" type="button">Copy ID</button>
        <button id="copyLink" class="btn sm" type="button">Copy link</button>
      </div>
    </div>
  </div>

  <!-- Event modal -->
  <div id="eventModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="eventModalTitle">
    <div class="modal-content">
      <div class="header">
        <h3 id="eventModalTitle">Add Event</h3>
        <button id="eventModalClose" class="modal-close" aria-label="Close">âœ•</button>
      </div>

      <form id="eventForm" class="grid-3">
        <div class="field" style="grid-column:1/-1">
          <label for="eventTitle">Title</label>
          <input id="eventTitle" class="input" placeholder="Release / maintenance title" />
        </div>

        <div class="field">
          <label for="eventType">Type</label>
          <select id="eventType" class="select">
            <option>Deployment</option>
            <option>Maintenance</option>
            <option>Release</option>
            <option>Other</option>
          </select>
        </div>

        <div class="field">
          <label for="eventEnv">Environment</label>
          <select id="eventEnv" class="select">
            <option>Prod</option><option>Staging</option><option>Dev</option><option>Other</option>
          </select>
        </div>

        <div class="field">
          <label for="eventStatus">Change status</label>
          <select id="eventStatus" class="select">
            <option>Planned</option><option>In progress</option><option>Done</option><option>Cancelled</option>
          </select>
        </div>

        <div class="field">
          <label for="eventOwner">Owner</label>
          <input id="eventOwner" class="input" placeholder="Team / on-call / approver" />
        </div>

        <div class="field">
          <label for="eventModules">Modules</label>
          <input id="eventModules" class="input" placeholder="Comma-separated modules" />
        </div>

        <div class="field">
          <label for="eventImpactType">Impact</label>
          <select id="eventImpactType" class="select">
            <option>No downtime expected</option>
            <option>Short downtime (â‰¤ 5m)</option>
            <option>Planned downtime</option>
            <option>High risk change</option>
          </select>
        </div>

        <div class="field">
          <label for="eventIssueId">Linked ticket ID(s)</label>
          <input id="eventIssueId" class="input" placeholder="e.g. INC-123, INC-456" />
        </div>

        <div class="field">
          <label for="eventStart">Start</label>
          <input id="eventStart" type="datetime-local" class="input" />
        </div>

        <div class="field">
          <label for="eventEnd">End</label>
          <input id="eventEnd" type="datetime-local" class="input" />
        </div>

        <div class="field">
          <label class="muted">All day</label>
          <div style="display:flex;align-items:center;gap:8px;">
            <input id="eventAllDay" type="checkbox" />
            <span class="muted">Toggle to use date-only fields</span>
          </div>
        </div>

        <div class="field" style="grid-column:1/-1">
          <label for="eventDescription">Description</label>
          <textarea id="eventDescription" class="input" placeholder="Release / maintenance details, expected impact, comms notesâ€¦"></textarea>
        </div>
      </form>

      <div id="eventIssueLinkedInfo" class="muted" style="display:none;margin:6px 0 0"></div>

      <div class="actions" style="margin-top:10px">
        <button id="eventSave" class="btn primary" type="button">Save</button>
        <button id="eventCancel" class="btn" type="button">Cancel</button>
        <button id="eventDelete" class="btn" type="button" style="display:none">Delete</button>
      </div>
    </div>
  </div>

  <!-- Drawer toggle for small screens -->
  <button id="drawerBtn" class="btn sm drawer-toggle" aria-expanded="false" type="button">Filters</button>

  <!-- Spinner + toast -->
  <div id="spinner" class="spinner"><div class="ring" aria-hidden="true"></div></div>
  <div id="toast" class="toast"></div>

  <!-- App code -->
  <script defer src="script.js"></script>
</body>
</html>
