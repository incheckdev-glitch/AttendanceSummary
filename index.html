<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>InCheck 360 ‚Äì Issues ¬∑ Ops ¬∑ AI Copilot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />

  <!-- FullCalendar -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.css"
  />

  <!-- Fonts (optional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
  />
</head>
<body>
  <div id="app">
    <!-- Top bar -->
    <header class="topbar">
      <button id="drawerBtn" class="icon-btn" aria-label="Toggle sidebar" aria-expanded="true">
        ‚ò∞
      </button>

      <div class="brand">
        <span class="brand-main">InCheck 360</span>
        <span class="brand-sub">Issues ¬∑ Ops ¬∑ AI</span>
      </div>

      <div class="topbar-center">
        <span id="issuesSummaryText" class="muted"></span>
        <span id="loadingStatus" class="muted small"></span>
      </div>

      <div class="topbar-right">
        <span id="onlineStatusChip" class="chip">Online</span>

        <label class="topbar-control">
          Theme
          <select id="themeSelect">
            <option value="system">System</option>
            <option value="dark">Dark</option>
            <option value="light">Light</option>
          </select>
        </label>

        <label class="topbar-control">
          Accent
          <input id="accentColor" type="color" />
        </label>

        <button id="shortcutsHelp" class="btn ghost sm" type="button" title="Keyboard shortcuts">
          ?
        </button>
      </div>
    </header>

    <div class="layout">
      <!-- Sidebar / filters -->
      <aside id="sidebar" class="sidebar open">
        <div class="sidebar-section">
          <label class="field-label" for="searchInput">Search</label>
          <input
            id="searchInput"
            type="search"
            placeholder="Search ID, title, log‚Ä¶ (press /)"
          />
        </div>

        <div class="sidebar-section">
          <div class="sidebar-section-title">Filters</div>

          <label class="field-label" for="moduleFilter">Module</label>
          <select id="moduleFilter"></select>

          <label class="field-label" for="priorityFilter">Priority</label>
          <select id="priorityFilter"></select>

          <label class="field-label" for="statusFilter">Status</label>
          <select id="statusFilter"></select>

          <div class="date-row">
            <div>
              <label class="field-label" for="startDateFilter">From</label>
              <input id="startDateFilter" type="date" />
            </div>
            <div>
              <label class="field-label" for="endDateFilter">To</label>
              <input id="endDateFilter" type="date" />
            </div>
          </div>

          <div id="activeFiltersChips" class="filter-chips"></div>

          <div class="sidebar-buttons">
            <button id="resetBtn" type="button" class="btn ghost sm">Reset filters</button>
          </div>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-section-title">Data</div>
          <div class="sync-row">
            <span class="dot" id="syncIssuesDot"></span>
            <span id="syncIssuesText" class="small muted">Issues: ‚Äî</span>
          </div>
          <div class="sync-row">
            <span class="dot" id="syncEventsDot"></span>
            <span id="syncEventsText" class="small muted">Events: ‚Äî</span>
          </div>

          <button id="refreshNow" type="button" class="btn sm full">
            üîÑ Refresh now
          </button>

          <button id="exportCsv" type="button" class="btn ghost sm full">
            ‚¨áÔ∏è Export filtered CSV
          </button>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-section-title">Tickets</div>
          <button id="createTicketBtn" type="button" class="btn sm full">
            ‚ûï New ticket (form)
          </button>
        </div>
      </aside>

      <!-- Main content -->
      <main class="content">
        <!-- Tabs -->
        <nav class="tabs" aria-label="Views">
          <button
            id="issuesTab"
            class="tab active"
            data-view="issues"
            type="button"
            role="tab"
            aria-selected="true"
          >
            Issues
          </button>
          <button
            id="calendarTab"
            class="tab"
            data-view="calendar"
            type="button"
            role="tab"
            aria-selected="false"
          >
            Change Calendar
          </button>
          <button
            id="insightsTab"
            class="tab"
            data-view="insights"
            type="button"
            role="tab"
            aria-selected="false"
          >
            AI ¬∑ Insights
          </button>
        </nav>

        <!-- Issues view -->
        <section id="issuesView" class="view active" role="tabpanel">
          <!-- KPIs -->
          <section id="kpis" class="kpi-row"></section>

          <!-- Charts -->
          <section class="charts-grid">
            <div class="card chart-card">
              <div class="card-title">By Module</div>
              <canvas id="byModule"></canvas>
            </div>
            <div class="card chart-card">
              <div class="card-title">By Priority</div>
              <canvas id="byPriority"></canvas>
            </div>
            <div class="card chart-card">
              <div class="card-title">By Status</div>
              <canvas id="byStatus"></canvas>
            </div>
            <div class="card chart-card">
              <div class="card-title">By Type</div>
              <canvas id="byType"></canvas>
            </div>
          </section>

          <!-- Table + controls -->
          <section class="issues-table-section">
            <div class="table-toolbar">
              <span id="rowCount" class="muted">No rows</span>

              <div class="table-toolbar-right">
                <label class="small">
                  Page size
                  <select id="pageSize">
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                  </select>
                </label>

                <div class="pager">
                  <button id="firstPage" type="button" class="icon-btn" title="First page">
                    ¬´
                  </button>
                  <button id="prevPage" type="button" class="icon-btn" title="Previous page">
                    ‚Äπ
                  </button>
                  <span id="pageInfo" class="muted small">Page 1 / 1</span>
                  <button id="nextPage" type="button" class="icon-btn" title="Next page">
                    ‚Ä∫
                  </button>
                  <button id="lastPage" type="button" class="icon-btn" title="Last page">
                    ¬ª
                  </button>
                </div>
              </div>
            </div>

            <div class="table-wrapper">
              <table id="issuesTable">
                <thead>
                  <tr>
                    <th
                      scope="col"
                      class="sortable"
                      data-key="id"
                      aria-sort="none"
                    >
                      ID
                    </th>
                    <th
                      scope="col"
                      class="sortable"
                      data-key="module"
                      aria-sort="none"
                    >
                      Module
                    </th>
                    <th
                      scope="col"
                      class="sortable"
                      data-key="title"
                      aria-sort="none"
                    >
                      Title
                    </th>
                    <th
                      scope="col"
                      class="sortable"
                      data-key="priority"
                      aria-sort="none"
                    >
                      Priority
                    </th>
                    <th
                      scope="col"
                      class="sortable"
                      data-key="status"
                      aria-sort="none"
                    >
                      Status
                    </th>
                    <th
                      scope="col"
                      class="sortable"
                      data-key="date"
                      aria-sort="none"
                    >
                      Date
                    </th>
                    <th scope="col">Log</th>
                    <th scope="col">Link</th>
                  </tr>
                </thead>
                <tbody id="tbodySkeleton">
                  <tr>
                    <td colspan="8" class="muted" style="text-align:center;">
                      Loading tickets‚Ä¶
                    </td>
                  </tr>
                </tbody>
                <tbody id="issuesTbody"></tbody>
              </table>
            </div>
          </section>
        </section>

        <!-- Calendar view -->
        <section id="calendarView" class="view" role="tabpanel" aria-hidden="true">
          <div class="calendar-toolbar">
            <div class="calendar-filters">
              <label class="checkbox-inline">
                <input id="eventFilterDeployment" type="checkbox" checked />
                Deployment
              </label>
              <label class="checkbox-inline">
                <input id="eventFilterMaintenance" type="checkbox" checked />
                Maintenance
              </label>
              <label class="checkbox-inline">
                <input id="eventFilterRelease" type="checkbox" checked />
                Release
              </label>
              <label class="checkbox-inline">
                <input id="eventFilterOther" type="checkbox" checked />
                Other
              </label>
            </div>

            <div class="calendar-actions">
              <span id="calendarTz" class="small muted"></span>
              <button id="addEventBtn" type="button" class="btn sm">
                ‚ûï Add event
              </button>
            </div>
          </div>

          <div id="calendar" class="calendar"></div>
        </section>

        <!-- AI / Insights view -->
        <section id="insightsView" class="view" role="tabpanel" aria-hidden="true">
          <!-- AI query + F&B release planner row -->
          <div class="ai-top-row">
            <div class="card ai-query-card">
              <div class="card-title">AI Query (DSL)</div>
              <p class="muted small">
                Example: <code>module:payments status:open risk>=9 last:7d sort:risk</code>
              </p>
              <div class="ai-query-input-row">
                <input
                  id="aiQueryInput"
                  type="text"
                  placeholder="Type query‚Ä¶ (Ctrl+K to focus)"
                />
              </div>
              <div class="ai-query-actions">
                <button id="aiQueryRun" type="button" class="btn sm">
                  ‚ñ∂ Run query
                </button>
                <button id="aiQueryApplyFilters" type="button" class="btn ghost sm">
                  Apply as filters
                </button>
                <button id="aiQueryExport" type="button" class="btn ghost sm">
                  Export results CSV
                </button>
                <span id="aiAnalyzing" class="muted small" style="display:none;">
                  Analyzing‚Ä¶
                </span>
              </div>
              <div id="aiQueryResults" class="ai-query-results muted small">
                Type a query to see matching issues.
              </div>
            </div>

            <!-- F&B Release Window Planner -->
            <div class="card planner-card">
              <div class="card-title">
                F&amp;B Release Window Planner (Middle East)
              </div>
              <p class="muted small" id="releasePlannerExplain">
                Planner uses your ticket timestamps, known F&amp;B rush hours,
                Friday‚ÄìSaturday weekends, and holidays/events to estimate safer
                release windows.
              </p>

              <div class="planner-controls">
                <label class="small">
                  Horizon (days)
                  <select id="releasePlannerHorizon">
                    <option value="7">7</option>
                    <option value="14" selected>14</option>
                    <option value="21">21</option>
                    <option value="30">30</option>
                  </select>
                </label>
                <label class="small">
                  Environment
                  <select id="releasePlannerEnv">
                    <option value="Prod" selected>Prod</option>
                    <option value="Staging">Staging</option>
                    <option value="UAT">UAT</option>
                  </select>
                </label>
                <label class="small">
                  Focus module (optional)
                  <input
                    id="releasePlannerModule"
                    type="text"
                    placeholder="e.g. Ordering, KDS, Payments"
                  />
                </label>
              </div>

              <button id="releasePlannerRun" type="button" class="btn sm full">
                üöÄ Suggest release windows
              </button>

              <div id="releasePlannerResults" class="planner-results">
                <div class="muted small">
                  Run the planner to see safest upcoming release windows for your F&amp;B clients.
                </div>
              </div>
            </div>
          </div>

          <!-- AI summaries row -->
          <div class="ai-summary-row">
            <div class="card">
              <div class="card-title">Scope & Signals</div>
              <p id="aiScopeText" class="small"></p>
              <p id="aiSignalsText" class="small muted"></p>

              <div class="split-2">
                <div>
                  <div class="subheading">Top repeated terms (recent)</div>
                  <ul id="aiPatternsList" class="small"></ul>
                </div>
                <div>
                  <div class="subheading">Suggested categories</div>
                  <ul id="aiLabelsList" class="small"></ul>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-title">Trends & Top Risks</div>
              <div class="split-2">
                <div>
                  <div class="subheading">Trending up</div>
                  <ul id="aiTrendsList" class="small"></ul>
                </div>
                <div>
                  <div class="subheading">Emerging vs stable</div>
                  <ul id="aiEmergingStable" class="small"></ul>
                </div>
              </div>
              <div class="subheading" style="margin-top:8px;">
                Highest-risk recent issues
              </div>
              <ul id="aiRisksList" class="small"></ul>
            </div>
          </div>

          <!-- Modules + clusters + ops row -->
          <div class="ai-bottom-row">
            <div class="card">
              <div class="card-title">Module heatmap</div>
              <table class="simple-table">
                <thead>
                  <tr>
                    <th>Module</th>
                    <th>Open</th>
                    <th>High prio</th>
                    <th>Risk</th>
                    <th>Top term</th>
                  </tr>
                </thead>
                <tbody id="aiModulesTableBody"></tbody>
              </table>
            </div>

            <div class="card">
              <div class="card-title">Similar issue clusters</div>
              <div id="aiClusters" class="clusters-list small"></div>
            </div>

            <div class="card">
              <div class="card-title">Ops cockpit</div>
              <ul id="aiOpsCockpit" class="small"></ul>

              <div class="subheading">Triage queue</div>
              <ul id="aiTriageList" class="small"></ul>

              <div class="subheading">Incident-like issues</div>
              <ul id="aiIncidentsList" class="small"></ul>

              <div class="subheading">Upcoming risky events</div>
              <ul id="aiEventsList" class="small"></ul>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- Issue modal -->
  <div id="issueModal" class="modal" style="display:none;">
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <header class="modal-header">
        <h2 id="modalTitle"></h2>
        <button id="modalClose" class="icon-btn" type="button" aria-label="Close">
          ‚úï
        </button>
      </header>
      <div id="modalBody" class="modal-body"></div>
      <footer class="modal-footer">
        <button id="copyId" type="button" class="btn sm">Copy ID</button>
        <button id="copyLink" type="button" class="btn ghost sm">
          Copy link
        </button>
      </footer>
    </div>
  </div>

  <!-- Event modal -->
  <div id="eventModal" class="modal" style="display:none;">
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="eventModalTitle">
      <header class="modal-header">
        <h2 id="eventModalTitle">Add Event</h2>
        <button
          id="eventModalClose"
          class="icon-btn"
          type="button"
          aria-label="Close"
        >
          ‚úï
        </button>
      </header>
      <form id="eventForm" class="modal-body">
        <div class="field-row">
          <label class="field-label" for="eventTitle">Title</label>
          <input id="eventTitle" type="text" required />
        </div>

        <div class="field-row split-3">
          <div>
            <label class="field-label" for="eventType">Type</label>
            <select id="eventType">
              <option value="Deployment">Deployment</option>
              <option value="Release">Release</option>
              <option value="Maintenance">Maintenance</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div>
            <label class="field-label" for="eventEnv">Environment</label>
            <select id="eventEnv">
              <option value="Prod" selected>Prod</option>
              <option value="Staging">Staging</option>
              <option value="UAT">UAT</option>
            </select>
          </div>
          <div>
            <label class="field-label" for="eventStatus">Change status</label>
            <select id="eventStatus">
              <option value="Planned">Planned</option>
              <option value="In progress">In progress</option>
              <option value="Completed">Completed</option>
              <option value="Cancelled">Cancelled</option>
            </select>
          </div>
        </div>

        <div class="field-row split-2">
          <div>
            <label class="field-label" for="eventStart">Start</label>
            <input id="eventStart" type="datetime-local" required />
          </div>
          <div>
            <label class="field-label" for="eventEnd">End</label>
            <input id="eventEnd" type="datetime-local" />
          </div>
        </div>

        <label class="checkbox-inline">
          <input id="eventAllDay" type="checkbox" />
          All-day event
        </label>

        <div class="field-row split-2">
          <div>
            <label class="field-label" for="eventOwner">Owner</label>
            <input id="eventOwner" type="text" placeholder="e.g. Release manager" />
          </div>
          <div>
            <label class="field-label" for="eventModules">Modules</label>
            <input
              id="eventModules"
              type="text"
              placeholder="Comma-separated modules"
            />
          </div>
        </div>

        <div class="field-row">
          <label class="field-label" for="eventImpactType">Impact</label>
          <select id="eventImpactType">
            <option value="No downtime expected">No downtime expected</option>
            <option value="Partial impact">Partial impact</option>
            <option value="Full downtime">Full downtime</option>
          </select>
        </div>

        <div class="field-row">
          <label class="field-label" for="eventIssueId">Linked issue ID (optional)</label>
          <input
            id="eventIssueId"
            type="text"
            placeholder="Ticket ID to link"
          />
        </div>

        <div id="eventIssueLinkedInfo" class="small muted" style="display:none;"></div>

        <div class="field-row">
          <label class="field-label" for="eventDescription">Notes</label>
          <textarea
            id="eventDescription"
            rows="3"
            placeholder="Change description, rollback plan, etc."
          ></textarea>
        </div>

        <footer class="modal-footer">
          <button id="eventSave" type="submit" class="btn sm">
            üíæ Save
          </button>
          <button id="eventCancel" type="button" class="btn ghost sm">
            Cancel
          </button>
          <button
            id="eventDelete"
            type="button"
            class="btn danger sm"
            style="display:none;"
          >
            üóë Delete
          </button>
        </footer>
      </form>
    </div>
  </div>

  <!-- Global spinner -->
  <div id="spinner" class="spinner-backdrop" style="display:none;">
    <div class="spinner">
      <div class="spinner-dot"></div>
      <div>Loading‚Ä¶</div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" style="display:none;"></div>

  <!-- Libraries + app code -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
