<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>InCheck Pro Dashboard ‚Äî Issues ¬∑ Ops ¬∑ AI Copilot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
    rel="stylesheet"
  />

  <!-- FullCalendar CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css"
    rel="stylesheet"
  />

  <!-- App styles -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <a href="#issuesView" class="sr-only">Skip to content</a>

  <header>
    <button
      id="drawerBtn"
      class="btn ghost drawer-toggle"
      type="button"
      aria-label="Toggle filters sidebar"
      aria-expanded="false"
    >
      <span class="icon">‚ò∞</span>
    </button>

    <div class="brand">
      <div class="logo">IC</div>
      <div class="brand-text">
        <span>InCheck Pro</span>
        <span>Issues ¬∑ Ops ¬∑ AI Copilot</span>
      </div>
    </div>

    <div class="toolbar">
      <input
        id="searchInput"
        class="input"
        type="search"
        placeholder="Search issues‚Ä¶ (/)"
        aria-label="Search issues"
      />

      <select id="themeSelect" class="select" aria-label="Theme">
        <option value="system">System</option>
        <option value="dark">Dark</option>
        <option value="light">Light</option>
      </select>

      <input
        id="accentColor"
        type="color"
        aria-label="Accent color"
      />

      <button id="createTicketBtn" type="button" class="btn sm primary">
        <span class="icon">Ôºã</span>
        <span>New ticket</span>
      </button>

      <button id="refreshNow" type="button" class="btn sm ghost">
        <span class="icon">‚ü≥</span>
        <span>Refresh</span>
      </button>

      <button id="exportCsv" type="button" class="btn sm ghost">
        <span class="icon">‚¨á</span>
        <span>Export CSV</span>
      </button>

      <button id="shortcutsHelp" type="button" class="btn sm ghost">
        <span class="icon">‚åò</span>
        <span>Shortcuts</span>
      </button>

      <div class="statusline">
        <span id="onlineStatusChip" class="chip">Online</span>

        <span class="chip">
          <span id="syncIssuesDot" class="dot ok"></span>
          <span id="syncIssuesText">Issues: ‚Äî</span>
        </span>

        <span class="chip">
          <span id="syncEventsDot" class="dot ok"></span>
          <span id="syncEventsText">Events: ‚Äî</span>
        </span>

        <span id="loadingStatus" class="chip muted"></span>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- Sidebar (filters) -->
    <aside id="sidebar" class="sidebar">
      <h3>Filters</h3>
      <div class="filter-group">
        <div class="filter-row">
          <label class="muted" for="moduleFilter">Module</label>
          <select id="moduleFilter" class="select">
            <option>All</option>
          </select>
        </div>

        <div class="filter-row">
          <label class="muted" for="priorityFilter">Priority</label>
          <select id="priorityFilter" class="select">
            <option>All</option>
          </select>
        </div>

        <div class="filter-row">
          <label class="muted" for="statusFilter">Status</label>
          <select id="statusFilter" class="select">
            <option>All</option>
          </select>
        </div>

        <div class="filter-row">
          <label class="muted" for="startDateFilter">From</label>
          <input
            id="startDateFilter"
            type="date"
            class="input"
          />
        </div>

        <div class="filter-row">
          <label class="muted" for="endDateFilter">To</label>
          <input
            id="endDateFilter"
            type="date"
            class="input"
          />
        </div>

        <button
          id="resetBtn"
          type="button"
          class="btn sm ghost"
        >
          Clear filters
        </button>
      </div>

      <div class="divider"></div>

      <h3>AI & Ops</h3>
      <p class="muted">
        Use the AI tab for patterns, triage suggestions, and the Release Planner.
      </p>
      <p class="muted">Shortcuts: / for search ¬∑ 1/2/3 to switch views.</p>
    </aside>

    <!-- Main content -->
    <section class="content">
      <!-- View tabs -->
      <div class="view-tabs" role="tablist">
        <button
          id="issuesTab"
          class="view-tab active"
          type="button"
          role="tab"
          aria-selected="true"
          data-view="issues"
        >
          <span class="icon">üìã</span>
          <span>Issues</span>
        </button>
        <button
          id="calendarTab"
          class="view-tab"
          type="button"
          role="tab"
          aria-selected="false"
          data-view="calendar"
        >
          <span class="icon">üìÖ</span>
          <span>Calendar</span>
        </button>
        <button
          id="insightsTab"
          class="view-tab"
          type="button"
          role="tab"
          aria-selected="false"
          data-view="insights"
        >
          <span class="icon">ü§ñ</span>
          <span>AI & Ops</span>
        </button>
      </div>

      <!-- Issues view -->
      <section
        id="issuesView"
        class="view active"
        role="tabpanel"
        aria-labelledby="issuesTab"
      >
        <!-- Summary + filters chips -->
        <div class="card">
          <div class="summary-bar">
            <div id="issuesSummaryText">
              Loading issues‚Ä¶
            </div>
            <div id="activeFiltersChips" class="filter-chips">
              <span class="muted" style="font-size:11px;">
                No filters applied.
              </span>
            </div>
            <div class="shortcut-chip">
              Shortcuts: / search ¬∑ 1/2/3 switch tabs
            </div>
          </div>
        </div>

        <!-- KPIs -->
        <div class="card">
          <div class="grid cols-4" id="kpis">
            <!-- JS will populate KPI cards -->
          </div>
        </div>

        <!-- Charts -->
        <div class="card">
          <div class="charts">
            <div style="min-height:220px;">
              <canvas id="byModule"></canvas>
            </div>
            <div style="min-height:220px;">
              <canvas id="byPriority"></canvas>
            </div>
            <div style="min-height:220px;">
              <canvas id="byStatus"></canvas>
            </div>
            <div style="min-height:220px;">
              <canvas id="byType"></canvas>
            </div>
          </div>
        </div>

        <!-- Issues table -->
        <div class="card">
          <div class="summary-bar">
            <div>
              <strong>Issues table</strong>
              <div class="muted">
                Click a row for full details ¬∑ sortable columns ¬∑ paging at bottom.
              </div>
            </div>
          </div>

          <div class="table-wrap">
            <table id="issuesTable">
              <thead>
                <tr>
                  <th
                    class="sortable"
                    data-key="id"
                    scope="col"
                  >
                    ID
                  </th>
                  <th
                    class="sortable"
                    data-key="module"
                    scope="col"
                  >
                    Module
                  </th>
                  <th
                    class="sortable"
                    data-key="title"
                    scope="col"
                  >
                    Title
                  </th>
                  <th
                    class="sortable"
                    data-key="priority"
                    scope="col"
                  >
                    Priority
                  </th>
                  <th
                    class="sortable"
                    data-key="status"
                    scope="col"
                  >
                    Status
                  </th>
                  <th
                    class="sortable"
                    data-key="date"
                    scope="col"
                  >
                    Date
                  </th>
                  <th scope="col">Log</th>
                  <th scope="col">File</th>
                </tr>
              </thead>

              <!-- Skeleton while loading -->
              <tbody id="tbodySkeleton">
                <tr>
                  <td colspan="8">
                    <div
                      class="skeleton"
                      style="height:180px;border-radius:12px;"
                    ></div>
                  </td>
                </tr>
              </tbody>

              <!-- Real rows -->
              <tbody id="issuesTbody"></tbody>
            </table>
          </div>

          <div class="table-actions">
            <span id="rowCount" class="muted">No rows</span>

            <div class="pagination">
              <button
                id="firstPage"
                type="button"
                class="chip-btn"
              >
                ¬´ First
              </button>
              <button
                id="prevPage"
                type="button"
                class="chip-btn"
              >
                ‚Äπ Prev
              </button>
              <span id="pageInfo" class="muted">Page 1 / 1</span>
              <button
                id="nextPage"
                type="button"
                class="chip-btn"
              >
                Next ‚Ä∫
              </button>
              <button
                id="lastPage"
                type="button"
                class="chip-btn"
              >
                Last ¬ª
              </button>
            </div>

            <div class="pagination">
              <label class="muted" for="pageSize">Rows</label>
              <select id="pageSize" class="select sm">
                <option value="10">10</option>
                <option value="20" selected>20</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
            </div>
          </div>
        </div>
      </section>

      <!-- Calendar view -->
      <section
        id="calendarView"
        class="view"
        role="tabpanel"
        aria-labelledby="calendarTab"
      >
        <div class="card">
          <div class="summary-bar">
            <div>
              <strong>Change calendar</strong>
              <div class="muted">
                Deployments, releases, maintenance &amp; other events.
              </div>
              <div id="calendarTz" class="muted"></div>
            </div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
              <div class="muted">Filter types:</div>
              <label class="muted" style="display:flex;align-items:center;gap:4px;">
                <input
                  id="eventFilterDeployment"
                  type="checkbox"
                  checked
                />
                <span>Deployment</span>
              </label>
              <label class="muted" style="display:flex;align-items:center;gap:4px;">
                <input
                  id="eventFilterMaintenance"
                  type="checkbox"
                  checked
                />
                <span>Maintenance</span>
              </label>
              <label class="muted" style="display:flex;align-items:center;gap:4px;">
                <input
                  id="eventFilterRelease"
                  type="checkbox"
                  checked
                />
                <span>Release</span>
              </label>
              <label class="muted" style="display:flex;align-items:center;gap:4px;">
                <input
                  id="eventFilterOther"
                  type="checkbox"
                  checked
                />
                <span>Other</span>
              </label>

              <button
                id="addEventBtn"
                type="button"
                class="btn sm primary"
              >
                <span class="icon">‚ûï</span>
                <span>Add event</span>
              </button>
            </div>
          </div>

          <div id="calendar"></div>
        </div>
      </section>

      <!-- Insights / AI view -->
      <section
        id="insightsView"
        class="view"
        role="tabpanel"
        aria-labelledby="insightsTab"
      >
        <!-- AI overview -->
        <div class="card">
          <div class="summary-bar">
            <div>
              <strong>AI Ops overview</strong>
              <div id="aiScopeText" class="muted">
                Analyzing issues‚Ä¶
              </div>
              <div id="aiSignalsText" class="muted"></div>
            </div>
            <div id="aiAnalyzing" class="muted" style="display:none;">
              Crunching patterns‚Ä¶
            </div>
          </div>
        </div>

        <!-- Patterns / labels / trends -->
        <div class="card">
          <div class="grid cols-4">
            <div>
              <h3 class="muted">Recent patterns</h3>
              <ul id="aiPatternsList" class="muted" style="padding-left:18px;margin-top:8px;">
                <li>Waiting for data‚Ä¶</li>
              </ul>
            </div>

            <div>
              <h3 class="muted">Suggested categories</h3>
              <ul id="aiLabelsList" class="muted" style="padding-left:18px;margin-top:8px;">
                <li>Waiting for data‚Ä¶</li>
              </ul>
            </div>

            <div>
              <h3 class="muted">Word trends</h3>
              <ul id="aiTrendsList" class="muted" style="padding-left:18px;margin-top:8px;">
                <li>Waiting for data‚Ä¶</li>
              </ul>
              <ul
                id="aiEmergingStable"
                class="muted"
                style="padding-left:18px;margin-top:8px;"
              >
                <li><strong>Emerging:</strong> ‚Äî</li>
                <li><strong>Stable:</strong> ‚Äî</li>
              </ul>
            </div>

            <div>
              <h3 class="muted">Top risks this week</h3>
              <ul id="aiRisksList" class="muted" style="padding-left:18px;margin-top:8px;">
                <li>Waiting for data‚Ä¶</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Per-module risk insights (full width table) -->
        <div class="card" id="aiModulesCard">
          <div class="summary-bar">
            <div>
              <strong>Per-module risk insights</strong>
              <div class="muted">
                Aggregated risk, open counts and top term by module.
              </div>
            </div>
          </div>
          <div class="divider"></div>
          <div>
            <table>
              <thead>
                <tr>
                  <th>Module</th>
                  <th>Open</th>
                  <th>High</th>
                  <th>Risk (relative)</th>
                  <th>Top term</th>
                </tr>
              </thead>
              <tbody id="aiModulesTableBody">
                <tr>
                  <td colspan="5" class="muted" style="text-align:center;">
                    Waiting for data‚Ä¶
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Triage + Ops cockpit + Incidents -->
        <div class="card">
          <div class="grid cols-4">
            <div>
              <h3 class="muted">Triage queue</h3>
              <ul id="aiTriageList" class="muted" style="padding-left:18px;margin-top:8px;">
                <li>Waiting for data‚Ä¶</li>
              </ul>
            </div>
            <div>
              <h3 class="muted">Ops cockpit</h3>
              <ul id="aiOpsCockpit" class="muted" style="padding-left:18px;margin-top:8px;">
                <li>Waiting for data‚Ä¶</li>
              </ul>
            </div>
            <div>
              <h3 class="muted">Incident-like tickets</h3>
              <ul id="aiIncidentsList" class="muted" style="padding-left:18px;margin-top:8px;">
                <li>Waiting for data‚Ä¶</li>
              </ul>
            </div>
            <div>
              <h3 class="muted">Upcoming risky events</h3>
              <ul id="aiEventsList" class="muted" style="padding-left:18px;margin-top:8px;">
                <li>Waiting for data‚Ä¶</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Clusters -->
        <div class="card">
          <h3 class="muted">Issue clusters</h3>
          <div id="aiClusters" class="muted" style="margin-top:8px;">
            <div class="muted">Waiting for data‚Ä¶</div>
          </div>
        </div>

        <!-- AI query + export -->
        <div class="card">
          <div class="summary-bar">
            <div>
              <strong>AI query DSL</strong>
              <div class="muted">
                Examples: <code>status:open risk&gt;=9 module:payments last:7d</code> or
                <code>missing:priority severity&gt;=3</code>
              </div>
            </div>
            <div style="display:flex;gap:6px;flex-wrap:wrap;">
              <button
                id="aiQueryRun"
                type="button"
                class="btn sm primary"
              >
                Run query
              </button>
              <button
                id="aiQueryApplyFilters"
                type="button"
                class="btn sm ghost"
              >
                Apply as filters
              </button>
              <button
                id="aiQueryExport"
                type="button"
                class="btn sm ghost"
              >
                Export results
              </button>
            </div>
          </div>

          <div class="filter-row" style="margin-top:10px;">
            <label class="muted" for="aiQueryInput">Query</label>
            <input
              id="aiQueryInput"
              class="input"
              type="text"
              placeholder="e.g. status:open module:payments risk>=9 last:7d sort:risk"
            />
          </div>

          <div
            id="aiQueryResults"
            class="muted"
            style="margin-top:10px;font-size:13px;"
          >
            Type a query and hit Enter or ‚ÄúRun query‚Äù.
          </div>
        </div>

        <!-- Release Planner ‚Äì F&B Middle East -->
        <div class="card" id="releasePlannerCard">
          <div class="summary-bar">
            <div>
              <strong>Release Planner ‚Äî F&amp;B Middle East</strong>
              <div class="muted">
                Choose region, environment, modules and tickets. Planner avoids rush hours,
                ME holidays/campaigns and old ‚Äúbomb bug‚Äù tickets.
              </div>
            </div>
            <button
              id="plannerRun"
              type="button"
              class="btn sm primary"
            >
              <span class="icon">‚ö°</span>
              <span>Suggest windows</span>
            </button>
          </div>

          <div class="divider"></div>

          <div class="planner-grid" style="margin-top:10px;">
            <div class="filter-row">
              <label class="muted" for="plannerRegion">Region profile</label>
              <select id="plannerRegion" class="select">
                <option value="gulf" selected>Gulf (KSA / UAE / Qatar)</option>
                <option value="levant">Levant</option>
                <option value="northafrica">North Africa</option>
              </select>
            </div>

            <div class="filter-row">
              <label class="muted" for="plannerEnv">Environment</label>
              <select id="plannerEnv" class="select">
                <option value="Prod">Prod</option>
                <option value="Staging">Staging</option>
                <option value="Dev">Dev</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div class="filter-row">
              <label class="muted" for="plannerReleaseType">Release type</label>
              <select id="plannerReleaseType" class="select">
                <option value="feature" selected>Feature / normal</option>
                <option value="major">Major / risky</option>
                <option value="minor">Minor / patch</option>
              </select>
            </div>

            <div class="filter-row">
              <label class="muted" for="plannerModules">Modules</label>
              <input
                id="plannerModules"
                class="input"
                type="text"
                placeholder="e.g. POS, Payments, Kitchen"
              />
            </div>

            <div class="filter-row">
              <label class="muted" for="plannerTickets">Tickets in scope (optional)</label>
              <input
                id="plannerTickets"
                class="input"
                type="text"
                placeholder="INC-123, INC-456‚Ä¶"
              />
            </div>

            <div class="filter-row">
              <label class="muted" for="plannerDescription">Release description (optional)</label>
              <textarea
                id="plannerDescription"
                class="input"
                rows="2"
                style="border-radius:12px;resize:vertical;"
                placeholder="Short description to match against past bugs (e.g. &quot;new payments flow, QR ordering changes&quot;)"
              ></textarea>
            </div>

            <div class="filter-row">
              <label class="muted" for="plannerHorizon">Look ahead</label>
              <select id="plannerHorizon" class="select">
                <option value="1">Next 24 hours</option>
                <option value="3" selected>Next 3 days</option>
                <option value="5">Next 5 days</option>
                <option value="7">Next 7 days</option>
              </select>
            </div>

            <div class="filter-row">
              <label class="muted" for="plannerSlotsPerDay">Suggestions per day</label>
              <select id="plannerSlotsPerDay" class="select">
                <option value="2">2</option>
                <option value="4" selected>4</option>
                <option value="6">6</option>
              </select>
            </div>
          </div>

          <div
            id="plannerResults"
            class="muted"
            style="margin-top:10px;font-size:12px;"
          >
            No suggestions yet. Set parameters and click ‚ÄúSuggest windows‚Äù.
          </div>
        </div>
      </section>
    </section>
  </main>

  <!-- Issue modal -->
  <div
    id="issueModal"
    class="modal"
    role="dialog"
    aria-modal="true"
    aria-labelledby="modalTitle"
  >
    <div class="modal-content">
      <div class="header">
        <h2 id="modalTitle"></h2>
        <button
          id="modalClose"
          type="button"
          class="modal-close"
          aria-label="Close issue details"
        >
          √ó
        </button>
      </div>
      <div id="modalBody"></div>
      <div class="actions" style="margin-top:10px;">
        <button id="copyId" type="button" class="btn sm">
          Copy ID
        </button>
        <button id="copyLink" type="button" class="btn sm ghost">
          Copy link
        </button>
      </div>
    </div>
  </div>

  <!-- Event modal -->
  <div
    id="eventModal"
    class="modal"
    role="dialog"
    aria-modal="true"
    aria-labelledby="eventModalTitle"
  >
    <div class="modal-content">
      <div class="header">
        <h2 id="eventModalTitle">Add event</h2>
        <button
          id="eventModalClose"
          type="button"
          class="modal-close"
          aria-label="Close event dialog"
        >
          √ó
        </button>
      </div>

      <form id="eventForm">
        <div
          class="grid"
          style="grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;"
        >
          <div class="filter-row">
            <label class="muted" for="eventTitle">Title</label>
            <input id="eventTitle" class="input" type="text" required />
          </div>

          <div class="filter-row">
            <label class="muted" for="eventType">Type</label>
            <select id="eventType" class="select">
              <option>Deployment</option>
              <option>Maintenance</option>
              <option>Release</option>
              <option>Other</option>
            </select>
          </div>

          <div class="filter-row">
            <label class="muted" for="eventEnv">Environment</label>
            <select id="eventEnv" class="select">
              <option value="Prod">Prod</option>
              <option value="Staging">Staging</option>
              <option value="Dev">Dev</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div class="filter-row">
            <label class="muted" for="eventStatus">Change status</label>
            <select id="eventStatus" class="select">
              <option value="Planned">Planned</option>
              <option value="In progress">In progress</option>
              <option value="Completed">Completed</option>
              <option value="Cancelled">Cancelled</option>
            </select>
          </div>

          <div class="filter-row">
            <label class="muted" for="eventOwner">Owner</label>
            <input id="eventOwner" class="input" type="text" />
          </div>

          <div class="filter-row">
            <label class="muted" for="eventModules">Modules</label>
            <input
              id="eventModules"
              class="input"
              type="text"
              placeholder="e.g. POS, Payments"
            />
          </div>

          <div class="filter-row">
            <label class="muted" for="eventImpactType">Impact</label>
            <select id="eventImpactType" class="select">
              <option>No downtime expected</option>
              <option>Customer visible impact</option>
              <option>High risk change</option>
            </select>
          </div>

          <div class="filter-row">
            <label class="muted" for="eventIssueId">Linked issue ID</label>
            <input
              id="eventIssueId"
              class="input"
              type="text"
              placeholder="INC-123‚Ä¶"
            />
          </div>

          <div class="filter-row">
            <label class="muted" for="eventStart">Start</label>
            <input
              id="eventStart"
              class="input"
              type="datetime-local"
              required
            />
          </div>

          <div class="filter-row">
            <label class="muted" for="eventEnd">End</label>
            <input id="eventEnd" class="input" type="datetime-local" />
          </div>

          <div class="filter-row">
            <label class="muted" for="eventAllDay">
              <input
                id="eventAllDay"
                type="checkbox"
              />
              <span>All day</span>
            </label>
          </div>
        </div>

        <div class="filter-row" style="margin-top:10px;">
          <label class="muted" for="eventDescription">Description</label>
          <textarea
            id="eventDescription"
            class="input"
            rows="3"
            style="border-radius:12px;resize:vertical;"
          ></textarea>
        </div>

        <div
          id="eventIssueLinkedInfo"
          class="muted"
          style="margin-top:8px;display:none;font-size:12px;"
        ></div>

        <div class="actions" style="margin-top:12px;display:flex;gap:8px;">
          <button
            id="eventDelete"
            type="button"
            class="btn sm ghost"
            style="margin-right:auto;display:none;"
          >
            Delete
          </button>

          <button
            id="eventCancel"
            type="button"
            class="btn sm ghost"
          >
            Cancel
          </button>
          <button
            id="eventSave"
            type="submit"
            class="btn sm primary"
          >
            Save
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Spinner overlay -->
  <div id="spinner" class="spinner">
    <div class="ring"></div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Libraries -->
  <script
    src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"
    defer
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"
    defer
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"
    defer
  ></script>

  <!-- App JS -->
  <script src="app.js" defer></script>
</body>
</html>
