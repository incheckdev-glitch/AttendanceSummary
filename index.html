<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>InCheck Pro ‚Äì Issues ¬∑ Calendar ¬∑ Release Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="styles.css" />

  <!-- FullCalendar CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/main.min.css"
    rel="stylesheet"
  />
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">IC</div>
      <div class="brand-text">
        <span>InCheck Pro</span>
        <span>Issues ‚Ä¢ Calendar ‚Ä¢ Releases</span>
      </div>
    </div>

    <div class="toolbar">
      <select id="themeSelect" class="select sm" aria-label="Theme">
        <option value="system">System</option>
        <option value="dark">Dark</option>
        <option value="light">Light</option>
      </select>

      <input
        type="color"
        id="accentColor"
        aria-label="Accent color"
      />

      <span id="onlineStatusChip" class="chip online">Online</span>

      <button
        id="shortcutsHelp"
        type="button"
        class="btn sm ghost"
        aria-label="Keyboard shortcuts"
      >
        <span class="icon">‚å®Ô∏è</span>
        <span>Shortcuts</span>
      </button>

      <button
        id="drawerBtn"
        type="button"
        class="btn sm drawer-toggle"
        aria-label="Toggle filters"
        aria-expanded="false"
      >
        <span class="icon">‚ò∞</span>
      </button>
    </div>
  </header>

  <main class="wrap">
    <!-- Sidebar / Filters -->
    <aside id="sidebar" class="sidebar" aria-label="Filters">
      <h3>Filters</h3>
      <div class="filter-group">
        <div class="filter-row">
          <label for="searchInput" class="muted">Search</label>
          <input
            id="searchInput"
            class="input"
            type="search"
            placeholder="Search by ID, title, module, log‚Ä¶"
          />
        </div>

        <div class="filter-row">
          <label for="moduleFilter" class="muted">Module</label>
          <select id="moduleFilter" class="select"></select>
        </div>

        <div class="filter-row">
          <label for="priorityFilter" class="muted">Priority</label>
          <select id="priorityFilter" class="select"></select>
        </div>

        <div class="filter-row">
          <label for="statusFilter" class="muted">Status</label>
          <select id="statusFilter" class="select"></select>
        </div>

        <div class="filter-row">
          <label class="muted" for="startDateFilter">From</label>
          <input id="startDateFilter" type="date" class="input" />
        </div>

        <div class="filter-row">
          <label class="muted" for="endDateFilter">To</label>
          <input id="endDateFilter" type="date" class="input" />
        </div>

        <div class="filter-row">
          <button id="resetBtn" class="btn sm" type="button">Reset filters</button>
        </div>
      </div>

      <div class="divider"></div>

      <div class="filter-group">
        <h3>Sync & status</h3>
        <div class="filter-row">
          <span id="syncIssuesText" class="muted">Issues: ‚Äî</span>
          <span id="syncIssuesDot" class="dot err" aria-hidden="true"></span>
        </div>
        <div class="filter-row">
          <span id="syncEventsText" class="muted">Events: ‚Äî</span>
          <span id="syncEventsDot" class="dot err" aria-hidden="true"></span>
        </div>
        <div class="filter-row">
          <span id="loadingStatus" class="muted"></span>
        </div>
      </div>

      <div class="divider"></div>

      <div class="filter-group">
        <h3>Actions</h3>
        <div class="filter-row">
          <button id="createTicketBtn" type="button" class="btn">
            Create ticket
          </button>
        </div>
        <div class="filter-row">
          <button id="refreshNow" type="button" class="btn ghost">
            Refresh data
          </button>
        </div>
        <div class="filter-row">
          <button id="exportCsv" type="button" class="btn ghost">
            Export CSV
          </button>
        </div>
      </div>

      <div class="divider"></div>

      <div class="filter-group">
        <h3>Active filters</h3>
        <div id="activeFiltersChips" class="filter-chips">
          <span class="muted" style="font-size:11px;">No filters applied.</span>
        </div>
      </div>
    </aside>

    <!-- Main content -->
    <section class="content">
      <!-- Tabs -->
      <nav class="view-tabs" role="tablist" aria-label="Views">
        <button
          id="issuesTab"
          class="view-tab active"
          type="button"
          data-view="issues"
          role="tab"
          aria-selected="true"
        >
          <span class="icon">üìã</span>
          <span>Issues</span>
        </button>
        <button
          id="calendarTab"
          class="view-tab"
          type="button"
          data-view="calendar"
          role="tab"
          aria-selected="false"
        >
          <span class="icon">üìÖ</span>
          <span>Calendar & Releases</span>
        </button>
      </nav>

      <!-- Status line -->
      <div class="statusline">
        <span id="issuesSummaryText" class="muted"></span>
      </div>

      <!-- ISSUES VIEW -->
      <section
        id="issuesView"
        class="view active"
        role="tabpanel"
        aria-labelledby="issuesTab"
      >
        <!-- KPIs & charts -->
        <div class="grid cols-4">
          <!-- KPIs -->
          <div class="card" style="grid-column:span 2;">
            <div class="summary-bar">
              <div>
                <div class="shortcut-chip">
                  Shortcuts: "/" to focus search ‚Ä¢ 1=Issues ‚Ä¢ 2=Calendar
                </div>
              </div>
            </div>
            <div id="kpis" class="grid cols-4" style="margin-top:10px;"></div>
          </div>

          <div class="card">
            <h3 style="margin-top:0;margin-bottom:6px;font-size:13px;">By Module</h3>
            <div style="height:180px;">
              <canvas id="byModule"></canvas>
            </div>
          </div>

          <div class="card">
            <h3 style="margin-top:0;margin-bottom:6px;font-size:13px;">By Priority</h3>
            <div style="height:180px;">
              <canvas id="byPriority"></canvas>
            </div>
          </div>

          <div class="card">
            <h3 style="margin-top:0;margin-bottom:6px;font-size:13px;">By Status</h3>
            <div style="height:180px;">
              <canvas id="byStatus"></canvas>
            </div>
          </div>

          <div class="card">
            <h3 style="margin-top:0;margin-bottom:6px;font-size:13px;">By Type</h3>
            <div style="height:180px;">
              <canvas id="byType"></canvas>
            </div>
          </div>
        </div>

        <!-- Issues table -->
        <div class="card">
          <div class="summary-bar">
            <div>Issues</div>
            <div class="table-actions">
              <span id="rowCount" class="muted"></span>
              <label class="muted" style="display:flex;align-items:center;gap:4px;">
                Page size
                <select id="pageSize" class="select sm">
                  <option value="10">10</option>
                  <option value="20">20</option>
                  <option value="50">50</option>
                </select>
              </label>
              <div class="pagination">
                <button id="firstPage" class="chip-btn" type="button">¬´</button>
                <button id="prevPage" class="chip-btn" type="button">‚Äπ</button>
                <span id="pageInfo" class="muted"></span>
                <button id="nextPage" class="chip-btn" type="button">‚Ä∫</button>
                <button id="lastPage" class="chip-btn" type="button">¬ª</button>
              </div>
            </div>
          </div>

          <div class="table-wrap">
            <table id="issuesTable">
              <thead>
                <tr>
                  <th class="sortable" data-key="id">ID</th>
                  <th class="sortable" data-key="module">Module</th>
                  <th class="sortable" data-key="title">Title</th>
                  <th class="sortable" data-key="priority">Priority</th>
                  <th class="sortable" data-key="status">Status</th>
                  <th class="sortable" data-key="date">Date</th>
                  <th>Log</th>
                  <th>Link</th>
                </tr>
              </thead>
              <tbody id="issuesTbody"></tbody>
            </table>

            <!-- Skeleton placeholder -->
            <div id="tbodySkeleton" style="padding:12px;display:none;">
              <div class="skeleton" style="height:32px;margin-bottom:6px;"></div>
              <div class="skeleton" style="height:32px;margin-bottom:6px;"></div>
              <div class="skeleton" style="height:32px;margin-bottom:6px;"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- CALENDAR + RELEASE PLANNER VIEW (stacked: calendar on top, planner below) -->
      <section
        id="calendarView"
        class="view"
        role="tabpanel"
        aria-labelledby="calendarTab"
      >
        <!-- Calendar card -->
        <div class="card">
          <div class="summary-bar">
            <div>Calendar</div>
            <div id="calendarTz" class="muted"></div>
          </div>

          <div class="filter-chips" style="margin:8px 0 10px;">
            <label class="chip">
              <input
                type="checkbox"
                id="eventFilterDeployment"
                checked
              />
              <span>Deployments</span>
            </label>
            <label class="chip">
              <input
                type="checkbox"
                id="eventFilterMaintenance"
                checked
              />
              <span>Maintenance</span>
            </label>
            <label class="chip">
              <input
                type="checkbox"
                id="eventFilterRelease"
                checked
              />
              <span>Release</span>
            </label>
            <label class="chip">
              <input
                type="checkbox"
                id="eventFilterOther"
                checked
              />
              <span>Other</span>
            </label>
          </div>

          <div id="calendar"></div>

          <div class="summary-bar" style="margin-top:10px;">
            <button id="addEventBtn" type="button" class="btn sm">
              ‚ûï Add event
            </button>
          </div>
        </div>

        <!-- Release Planner card BELOW the calendar -->
        <div class="card" id="releasePlannerCard" style="margin-top:12px;">
          <div class="summary-bar">
            <div>Release Planner ‚Äì F&amp;B / Middle East</div>
          </div>

          <div class="planner-grid" style="margin-top:10px;">
            <div>
              <label for="plannerRegion">Region profile</label>
              <select id="plannerRegion" class="select">
                <option value="gulf">Gulf (KSA / UAE / Qatar)</option>
                <option value="levant">Levant</option>
                <option value="northafrica">North Africa</option>
              </select>
            </div>

            <div>
              <label for="plannerEnv">Environment</label>
              <select id="plannerEnv" class="select">
                <option value="Prod">Prod</option>
                <option value="Staging">Staging</option>
                <option value="Dev">Dev</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div>
              <label for="plannerModules">Modules</label>
              <input
                id="plannerModules"
                class="input"
                type="text"
                placeholder="e.g. Ordering, Payments"
              />
            </div>

            <div>
              <label for="plannerHorizon">Horizon (days)</label>
              <input
                id="plannerHorizon"
                class="input"
                type="number"
                min="1"
                max="30"
                value="7"
              />
            </div>

            <div>
              <label for="plannerReleaseType">Release type</label>
              <select id="plannerReleaseType" class="select">
                <option value="feature">Feature</option>
                <option value="minor">Minor patch</option>
                <option value="major">Major</option>
              </select>
            </div>

            <div>
              <label for="plannerSlotsPerDay">Slots per day</label>
              <input
                id="plannerSlotsPerDay"
                class="input"
                type="number"
                min="1"
                max="8"
                value="4"
              />
            </div>

            <div style="grid-column:1 / -1;">
              <label for="plannerDescription">Release description</label>
              <textarea
                id="plannerDescription"
                class="input"
                placeholder="High-level description of what‚Äôs changing‚Ä¶"
              ></textarea>
            </div>

            <div style="grid-column:1 / -1;">
              <label for="plannerTickets">Tickets in scope</label>
              <select
                id="plannerTickets"
                class="select"
                multiple
                size="5"
              >
                <!-- options are filled by script.js -->
              </select>
              <p class="muted" style="margin-top:4px;">
                The list above follows the current filters and highlights high-risk tickets first.
              </p>
            </div>

            <div style="grid-column:1 / -1;display:flex;gap:8px;flex-wrap:wrap;margin-top:6px;">
              <button id="plannerRun" type="button" class="btn sm primary">
                Compute best windows
              </button>
              <button id="plannerAddEvent" type="button" class="btn sm" disabled>
                Create top suggestion as Release event
              </button>
              <div style="flex:1;"></div>
              <select id="plannerReleasePlan" class="select sm" style="min-width:200px;">
                <option value="">Release plans in horizon‚Ä¶</option>
              </select>
              <button id="plannerAssignBtn" type="button" class="btn sm">
                Assign selected tickets
              </button>
            </div>
          </div>

          <div
            id="plannerResults"
            style="margin-top:10px;font-size:13px;"
          >
            <span class="muted">Run the planner to see suggested windows.</span>
          </div>
        </div>
      </section>
    </section>
  </main>

  <!-- Spinner & Toast -->
  <div id="spinner" class="spinner" aria-hidden="true">
    <div class="ring"></div>
  </div>
  <div id="toast" class="toast" role="status"></div>

  <!-- Issue modal -->
  <div id="issueModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" style="display:none;">
    <div class="modal-content">
      <div class="header">
        <h2 id="modalTitle">Issue</h2>
        <button
          id="modalClose"
          type="button"
          class="modal-close"
          aria-label="Close issue details"
        >
          √ó
        </button>
      </div>
      <div id="modalBody"></div>
      <div class="actions" style="margin-top:10px;">
        <button id="copyId" type="button" class="btn sm">Copy ID</button>
        <button id="copyLink" type="button" class="btn sm ghost">Copy link</button>
      </div>
    </div>
  </div>

  <!-- Event modal -->
  <div id="eventModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="eventModalTitle" style="display:none;">
    <div class="modal-content">
      <div class="header">
        <h2 id="eventModalTitle">Event</h2>
        <button
          id="eventModalClose"
          type="button"
          class="modal-close"
          aria-label="Close event editor"
        >
          √ó
        </button>
      </div>

      <form id="eventForm">
        <div class="grid" style="grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;">
          <div>
            <label class="muted" for="eventTitle">Title</label>
            <input id="eventTitle" class="input" type="text" required />
          </div>
          <div>
            <label class="muted" for="eventType">Type</label>
            <select id="eventType" class="select">
              <option>Deployment</option>
              <option>Maintenance</option>
              <option>Release</option>
              <option>Other</option>
            </select>
          </div>
          <div>
            <label class="muted" for="eventEnv">Environment</label>
            <select id="eventEnv" class="select">
              <option value="Prod">Prod</option>
              <option value="Staging">Staging</option>
              <option value="Dev">Dev</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div>
            <label class="muted" for="eventStatus">Change status</label>
            <select id="eventStatus" class="select">
              <option>Planned</option>
              <option>In progress</option>
              <option>Completed</option>
              <option>Cancelled</option>
            </select>
          </div>
          <div>
            <label class="muted" for="eventOwner">Owner</label>
            <input id="eventOwner" class="input" type="text" />
          </div>
          <div>
            <label class="muted" for="eventModules">Modules</label>
            <input
              id="eventModules"
              class="input"
              type="text"
              placeholder="Comma-separated modules"
            />
          </div>
          <div>
            <label class="muted" for="eventImpactType">Impact</label>
            <select id="eventImpactType" class="select">
              <option>No downtime expected</option>
              <option>Minor customer impact</option>
              <option>High risk change</option>
            </select>
          </div>
          <div>
            <label class="muted" for="eventIssueId">Linked ticket IDs</label>
            <input
              id="eventIssueId"
              class="input"
              type="text"
              placeholder="e.g. INC-123, INC-456"
            />
          </div>
        </div>

        <div style="margin-top:10px;">
          <label class="muted">
            <input id="eventAllDay" type="checkbox" />
            All day
          </label>
        </div>

        <div class="grid" style="grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:6px;">
          <div>
            <label class="muted" for="eventStart">Start</label>
            <input id="eventStart" class="input" type="datetime-local" />
          </div>
          <div>
            <label class="muted" for="eventEnd">End</label>
            <input id="eventEnd" class="input" type="datetime-local" />
          </div>
        </div>

        <div style="margin-top:10px;">
          <label class="muted" for="eventDescription">Description</label>
          <textarea
            id="eventDescription"
            class="input"
            placeholder="Details, runbooks, coordinates with other teams‚Ä¶"
          ></textarea>
        </div>

        <div
          id="eventIssueLinkedInfo"
          class="muted"
          style="margin-top:8px;display:none;font-size:12px;"
        ></div>

        <div class="actions" style="margin-top:10px;">
          <button
            id="eventSave"
            type="submit"
            class="btn primary sm"
          >
            Save
          </button>
          <button
            id="eventCancel"
            type="button"
            class="btn ghost sm"
          >
            Cancel
          </button>
          <button
            id="eventDelete"
            type="button"
            class="btn sm"
            style="margin-left:auto;display:none;"
          >
            Delete
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Libraries + App script (ORDER MATTERS) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js"></script>
  <script src="script.js"></script>
</body>
</html>
