<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>InCheck Pro ‚Äì Issues ¬∑ Calendar ¬∑ Release Planner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css" />

    <!-- FullCalendar CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css"
    />

    <!-- Favicon (optional, avoids 404) -->
    <link rel="icon" href="data:;base64,iVBORw0KGgo=" />

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  </head>
  <body>
    <!-- Header -->
    <header>
      <div class="brand">
        <button
          id="drawerBtn"
          type="button"
          class="btn ghost sm drawer-toggle"
          aria-label="Toggle sidebar"
          aria-expanded="false"
        >
          ‚ò∞
        </button>
        <div class="logo">IC</div>
        <div class="brand-text">
          <span>InCheck Pro</span>
          <span>Issues ¬∑ Releases ¬∑ Calendar</span>
        </div>
      </div>

      <div class="toolbar">
        <div class="statusline">
          <span class="chip">
            <span class="dot" id="syncIssuesDot"></span>
            <span id="syncIssuesText">Issues: never</span>
          </span>
          <span class="chip">
            <span class="dot" id="syncEventsDot"></span>
            <span id="syncEventsText">Events: never</span>
          </span>
          <span class="chip" id="onlineStatusChip">Online</span>
        </div>
      </div>
    </header>

    <main class="wrap">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <section>
          <h3>Filters</h3>
          <div class="filter-group">
            <label>
              <span class="muted">Search</span>
              <input
                id="searchInput"
                class="input sm"
                type="text"
                placeholder="Search text or ID ( / )"
                autocomplete="off"
              />
            </label>

            <label>
              <span class="muted">Module</span>
              <select id="moduleFilter" class="select sm"></select>
            </label>

            <label>
              <span class="muted">Priority</span>
              <select id="priorityFilter" class="select sm"></select>
            </label>

            <label>
              <span class="muted">Status</span>
              <select id="statusFilter" class="select sm"></select>
            </label>

            <div class="filter-row">
              <label>
                <span class="muted">From</span>
                <input
                  id="startDateFilter"
                  type="date"
                  class="input sm"
                />
              </label>
              <label>
                <span class="muted">To</span>
                <input
                  id="endDateFilter"
                  type="date"
                  class="input sm"
                />
              </label>
            </div>

            <button
              id="resetBtn"
              type="button"
              class="btn sm"
              style="margin-top:4px;"
            >
              Reset filters
            </button>
          </div>
        </section>

        <div class="divider"></div>

        <section>
          <h3>Theme</h3>
          <div class="filter-group">
            <label>
              <span class="muted">Mode</span>
              <select id="themeSelect" class="select sm">
                <option value="system">System</option>
                <option value="dark">Dark</option>
                <option value="light">Light</option>
              </select>
            </label>

            <label>
              <span class="muted">Accent color</span>
              <input
                id="accentColor"
                type="color"
                class="input sm"
              />
            </label>
          </div>
        </section>

        <div class="divider"></div>

        <section>
          <h3>Shortcuts</h3>
          <button
            id="shortcutsHelp"
            type="button"
            class="btn sm"
          >
            Keyboard shortcuts
          </button>
          <p class="muted" style="margin-top:4px;font-size:11px;">
            1/2: switch tabs ¬∑ /: search ¬∑ Ctrl+K: AI query box
          </p>
        </section>
      </aside>

      <!-- Main content -->
      <section class="content">
        <!-- Top nav + summary + actions -->
        <div class="card">
          <div class="summary-bar">
            <div style="display:flex;flex-direction:column;gap:4px;">
              <div class="view-tabs" role="tablist" aria-label="Main view">
                <button
                  id="issuesTab"
                  type="button"
                  data-view="issues"
                  class="view-tab active"
                  role="tab"
                  aria-selected="true"
                >
                  <span class="icon">üìã</span>
                  <span>Issues</span>
                </button>
                <button
                  id="calendarTab"
                  type="button"
                  data-view="calendar"
                  class="view-tab"
                  role="tab"
                  aria-selected="false"
                >
                  <span class="icon">üìÜ</span>
                  <span>Calendar &amp; Releases</span>
                </button>
              </div>

              <div id="issuesSummaryText" class="muted">
                Loading issues‚Ä¶
              </div>
              <div id="activeFiltersChips" class="filter-chips"></div>
            </div>

            <div
              style="display:flex;flex-direction:column;align-items:flex-end;gap:4px;"
            >
              <div id="loadingStatus" class="muted"></div>
              <div
                style="display:flex;flex-wrap:wrap;gap:6px;justify-content:flex-end;"
              >
                <button
                  id="createTicketBtn"
                  type="button"
                  class="btn sm primary"
                >
                  + New ticket
                </button>
                <button
                  id="refreshNow"
                  type="button"
                  class="btn sm"
                >
                  ‚Üª Refresh data
                </button>
                <button
                  id="exportCsv"
                  type="button"
                  class="btn sm"
                >
                  ‚á© Export CSV
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Issues view -->
        <section
          id="issuesView"
          class="view active"
          aria-label="Issues view"
        >
          <!-- KPI cards -->
          <div class="card">
            <div id="kpis" class="grid cols-4"></div>
          </div>

          <!-- Charts (4 separate cards: 2 x 2) -->
          <div class="charts">
            <div class="card">
              <div class="summary-bar">
                <div class="muted" style="font-size:11px;">Module distribution</div>
              </div>
              <div style="height:190px;">
                <canvas id="byModule"></canvas>
              </div>
            </div>

            <div class="card">
              <div class="summary-bar">
                <div class="muted" style="font-size:11px;">Priority mix</div>
              </div>
              <div style="height:190px;">
                <canvas id="byPriority"></canvas>
              </div>
            </div>

            <div class="card">
              <div class="summary-bar">
                <div class="muted" style="font-size:11px;">Status breakdown</div>
              </div>
              <div style="height:190px;">
                <canvas id="byStatus"></canvas>
              </div>
            </div>

            <div class="card">
              <div class="summary-bar">
                <div class="muted" style="font-size:11px;">Type / category</div>
              </div>
              <div style="height:190px;">
                <canvas id="byType"></canvas>
              </div>
            </div>
          </div>

          <!-- Issues table -->
          <div class="card">
            <div class="table-wrap">
              <table id="issuesTable">
                <thead>
                  <tr>
                    <th class="sortable" data-key="id">ID</th>
                    <th class="sortable" data-key="module">Module</th>
                    <th class="sortable" data-key="title">Title</th>
                    <th class="sortable" data-key="priority">Priority</th>
                    <th class="sortable" data-key="status">Status</th>
                    <th class="sortable" data-key="date">Date</th>
                    <th>Log</th>
                    <th>Link</th>
                  </tr>
                </thead>

                <!-- Skeleton tbody (shown while loading) -->
                <tbody id="tbodySkeleton">
                  <tr>
                    <td colspan="8">
                      <div class="skeleton" style="height:18px;"></div>
                    </td>
                  </tr>
                  <tr>
                    <td colspan="8">
                      <div class="skeleton" style="height:18px;"></div>
                    </td>
                  </tr>
                  <tr>
                    <td colspan="8">
                      <div class="skeleton" style="height:18px;"></div>
                    </td>
                  </tr>
                </tbody>

                <!-- Actual data tbody -->
                <tbody id="issuesTbody"></tbody>
              </table>
            </div>

            <div class="table-actions">
              <div>
                <span id="rowCount" class="muted">No rows</span>
              </div>
              <div
                style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:flex-end;"
              >
                <label class="muted" style="font-size:11px;">
                  Rows per page
                  <select
                    id="pageSize"
                    class="select sm"
                    style="width:auto;display:inline-block;margin-left:4px;"
                  >
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                  </select>
                </label>

                <div class="pagination">
                  <button
                    id="firstPage"
                    type="button"
                    class="chip-btn"
                  >
                    ‚èÆ
                  </button>
                  <button
                    id="prevPage"
                    type="button"
                    class="chip-btn"
                  >
                    ‚óÄ
                  </button>
                  <span id="pageInfo" class="muted">Page 1 / 1</span>
                  <button
                    id="nextPage"
                    type="button"
                    class="chip-btn"
                  >
                    ‚ñ∂
                  </button>
                  <button
                    id="lastPage"
                    type="button"
                    class="chip-btn"
                  >
                    ‚è≠
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Calendar view -->
        <section
          id="calendarView"
          class="view"
          aria-label="Calendar view"
        >
          <!-- Calendar card with filters on top -->
          <div class="card">
            <div class="summary-bar">
              <div>
                <div style="font-size:13px;font-weight:500;">
                  Change calendar
                </div>
                <div id="calendarTz" class="muted"></div>
              </div>
              <div
                style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;justify-content:flex-end;"
              >
                <span class="shortcut-chip">
                  Click &amp; drag to add an event
                </span>
                <button
                  id="addEventBtn"
                  type="button"
                  class="btn sm primary"
                >
                  + Add event
                </button>
              </div>
            </div>

            <!-- Calendar filters at the TOP of the calendar -->
            <div
              style="display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:6px;flex-wrap:wrap;"
            >
              <div class="muted" style="font-size:11px;">
                Filter by event type:
              </div>
              <div
                style="display:flex;gap:12px;flex-wrap:wrap;font-size:11px;"
              >
                <label class="muted" style="display:flex;align-items:center;gap:4px;">
                  <input
                    type="checkbox"
                    id="eventFilterDeployment"
                    checked
                  />
                  Deployment
                </label>
                <label class="muted" style="display:flex;align-items:center;gap:4px;">
                  <input
                    type="checkbox"
                    id="eventFilterMaintenance"
                    checked
                  />
                  Maintenance
                </label>
                <label class="muted" style="display:flex;align-items:center;gap:4px;">
                  <input
                    type="checkbox"
                    id="eventFilterRelease"
                    checked
                  />
                  Release
                </label>
                <label class="muted" style="display:flex;align-items:center;gap:4px;">
                  <input
                    type="checkbox"
                    id="eventFilterOther"
                    checked
                  />
                  Other
                </label>
              </div>
            </div>

            <div id="calendar"></div>
          </div>

          <!-- Release planner BELOW calendar -->
          <div class="card">
            <div class="summary-bar">
              <div>
                <div style="font-size:13px;font-weight:500;">
                  Release planner ‚Äì F&amp;B / Middle East
                </div>
                <div class="muted" style="font-size:11px;">
                  Suggest safer windows for production changes based on rush
                  hours, bug history and events.
                </div>
              </div>
              <button
                id="plannerRun"
                type="button"
                class="btn sm"
              >
                Run planner
              </button>
            </div>

            <div class="planner-grid" style="margin-bottom:6px;">
              <div>
                <label>
                  <span class="muted">Region</span>
                  <select id="plannerRegion" class="select sm">
                    <option value="gulf">Gulf (KSA / UAE / Qatar)</option>
                    <option value="levant">Levant</option>
                    <option value="northafrica">North Africa</option>
                  </select>
                </label>
              </div>
              <div>
                <label>
                  <span class="muted">Environment</span>
                  <select id="plannerEnv" class="select sm">
                    <option value="Prod">Prod</option>
                    <option value="Staging">Staging</option>
                    <option value="Dev">Dev</option>
                    <option value="Other">Other</option>
                  </select>
                </label>
              </div>
              <div>
                <label>
                  <span class="muted">Modules (optional)</span>
                  <input
                    id="plannerModules"
                    class="input sm"
                    type="text"
                    placeholder="e.g. Payments, Orders"
                  />
                </label>
              </div>
              <div>
                <label>
                  <span class="muted">Horizon (days)</span>
                  <input
                    id="plannerHorizon"
                    class="input sm"
                    type="number"
                    min="1"
                    max="30"
                    value="7"
                  />
                </label>
              </div>
              <div>
                <label>
                  <span class="muted">Release type</span>
                  <select id="plannerReleaseType" class="select sm">
                    <option value="feature">Feature</option>
                    <option value="minor">Minor</option>
                    <option value="major">Major</option>
                  </select>
                </label>
              </div>
            </div>

            <div style="margin-bottom:6px;">
              <label>
                <span class="muted" style="font-size:11px;"
                  >Release notes / description</span
                >
                <textarea
                  id="plannerDescription"
                  class="input"
                  rows="2"
                  placeholder="Short description of this release (e.g. features, risky changes, flags)‚Ä¶"
                ></textarea>
              </label>
            </div>

            <div style="margin-bottom:6px;">
              <label>
                <span class="muted" style="font-size:11px;"
                  >Tickets in scope (multi-select)</span
                >
                <select
                  id="plannerTickets"
                  class="select"
                  multiple
                  size="4"
                ></select>
              </label>
            </div>

            <div
              style="margin-bottom:6px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;"
            >
              <label class="muted" style="font-size:11px;display:flex;align-items:center;gap:4px;">
                Slots per day
                <input
                  id="plannerSlotsPerDay"
                  class="input sm"
                  type="number"
                  min="1"
                  max="8"
                  value="4"
                  style="width:64px;"
                />
              </label>

              <button
                id="plannerAddEvent"
                type="button"
                class="btn sm"
              >
                Add top suggestion as Release event
              </button>

              <div style="flex:1;"></div>

              <label class="muted" style="font-size:11px;">
                Release plan
                <select
                  id="plannerReleasePlan"
                  class="select sm"
                  style="min-width:180px;margin-left:4px;"
                ></select>
              </label>

              <button
                id="plannerAssignBtn"
                type="button"
                class="btn sm"
              >
                Assign tickets to plan
              </button>
            </div>

            <div
              id="plannerResults"
              style="margin-top:4px;font-size:12px;"
            ></div>
          </div>
        </section>
      </section>
    </main>

    <!-- Issue modal -->
    <div
      class="modal"
      id="issueModal"
      aria-hidden="true"
    >
      <div
        class="modal-content"
        role="dialog"
        aria-modal="true"
        aria-labelledby="modalTitle"
      >
        <div class="header">
          <h2 id="modalTitle">Issue</h2>
          <button
            id="modalClose"
            type="button"
            class="modal-close"
            aria-label="Close"
          >
            ‚úï
          </button>
        </div>
        <div id="modalBody"></div>
        <div
          style="margin-top:8px;display:flex;justify-content:space-between;gap:8px;align-items:center;"
        >
          <div style="display:flex;gap:6px;">
            <button
              id="copyId"
              type="button"
              class="btn sm"
            >
              Copy ID
            </button>
            <button
              id="copyLink"
              type="button"
              class="btn sm"
            >
              Copy link
            </button>
          </div>
          <span class="muted" style="font-size:11px;">Esc to close</span>
        </div>
      </div>
    </div>

    <!-- Event modal -->
    <div
      class="modal"
      id="eventModal"
      aria-hidden="true"
    >
      <div
        class="modal-content"
        role="dialog"
        aria-modal="true"
        aria-labelledby="eventModalTitle"
      >
        <div class="header">
          <h2 id="eventModalTitle">Add event</h2>
          <button
            id="eventModalClose"
            type="button"
            class="modal-close"
            aria-label="Close"
          >
            ‚úï
          </button>
        </div>

        <form id="eventForm">
          <div class="filter-group">
            <label>
              <span class="muted">Title</span>
              <input
                id="eventTitle"
                class="input"
                type="text"
                required
              />
            </label>

            <div
              class="grid"
              style="grid-template-columns:repeat(auto-fit,minmax(150px,1fr));margin-top:4px;"
            >
              <label>
                <span class="muted">Type</span>
                <select id="eventType" class="select sm">
                  <option value="Deployment">Deployment</option>
                  <option value="Maintenance">Maintenance</option>
                  <option value="Release">Release</option>
                  <option value="Other">Other</option>
                </select>
              </label>

              <label>
                <span class="muted">Environment</span>
                <select id="eventEnv" class="select sm">
                  <option value="Prod">Prod</option>
                  <option value="Staging">Staging</option>
                  <option value="Dev">Dev</option>
                  <option value="Other">Other</option>
                </select>
              </label>

              <label>
                <span class="muted">Change status</span>
                <select id="eventStatus" class="select sm">
                  <option value="Planned">Planned</option>
                  <option value="In progress">In progress</option>
                  <option value="Completed">Completed</option>
                  <option value="Canceled">Canceled</option>
                </select>
              </label>

              <label>
                <span class="muted">Owner</span>
                <input
                  id="eventOwner"
                  class="input sm"
                  type="text"
                  placeholder="Release owner"
                />
              </label>
            </div>

            <div
              class="grid"
              style="grid-template-columns:repeat(auto-fit,minmax(180px,1fr));margin-top:4px;"
            >
              <label>
                <span class="muted">Modules (comma-separated)</span>
                <input
                  id="eventModules"
                  class="input sm"
                  type="text"
                  placeholder="e.g. POS, Payments"
                />
              </label>

              <label>
                <span class="muted">Impact</span>
                <select id="eventImpactType" class="select sm">
                  <option value="No downtime expected">
                    No downtime expected
                  </option>
                  <option value="Minor risk">
                    Minor risk / partial impact
                  </option>
                  <option value="High risk change">
                    High risk / customer impact
                  </option>
                </select>
              </label>
            </div>

            <div
              class="grid"
              style="grid-template-columns:repeat(auto-fit,minmax(180px,1fr));margin-top:4px;"
            >
              <label>
                <span class="muted">Start</span>
                <input
                  id="eventStart"
                  type="datetime-local"
                  class="input sm"
                />
              </label>
              <label>
                <span class="muted">End</span>
                <input
                  id="eventEnd"
                  type="datetime-local"
                  class="input sm"
                />
              </label>
              <label
                style="display:flex;align-items:center;gap:6px;margin-top:18px;"
              >
                <input
                  id="eventAllDay"
                  type="checkbox"
                />
                <span class="muted" style="font-size:11px;">All day</span>
              </label>
            </div>

            <label style="margin-top:4px;">
              <span class="muted">Linked ticket IDs (comma-separated)</span>
              <input
                id="eventIssueId"
                class="input sm"
                type="text"
                placeholder="e.g. INC-123, INC-456"
              />
            </label>
            <div
              id="eventIssueLinkedInfo"
              class="muted"
              style="font-size:11px;margin-top:2px;display:none;"
            ></div>

            <label style="margin-top:4px;">
              <span class="muted">Description / notes</span>
              <textarea
                id="eventDescription"
                class="input"
                rows="3"
              ></textarea>
            </label>
          </div>
        </form>

        <div
          style="margin-top:8px;display:flex;justify-content:space-between;gap:8px;align-items:center;"
        >
          <div style="display:flex;gap:6px;">
            <button
              id="eventSave"
              type="button"
              class="btn sm primary"
            >
              Save
            </button>
            <button
              id="eventCancel"
              type="button"
              class="btn sm"
            >
              Cancel
            </button>
          </div>
          <button
            id="eventDelete"
            type="button"
            class="btn sm"
          >
            Delete
          </button>
        </div>
      </div>
    </div>

    <!-- Spinner -->
    <div class="spinner" id="spinner">
      <div class="ring"></div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Main app script -->
    <script src="script.js"></script>
  </body>
</html>
