<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>InCheck Pro â€“ Issues & Releases</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Libraries (must be before script.js) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="brand">
      <div class="logo">IC</div>
      <div class="brand-text">
        <span>InCheck Pro</span>
        <span>Issues Â· Ops Â· Releases</span>
      </div>
    </div>

    <button id="drawerBtn" class="btn sm drawer-toggle" aria-expanded="false">
      <span class="icon">â˜°</span> Filters
    </button>

    <div class="statusline">
      <span class="chip">
        <span class="dot ok" id="syncIssuesDot"></span>
        <span id="syncIssuesText">Issues: â€”</span>
      </span>
      <span class="chip">
        <span class="dot ok" id="syncEventsDot"></span>
        <span id="syncEventsText">Events: â€”</span>
      </span>
      <span class="chip online" id="onlineStatusChip">Online</span>
    </div>

    <div class="toolbar">
      <select id="themeSelect" class="select sm" aria-label="Theme">
        <option value="system">System</option>
        <option value="dark">Dark</option>
        <option value="light">Light</option>
      </select>
      <input type="color" id="accentColor" aria-label="Accent color" />
      <span id="loadingStatus" class="shortcut-chip"></span>
    </div>
  </header>

  <main class="wrap">
    <!-- Sidebar: filters + event filters + status -->
    <aside class="sidebar" id="sidebar">
      <h3>Issue filters</h3>
      <div class="filter-group">
        <div class="filter-row">
          <span class="muted">Module</span>
          <select id="moduleFilter" class="select">
            <option value="All">All</option>
          </select>
        </div>
        <div class="filter-row">
          <span class="muted">Priority</span>
          <select id="priorityFilter" class="select">
            <option value="All">All</option>
          </select>
        </div>
        <div class="filter-row">
          <span class="muted">Status</span>
          <select id="statusFilter" class="select">
            <option value="All">All</option>
          </select>
        </div>
        <div class="filter-row">
          <span class="muted">Date range</span>
          <input type="date" id="startDateFilter" class="input" />
          <input type="date" id="endDateFilter" class="input" />
        </div>
      </div>

      <button id="resetBtn" class="btn sm" type="button">Reset filters</button>

      <div class="divider"></div>

      <h3>Calendar filters</h3>
      <div class="filter-group">
        <label class="muted">
          <input type="checkbox" id="eventFilterDeployment" checked />
          Deployment
        </label>
        <label class="muted">
          <input type="checkbox" id="eventFilterMaintenance" checked />
          Maintenance
        </label>
        <label class="muted">
          <input type="checkbox" id="eventFilterRelease" checked />
          Release
        </label>
        <label class="muted">
          <input type="checkbox" id="eventFilterOther" checked />
          Other
        </label>
      </div>
    </aside>

    <!-- Main content -->
    <section class="content">
      <!-- View tabs -->
      <div class="view-tabs" role="tablist" aria-label="Views">
        <button
          id="issuesTab"
          class="view-tab active"
          data-view="issues"
          role="tab"
          aria-selected="true"
        >
          <span class="icon">ðŸ“‹</span> Issues
        </button>
        <button
          id="calendarTab"
          class="view-tab"
          data-view="calendar"
          role="tab"
          aria-selected="false"
        >
          <span class="icon">ðŸ“…</span> Calendar &amp; releases
        </button>
      </div>

      <!-- ISSUES VIEW -->
      <div id="issuesView" class="view active" role="tabpanel" aria-labelledby="issuesTab">
        <!-- Summary + actions -->
        <div class="card">
          <div class="summary-bar">
            <div>
              <div id="issuesSummaryText" class="muted">Loading issuesâ€¦</div>
              <div id="activeFiltersChips" class="filter-chips"></div>
            </div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
              <input
                id="searchInput"
                class="input sm"
                type="search"
                placeholder="Search ID, title, logsâ€¦"
                aria-label="Search issues"
              />
              <button id="createTicketBtn" class="btn primary sm" type="button">
                + New ticket
              </button>
              <button id="refreshNow" class="btn sm" type="button">
                â†» Refresh data
              </button>
              <button id="exportCsv" class="btn sm" type="button">
                â‡© Export CSV
              </button>
              <button id="shortcutsHelp" class="btn ghost sm" type="button" title="Keyboard shortcuts">
                ?
              </button>
            </div>
          </div>
        </div>

        <!-- KPIs (filled by JS) -->
        <div id="kpis" class="grid cols-4"></div>

        <!-- Charts: 4 separate cards, 2Ã—2 -->
        <div class="charts">
          <div class="card">
            <div class="summary-bar">
              <span class="shortcut-chip">Issues by module</span>
            </div>
            <div style="height:220px;">
              <canvas id="byModule"></canvas>
            </div>
          </div>
          <div class="card">
            <div class="summary-bar">
              <span class="shortcut-chip">Issues by priority</span>
            </div>
            <div style="height:220px;">
              <canvas id="byPriority"></canvas>
            </div>
          </div>
          <div class="card">
            <div class="summary-bar">
              <span class="shortcut-chip">Issues by status</span>
            </div>
            <div style="height:220px;">
              <canvas id="byStatus"></canvas>
            </div>
          </div>
          <div class="card">
            <div class="summary-bar">
              <span class="shortcut-chip">Issues by type</span>
            </div>
            <div style="height:220px;">
              <canvas id="byType"></canvas>
            </div>
          </div>
        </div>

        <!-- Issues table -->
        <div class="card">
          <div class="table-wrap">
            <table id="issuesTable">
              <thead>
                <tr>
                  <th class="sortable" data-key="id">ID</th>
                  <th class="sortable" data-key="module">Module</th>
                  <th class="sortable" data-key="title">Title</th>
                  <th class="sortable" data-key="priority">Priority</th>
                  <th class="sortable" data-key="status">Status</th>
                  <th class="sortable" data-key="date">Date</th>
                  <th>Log</th>
                  <th>Link</th>
                </tr>
              </thead>

              <!-- loading skeleton tbody -->
              <tbody id="tbodySkeleton">
                <tr>
                  <td colspan="8">
                    <div class="skeleton" style="height:28px;"></div>
                  </td>
                </tr>
                <tr>
                  <td colspan="8">
                    <div class="skeleton" style="height:28px;"></div>
                  </td>
                </tr>
                <tr>
                  <td colspan="8">
                    <div class="skeleton" style="height:28px;"></div>
                  </td>
                </tr>
              </tbody>

              <!-- real rows go here -->
              <tbody id="issuesTbody"></tbody>
            </table>
          </div>

          <div class="table-actions">
            <div id="rowCount" class="muted">No rows</div>
            <div class="pagination">
              <label class="muted" style="display:flex;align-items:center;gap:4px;">
                Rows
                <select id="pageSize" class="select sm">
                  <option value="10">10</option>
                  <option value="20">20</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                </select>
              </label>
              <button id="firstPage" class="chip-btn" type="button">Â« First</button>
              <button id="prevPage" class="chip-btn" type="button">â€¹ Prev</button>
              <span id="pageInfo" class="muted">Page 1 / 1</span>
              <button id="nextPage" class="chip-btn" type="button">Next â€º</button>
              <button id="lastPage" class="chip-btn" type="button">Last Â»</button>
            </div>
          </div>
        </div>
      </div>

      <!-- CALENDAR VIEW -->
      <div id="calendarView" class="view" role="tabpanel" aria-labelledby="calendarTab">
        <!-- Calendar header -->
        <div class="card">
          <div class="summary-bar">
            <div>
              <div class="muted">Release calendar &amp; change risk</div>
              <div id="calendarTz" class="muted"></div>
            </div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
              <button id="addEventBtn" class="btn primary sm" type="button">
                + Add event
              </button>
            </div>
          </div>
        </div>

        <!-- Calendar itself -->
        <div class="card">
          <div id="calendar"></div>
        </div>

        <!-- Release Planner card (below calendar) -->
        <div class="card" id="releasePlannerCard">
          <div class="summary-bar">
            <div>
              <span class="shortcut-chip">Release planner â€“ F&amp;B Middle East</span>
            </div>
          </div>

          <!-- Planner form -->
          <div class="planner-grid" style="margin-top:8px;">
            <div>
              <label for="plannerRegion">Region profile</label>
              <select id="plannerRegion" class="select">
                <option value="gulf">Gulf (KSA / UAE / Qatar)</option>
                <option value="levant">Levant</option>
                <option value="northafrica">North Africa</option>
              </select>
            </div>
            <div>
              <label for="plannerEnv">Environment</label>
              <select id="plannerEnv" class="select">
                <option value="Prod">Prod</option>
                <option value="Staging">Staging</option>
                <option value="Dev">Dev</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div>
              <label for="plannerModules">Modules in scope</label>
              <input
                id="plannerModules"
                class="input"
                type="text"
                placeholder="e.g. POS, Payments"
              />
            </div>
            <div>
              <label for="plannerHorizon">Horizon (days)</label>
              <input
                id="plannerHorizon"
                class="input"
                type="number"
                min="1"
                max="30"
                value="7"
              />
            </div>
            <div>
              <label for="plannerReleaseType">Release type</label>
              <select id="plannerReleaseType" class="select">
                <option value="feature">Feature</option>
                <option value="minor">Minor</option>
                <option value="major">Major</option>
              </select>
            </div>
            <div>
              <label for="plannerSlotsPerDay">Slots per day</label>
              <input
                id="plannerSlotsPerDay"
                class="input"
                type="number"
                min="1"
                max="8"
                value="4"
              />
            </div>
          </div>

          <div style="margin-top:10px;">
            <label for="plannerDescription">Release notes / context</label>
            <textarea
              id="plannerDescription"
              class="input"
              placeholder="Short description of what is being released, constraints, etc."
            ></textarea>
          </div>

          <div style="margin-top:10px;">
            <label for="plannerTickets">Tickets in scope</label>
            <select
              id="plannerTickets"
              class="select"
              multiple
              size="4"
            ></select>
          </div>

          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;">
            <button id="plannerRun" class="btn primary sm" type="button">
              âš™ Run planner
            </button>
            <button id="plannerAddEvent" class="btn sm" type="button">
              âž• Add top suggestion as Release
            </button>
          </div>

          <div style="margin-top:10px;">
            <label for="plannerReleasePlan">Existing Release plans</label>
            <select id="plannerReleasePlan" class="select">
              <option value="">No Release events in horizon</option>
            </select>
          </div>

          <div style="margin-top:10px;">
            <button id="plannerAssignBtn" class="btn sm" type="button">
              Link selected tickets to Release plan
            </button>
          </div>

          <div id="plannerResults" style="margin-top:12px;"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Spinner overlay -->
  <div id="spinner" class="spinner" aria-hidden="true">
    <div class="ring"></div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Issue modal -->
  <div id="issueModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-content">
      <div class="header">
        <h2 id="modalTitle">Issue</h2>
        <button
          id="modalClose"
          class="modal-close"
          type="button"
          aria-label="Close issue details"
        >
          Ã—
        </button>
      </div>
      <div id="modalBody"></div>
      <div class="actions" style="margin-top:10px;">
        <button id="copyId" class="btn sm" type="button">Copy ID</button>
        <button id="copyLink" class="btn sm" type="button">Copy link</button>
      </div>
    </div>
  </div>

  <!-- Event modal -->
  <div id="eventModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="eventModalTitle">
    <div class="modal-content">
      <div class="header">
        <h2 id="eventModalTitle">Add Event</h2>
        <button
          id="eventModalClose"
          class="modal-close"
          type="button"
          aria-label="Close event"
        >
          Ã—
        </button>
      </div>

      <form id="eventForm">
        <div class="filter-group">
          <div class="filter-row">
            <span class="muted">Title</span>
            <input id="eventTitle" class="input" type="text" required />
          </div>
          <div class="filter-row">
            <span class="muted">Type</span>
            <select id="eventType" class="select">
              <option value="Deployment">Deployment</option>
              <option value="Maintenance">Maintenance</option>
              <option value="Release">Release</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="filter-row">
            <span class="muted">Environment</span>
            <select id="eventEnv" class="select">
              <option value="Prod">Prod</option>
              <option value="Staging">Staging</option>
              <option value="Dev">Dev</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="filter-row">
            <span class="muted">Status</span>
            <select id="eventStatus" class="select">
              <option value="Planned">Planned</option>
              <option value="In Progress">In Progress</option>
              <option value="Done">Done</option>
              <option value="Cancelled">Cancelled</option>
            </select>
          </div>
          <div class="filter-row">
            <span class="muted">Owner</span>
            <input id="eventOwner" class="input" type="text" />
          </div>
          <div class="filter-row">
            <span class="muted">Modules</span>
            <input
              id="eventModules"
              class="input"
              type="text"
              placeholder="e.g. POS, Payments"
            />
          </div>
          <div class="filter-row">
            <span class="muted">Impact</span>
            <select id="eventImpactType" class="select">
              <option value="No downtime expected">No downtime expected</option>
              <option value="Minor degradation">Minor degradation</option>
              <option value="High risk change">High risk change</option>
            </select>
          </div>
          <div class="filter-row">
            <span class="muted">Linked ticket IDs</span>
            <input
              id="eventIssueId"
              class="input"
              type="text"
              placeholder="Comma-separated IDs"
            />
            <div
              id="eventIssueLinkedInfo"
              class="muted"
              style="display:none;margin-top:4px;font-size:12px;"
            ></div>
          </div>
          <div class="filter-row">
            <label class="muted" style="display:flex;align-items:center;gap:6px;">
              <input type="checkbox" id="eventAllDay" />
              All-day event
            </label>
          </div>
          <div class="filter-row">
            <span class="muted">Start</span>
            <input id="eventStart" class="input" type="datetime-local" />
          </div>
          <div class="filter-row">
            <span class="muted">End</span>
            <input id="eventEnd" class="input" type="datetime-local" />
          </div>
          <div class="filter-row">
            <span class="muted">Description</span>
            <textarea
              id="eventDescription"
              class="input"
              placeholder="What is this change doing, any constraints, etc."
            ></textarea>
          </div>
        </div>
      </form>

      <div class="actions" style="margin-top:10px;">
        <button id="eventSave" class="btn primary sm" type="button">Save</button>
        <button id="eventCancel" class="btn ghost sm" type="button">Cancel</button>
        <button id="eventDelete" class="btn sm" type="button" style="margin-left:auto;">
          Delete
        </button>
      </div>
    </div>
  </div>

  <!-- Main app script -->
  <script src="script.js"></script>
</body>
</html>
