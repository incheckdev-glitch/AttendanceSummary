<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,viewport-fit=cover"
  />
  <title>InCheck Pro Dashboard — Issues · Calendar</title>

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Vendor libs -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="left">
      <h1 class="app-title">InCheck Pro Dashboard</h1>
      <span id="onlineStatusChip" class="chip muted">Offline</span>
    </div>
    <div class="right">
      <label class="inline">
        Theme
        <select id="themeSelect">
          <option value="system">System</option>
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
      </label>
      <label class="inline">
        Accent
        <input id="accentColor" type="color" value="#4f46e5" />
      </label>
      <button id="refreshNow" class="btn">Reload</button>
    </div>
  </header>

  <nav class="tabs">
    <button id="issuesTab" class="tab active" role="tab" aria-selected="true">Issues</button>
    <button id="calendarTab" class="tab" role="tab" aria-selected="false">Calendar</button>
  </nav>

  <!-- ISSUES VIEW -->
  <main id="issuesView" class="view active" role="tabpanel" aria-labelledby="issuesTab">
    <section class="bar">
      <div class="controls">
        <input id="searchInput" type="search" placeholder="Search (id, title, module, text…)" />
        <select id="moduleFilter"></select>
        <select id="priorityFilter"></select>
        <select id="statusFilter"></select>
        <input id="startDateFilter" type="date" />
        <input id="endDateFilter" type="date" />
        <button id="resetBtn" class="btn ghost">Reset</button>
        <button id="exportCsv" class="btn">Export CSV</button>
      </div>
      <div id="issuesSummaryText" class="muted"></div>
      <div id="activeFiltersChips" class="chips"></div>
    </section>

    <section id="kpis" class="kpis"></section>

    <section class="table-wrap">
      <div class="table-head">
        <div id="rowCount" class="muted"></div>
        <div class="pager">
          <label>Rows
            <select id="pageSize">
              <option>10</option>
              <option>20</option>
              <option>50</option>
              <option>100</option>
            </select>
          </label>
          <button id="firstPage" class="btn sm" aria-label="First page">«</button>
          <button id="prevPage" class="btn sm" aria-label="Previous page">‹</button>
          <span id="pageInfo" class="muted">Page 1 / 1</span>
          <button id="nextPage" class="btn sm" aria-label="Next page">›</button>
          <button id="lastPage" class="btn sm" aria-label="Last page">»</button>
        </div>
      </div>

      <table id="issuesTable" class="table" aria-label="Issues table">
        <thead>
          <tr>
            <th data-key="id">ID</th>
            <th data-key="module">Module</th>
            <th data-key="title">Title</th>
            <th data-key="priority">Priority</th>
            <th data-key="status">Status</th>
            <th data-key="date">Date</th>
            <th data-key="log">Log</th>
            <th>Link</th>
          </tr>
        </thead>
        <tbody id="tbodySkeleton">
          <tr><td colspan="8" class="muted center">Loading…</td></tr>
        </tbody>
        <tbody id="issuesTbody"></tbody>
      </table>
    </section>

    <section class="charts">
      <div class="chart">
        <h3>By Module</h3>
        <canvas id="byModule" height="220"></canvas>
      </div>
      <div class="chart">
        <h3>By Priority</h3>
        <canvas id="byPriority" height="220"></canvas>
      </div>
      <div class="chart">
        <h3>By Status</h3>
        <canvas id="byStatus" height="220"></canvas>
      </div>
      <div class="chart">
        <h3>By Type</h3>
        <canvas id="byType" height="220"></canvas>
      </div>
    </section>
  </main>

  <!-- CALENDAR VIEW -->
  <main id="calendarView" class="view" role="tabpanel" aria-labelledby="calendarTab">
    <section class="bar">
      <div class="controls">
        <button id="addEventBtn" class="btn">Add Event</button>
        <label><input id="eventFilterDeployment" type="checkbox" checked /> Deployment</label>
        <label><input id="eventFilterMaintenance" type="checkbox" checked /> Maintenance</label>
        <label><input id="eventFilterRelease" type="checkbox" checked /> Release</label>
        <label><input id="eventFilterOther" type="checkbox" checked /> Other</label>
      </div>
      <div id="calendarTz" class="muted"></div>
    </section>

    <div id="calendar" class="calendar"></div>
  </main>

  <!-- TOAST + SPINNER -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>
  <div id="spinner" class="spinner" aria-hidden="true">
    <div class="spinner-box">
      <div class="loader"></div>
      <div id="loadingStatus" class="muted">Loading…</div>
      <div class="sync">
        <span id="syncIssuesDot" class="dot"></span><span id="syncIssuesText" class="muted"></span>
        <span class="sep">·</span>
        <span id="syncEventsDot" class="dot"></span><span id="syncEventsText" class="muted"></span>
      </div>
    </div>
  </div>

  <!-- ISSUE MODAL -->
  <div id="issueModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" style="display:none">
    <div class="modal-card">
      <div class="modal-head">
        <h3 id="modalTitle">Issue</h3>
        <button id="modalClose" class="btn ghost">✕</button>
      </div>
      <div id="modalBody" class="modal-body"></div>
      <div class="modal-foot">
        <button id="copyId" class="btn sm">Copy ID</button>
        <button id="copyLink" class="btn sm">Copy Link</button>
      </div>
    </div>
  </div>

  <!-- EVENT MODAL -->
  <div id="eventModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="eventModalTitle" style="display:none">
    <div class="modal-card wide">
      <div class="modal-head">
        <h3 id="eventModalTitle">Add Event</h3>
        <button id="eventModalClose" class="btn ghost">✕</button>
      </div>

      <form id="eventForm" class="form">
        <div class="grid">
          <label>All-day
            <input id="eventAllDay" type="checkbox" />
          </label>

          <label>Title
            <input id="eventTitle" type="text" required />
          </label>

          <label>Type
            <select id="eventType">
              <option>Deployment</option>
              <option>Maintenance</option>
              <option>Release</option>
              <option>Other</option>
            </select>
          </label>

          <label>Environment
            <select id="eventEnv">
              <option>Prod</option>
              <option>Staging</option>
              <option>Dev</option>
              <option>Other</option>
            </select>
          </label>

          <label>Status
            <select id="eventStatus">
              <option>Planned</option>
              <option>Completed</option>
              <option>Cancelled</option>
            </select>
          </label>

          <label>Owner
            <input id="eventOwner" type="text" />
          </label>

          <label>Modules (comma-separated)
            <input id="eventModules" type="text" placeholder="Reporting, Checklist, Mobile App" />
          </label>

          <label>Impact
            <select id="eventImpactType">
              <option>No downtime expected</option>
              <option>Partial degradation</option>
              <option>Full downtime</option>
              <option>Other</option>
            </select>
          </label>

          <label>Linked ticket IDs (comma-separated)
            <input id="eventIssueId" type="text" placeholder="INC-123, INC-456" />
          </label>

          <label>Start
            <input id="eventStart" type="datetime-local" />
          </label>

          <label>End
            <input id="eventEnd" type="datetime-local" />
          </label>
        </div>

        <label>Description
          <textarea id="eventDescription" rows="5"></textarea>
        </label>

        <div id="eventIssueLinkedInfo" class="muted" style="display:none"></div>

        <div class="modal-foot">
          <button id="eventSave" class="btn" type="submit">Save</button>
          <button id="eventCancel" class="btn ghost">Cancel</button>
          <button id="eventDelete" class="btn danger" type="button" style="display:none">Delete</button>
        </div>
      </form>
    </div>
  </div>

  <!-- App -->
  <script src="app.js"></script>
</body>
</html>
