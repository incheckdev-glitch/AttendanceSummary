<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>InCheck Pro – Issues · Ops · Release planner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- App styles -->
    <link rel="stylesheet" href="styles.css" />

    <!-- FullCalendar CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css"
    />

    <!-- Libraries used by script.js -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
  </head>
  <body>
    <!-- Global loading + toast -->
    <div id="spinner" class="spinner-overlay" aria-hidden="true">
      <div class="spinner"></div>
    </div>
    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <!-- Top navbar -->
    <header class="topbar">
      <div class="topbar-left">
        <div class="logo-circle">IC</div>
        <div class="topbar-titles">
          <div class="app-title">InCheck Pro</div>
          <div class="app-subtitle">Issues · Ops · Release planner</div>
        </div>
      </div>

      <div class="topbar-center">
        <div class="search-wrap">
          <input
            id="searchInput"
            type="search"
            placeholder="Search issues (press /)"
            aria-label="Search issues"
          />
        </div>
      </div>

      <div class="topbar-right">
        <div id="onlineStatusChip" class="status-chip">Online</div>

        <label class="theme-select-wrap">
          <span class="theme-label">Theme</span>
          <select id="themeSelect" aria-label="Theme">
            <option value="system">System</option>
            <option value="dark">Dark</option>
            <option value="light">Light</option>
          </select>
        </label>

        <input
          type="color"
          id="accentColor"
          title="Accent colour"
          aria-label="Accent colour"
        />

        <button id="shortcutsHelp" class="btn ghost sm" type="button">
          ? Shortcuts
        </button>
      </div>
    </header>

    <!-- Main shell -->
    <div class="app-shell">
      <!-- Filters sidebar -->
      <aside id="sidebar" class="sidebar">
        <button
          id="drawerBtn"
          class="sidebar-toggle"
          type="button"
          aria-label="Toggle filters"
        >
          ☰
        </button>

        <div class="sidebar-inner">
          <h2 class="sidebar-title">Filters</h2>

          <label class="field">
            <span>Module</span>
            <select id="moduleFilter"></select>
          </label>

          <label class="field">
            <span>Priority</span>
            <select id="priorityFilter"></select>
          </label>

          <label class="field">
            <span>Status</span>
            <select id="statusFilter"></select>
          </label>

          <label class="field">
            <span>From date</span>
            <input
              id="startDateFilter"
              type="date"
              placeholder="dd-----yyyy"
            />
          </label>

          <label class="field">
            <span>To date</span>
            <input id="endDateFilter" type="date" placeholder="dd-----yyyy" />
          </label>

          <button id="resetBtn" class="btn ghost full" type="button">
            Reset filters
          </button>

          <div class="sidebar-help">
            <div>Keyboard:</div>
            <div>1 = Issues, 2 = Calendar</div>
            <div>/ = Search</div>
            <div>Ctrl/Cmd + K = AI query (if enabled)</div>
          </div>

          <div class="sidebar-dataset">
            <div class="dataset-row">
              <span class="dot ok"></span>
              <span id="syncIssuesText">Issues: —</span>
            </div>
            <div class="dataset-row">
              <span class="dot ok"></span>
              <span id="syncEventsText">Events: —</span>
            </div>
          </div>
        </div>
      </aside>

      <!-- Main content -->
      <main class="main">
        <!-- View tabs + actions -->
        <div class="tabs-row">
          <div class="tabs" role="tablist">
            <button
              id="issuesTab"
              class="tab active"
              data-view="issues"
              role="tab"
              aria-selected="true"
            >
              Issues
            </button>
            <button
              id="calendarTab"
              class="tab"
              data-view="calendar"
              role="tab"
              aria-selected="false"
            >
              Calendar &amp; releases
            </button>
          </div>

          <div class="tabs-actions">
            <button
              id="createTicketBtn"
              class="btn primary sm"
              type="button"
            >
              + New ticket
            </button>
            <button id="refreshNow" class="btn ghost sm" type="button">
              ↻ Refresh data
            </button>
            <button id="exportCsv" class="btn ghost sm" type="button">
              ⇩ Export CSV
            </button>
          </div>
        </div>

        <div class="loading-row">
          <span id="loadingStatus" class="loading-status"></span>
        </div>

        <!-- Issues view -->
        <section
          id="issuesView"
          class="view active"
          aria-labelledby="issuesTab"
        >
          <!-- Overview + filters summary -->
          <section class="card">
            <header class="card-header">
              <div>
                <h2 class="card-title">Issues overview</h2>
                <p
                  id="issuesSummaryText"
                  class="card-subtitle"
                >
                  <!-- Filled by script -->
                </p>
              </div>
            </header>
            <div
              id="activeFiltersChips"
              class="filters-chip-row"
            ></div>
          </section>

          <!-- KPI boxes -->
          <section id="kpis" class="kpi-grid">
            <!-- Filled by script.js -->
          </section>

          <!-- 4 charts: 2×2 layout -->
          <section class="charts-grid">
            <article class="card chart-card">
              <header class="card-header">
                <h3 class="card-title">Issues by module</h3>
              </header>
              <div class="chart-body">
                <canvas id="byModule"></canvas>
              </div>
            </article>

            <article class="card chart-card">
              <header class="card-header">
                <h3 class="card-title">Issues by priority</h3>
              </header>
              <div class="chart-body">
                <canvas id="byPriority"></canvas>
              </div>
            </article>

            <article class="card chart-card">
              <header class="card-header">
                <h3 class="card-title">Issues by status</h3>
              </header>
              <div class="chart-body">
                <canvas id="byStatus"></canvas>
              </div>
            </article>

            <article class="card chart-card">
              <header class="card-header">
                <h3 class="card-title">Issues by type</h3>
              </header>
              <div class="chart-body">
                <canvas id="byType"></canvas>
              </div>
            </article>
          </section>

          <!-- Issues table -->
          <section class="card table-card">
            <header class="card-header table-header">
              <div>
                <h3 class="card-title">Issues</h3>
                <p class="card-subtitle">
                  Live feed from InCheck issues sheet.
                </p>
              </div>

              <div class="table-header-right">
                <span id="rowCount" class="table-count">Showing 0</span>

                <label class="field inline">
                  <span>Page size</span>
                  <select id="pageSize">
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                  </select>
                </label>

                <div class="pager">
                  <button
                    id="firstPage"
                    class="btn ghost xs"
                    type="button"
                  >
                    «
                  </button>
                  <button
                    id="prevPage"
                    class="btn ghost xs"
                    type="button"
                  >
                    ‹
                  </button>
                  <span id="pageInfo" class="pager-info">Page 1 / 1</span>
                  <button
                    id="nextPage"
                    class="btn ghost xs"
                    type="button"
                  >
                    ›
                  </button>
                  <button
                    id="lastPage"
                    class="btn ghost xs"
                    type="button"
                  >
                    »
                  </button>
                </div>
              </div>
            </header>

            <div class="table-wrapper">
              <table id="issuesTable">
                <thead>
                  <tr>
                    <th class="sortable" data-key="id">ID</th>
                    <th class="sortable" data-key="module">Module</th>
                    <th class="sortable" data-key="title">Title</th>
                    <th class="sortable" data-key="priority">Priority</th>
                    <th class="sortable" data-key="status">Status</th>
                    <th class="sortable" data-key="date">Date</th>
                    <th>Log</th>
                    <th>Link</th>
                  </tr>
                </thead>
                <tbody id="issuesTbody"></tbody>
                <tbody id="tbodySkeleton" class="skeleton-body">
                  <tr>
                    <td colspan="8">Loading issues…</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </section>

        <!-- Calendar + release planner view -->
        <section
          id="calendarView"
          class="view"
          aria-labelledby="calendarTab"
        >
          <!-- Calendar card -->
          <section class="card">
            <header class="card-header calendar-header">
              <div>
                <h2 class="card-title">Change calendar</h2>
                <p id="calendarTz" class="card-subtitle">
                  Times shown in: —
                </p>
              </div>

              <div class="calendar-header-right">
                <div class="calendar-event-filters">
                  <span class="muted">Event types:</span>
                  <label>
                    <input
                      type="checkbox"
                      id="eventFilterDeployment"
                      checked
                    />
                    Deployment
                  </label>
                  <label>
                    <input
                      type="checkbox"
                      id="eventFilterMaintenance"
                      checked
                    />
                    Maintenance
                  </label>
                  <label>
                    <input
                      type="checkbox"
                      id="eventFilterRelease"
                      checked
                    />
                    Release
                  </label>
                  <label>
                    <input
                      type="checkbox"
                      id="eventFilterOther"
                      checked
                    />
                    Other
                  </label>
                </div>

                <button
                  id="addEventBtn"
                  class="btn primary sm"
                  type="button"
                >
                  + Add event
                </button>
              </div>
            </header>

            <div id="calendar" class="calendar"></div>
          </section>

          <!-- Release planner card (beneath calendar) -->
          <section class="card">
            <header class="card-header">
              <div>
                <h2 class="card-title">
                  Release planner – F&amp;B / Middle East
                </h2>
                <p class="card-subtitle">
                  Suggest safer release windows based on rush hours, bug
                  history &amp; change calendar.
                </p>
              </div>
              <button
                id="plannerRun"
                class="btn primary sm"
                type="button"
              >
                Run planner
              </button>
            </header>

            <div class="planner-grid">
              <div class="planner-col">
                <div class="planner-row">
                  <label class="field">
                    <span>Region</span>
                    <select id="plannerRegion">
                      <option value="gulf">Gulf (KSA / UAE / Qatar)</option>
                      <option value="levant">Levant</option>
                      <option value="northafrica">North Africa</option>
                    </select>
                  </label>

                  <label class="field">
                    <span>Environment</span>
                    <select id="plannerEnv">
                      <option value="Prod">Prod</option>
                      <option value="Staging">Staging</option>
                      <option value="Dev">Dev</option>
                    </select>
                  </label>

                  <label class="field">
                    <span>Horizon (days)</span>
                    <input
                      id="plannerHorizon"
                      type="number"
                      min="1"
                      max="30"
                      value="7"
                    />
                  </label>

                  <label class="field">
                    <span>Release type</span>
                    <select id="plannerReleaseType">
                      <option value="feature">Feature</option>
                      <option value="minor">Minor</option>
                      <option value="major">Major</option>
                    </select>
                  </label>
                </div>

                <label class="field">
                  <span>Modules (optional)</span>
                  <input
                    id="plannerModules"
                    type="text"
                    placeholder="e.g. Payments, Orders"
                  />
                </label>

                <label class="field">
                  <span>Release notes / description</span>
                  <textarea
                    id="plannerDescription"
                    rows="3"
                    placeholder="Short description of this release, expected impact, comms notes…"
                  ></textarea>
                </label>
              </div>

              <div class="planner-col">
                <label class="field">
                  <span>Tickets in scope (multi-select)</span>
                  <select
                    id="plannerTickets"
                    multiple
                    size="8"
                  ></select>
                </label>

                <div class="planner-footer">
                  <label class="field inline">
                    <span>Slots per day</span>
                    <input
                      id="plannerSlotsPerDay"
                      type="number"
                      min="1"
                      max="8"
                      value="4"
                    />
                  </label>

                  <button
                    id="plannerAddEvent"
                    class="btn primary sm"
                    type="button"
                  >
                    Add top suggestion as Release event
                  </button>
                </div>
              </div>
            </div>

            <div
              id="plannerResults"
              class="planner-results"
            ></div>

            <div class="planner-assign-row">
              <label class="field inline">
                <span>Release plan</span>
                <select id="plannerReleasePlan">
                  <option value="">No Release events in horizon</option>
                </select>
              </label>

              <button
                id="plannerAssignBtn"
                class="btn ghost sm"
                type="button"
              >
                Assign tickets to plan
              </button>
            </div>
          </section>
        </section>

        <!-- (Optional) Insights view stub to keep script.js happy -->
        <section id="insightsView" class="view" aria-hidden="true">
          <!-- Intentionally left minimal; AI tab removed from UI -->
        </section>
      </main>
    </div>

    <!-- Issue modal -->
    <div id="issueModal" class="modal" aria-hidden="true">
      <div class="modal-backdrop"></div>
      <div class="modal-panel" role="dialog" aria-modal="true">
        <header class="modal-header">
          <h2 id="modalTitle">Issue</h2>
          <button
            id="modalClose"
            class="modal-close"
            type="button"
            aria-label="Close"
          >
            ✕
          </button>
        </header>
        <div id="modalBody" class="modal-body"></div>
        <footer class="modal-footer">
          <button id="copyId" class="btn ghost sm" type="button">
            Copy ID
          </button>
          <button id="copyLink" class="btn ghost sm" type="button">
            Copy link
          </button>
        </footer>
      </div>
    </div>

    <!-- Event modal -->
    <div id="eventModal" class="modal" aria-hidden="true">
      <div class="modal-backdrop"></div>
      <div class="modal-panel modal-panel-wide" role="dialog" aria-modal="true">
        <header class="modal-header">
          <h2 id="eventModalTitle">Add Event</h2>
          <button
            id="eventModalClose"
            class="modal-close"
            type="button"
            aria-label="Close"
          >
            ✕
          </button>
        </header>

        <form id="eventForm" class="event-form">
          <!-- Title -->
          <div class="event-form-row">
            <label class="field full">
              <span>Title</span>
              <input
                id="eventTitle"
                type="text"
                placeholder="Release / maintenance name"
              />
            </label>
          </div>

          <!-- Type / Env / Status / Owner -->
          <div class="event-form-row">
            <label class="field">
              <span>Type</span>
              <select id="eventType">
                <option value="Deployment">Deployment</option>
                <option value="Maintenance">Maintenance</option>
                <option value="Release">Release</option>
                <option value="Other">Other</option>
              </select>
            </label>

            <label class="field">
              <span>Environment</span>
              <select id="eventEnv">
                <option value="Prod">Prod</option>
                <option value="Staging">Staging</option>
                <option value="Dev">Dev</option>
              </select>
            </label>

            <label class="field">
              <span>Change status</span>
              <select id="eventStatus">
                <option value="Planned">Planned</option>
                <option value="In progress">In progress</option>
                <option value="Completed">Completed</option>
                <option value="Cancelled">Cancelled</option>
              </select>
            </label>

            <label class="field">
              <span>Owner</span>
              <input
                id="eventOwner"
                type="text"
                placeholder="Release owner"
              />
            </label>
          </div>

          <!-- Modules / Impact / Linked tickets -->
          <div class="event-form-row">
            <label class="field">
              <span>Modules (comma-separated)</span>
              <input
                id="eventModules"
                type="text"
                placeholder="e.g. POS, Payments"
              />
            </label>

            <label class="field">
              <span>Impact</span>
              <select id="eventImpactType">
                <option value="No downtime expected">
                  No downtime expected
                </option>
                <option value="Short downtime expected">
                  Short downtime expected
                </option>
                <option value="Customer visible risk">
                  Customer visible risk
                </option>
              </select>
            </label>

            <label class="field">
              <span>Linked ticket ID(s) (comma-separated)</span>
              <input
                id="eventIssueId"
                type="text"
                placeholder="e.g. INC-123, INC-456"
              />
            </label>
          </div>

          <!-- Start / End / All day -->
          <div class="event-form-row">
            <label class="field">
              <span>Start</span>
              <input id="eventStart" type="datetime-local" />
            </label>

            <label class="field">
              <span>End</span>
              <input id="eventEnd" type="datetime-local" />
            </label>

            <label class="field checkbox-field">
              <span>All day</span>
              <input
                id="eventAllDay"
                type="checkbox"
              />
            </label>
          </div>

          <div
            id="eventIssueLinkedInfo"
            class="event-linked-info"
          ></div>

          <div class="event-form-row">
            <label class="field full">
              <span>Description / notes</span>
              <textarea
                id="eventDescription"
                rows="3"
                placeholder="Release / maintenance details, expected impact, comms notes…"
              ></textarea>
            </label>
          </div>
        </form>

        <footer class="modal-footer">
          <button
            id="eventSave"
            class="btn primary"
            type="button"
          >
            Save
          </button>
          <button
            id="eventCancel"
            class="btn ghost"
            type="button"
          >
            Cancel
          </button>
          <button
            id="eventDelete"
            class="btn danger"
            type="button"
          >
            Delete
          </button>
        </footer>
      </div>
    </div>

    <!-- Main app script -->
    <script src="script.js"></script>
  </body>
</html>
