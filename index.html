<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>InCheck Pro Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.css"
    />
  </head>
  <body>
    <div class="app">
      <div class="app-shell">
        <!-- Header -->
        <header class="app-header">
          <div class="app-header-left">
            <button
              id="drawerBtn"
              class="btn ghost sm"
              type="button"
              aria-label="Toggle sidebar"
            >
              ☰
            </button>
            <div>
              <div class="app-title">InCheck Pro Dashboard</div>
              <div class="app-subtitle">Issues · Ops · AI Copilot</div>
            </div>
          </div>
          <div class="app-header-right">
            <span id="onlineStatusChip"></span>
            <div class="theme-controls">
              <select id="themeSelect">
                <option value="system">System</option>
                <option value="dark">Dark</option>
                <option value="light">Light</option>
              </select>
              <input id="accentColor" type="color" />
            </div>
            <button
              id="shortcutsHelp"
              class="btn ghost sm"
              type="button"
              title="Keyboard shortcuts"
            >
              ⌘?
            </button>
          </div>
        </header>

        <!-- Sidebar -->
        <aside id="sidebar">
          <!-- Tabs -->
          <div class="sidebar-header">
            <div class="sidebar-section-title">Navigation</div>
          </div>
          <div class="tabs" role="tablist">
            <button
              id="issuesTab"
              class="tab active"
              type="button"
              data-view="issues"
              role="tab"
              aria-selected="true"
            >
              Issues
            </button>
            <button
              id="calendarTab"
              class="tab"
              type="button"
              data-view="calendar"
              role="tab"
              aria-selected="false"
            >
              Calendar
            </button>
            <button
              id="insightsTab"
              class="tab"
              type="button"
              data-view="insights"
              role="tab"
              aria-selected="false"
            >
              Insights
            </button>
          </div>

          <!-- Sync + actions -->
          <div class="sidebar-panel">
            <div class="sidebar-section-title">Data sync</div>
            <div class="sync-row">
              <div class="sync-line">
                <span id="syncIssuesText">Issues: never</span>
                <span id="syncIssuesDot" class="dot"></span>
              </div>
              <div class="sync-line">
                <span id="syncEventsText">Events: never</span>
                <span id="syncEventsDot" class="dot"></span>
              </div>
            </div>
            <div
              style="
                margin-top: 8px;
                display: flex;
                flex-wrap: wrap;
                gap: 6px;
                align-items: center;
              "
            >
              <button id="refreshNow" class="btn sm" type="button">↻ Refresh</button>
              <button id="exportCsv" class="btn ghost sm" type="button">
                ⇩ Export CSV
              </button>
              <button id="createTicketBtn" class="btn ghost sm" type="button">
                ＋ New ticket
              </button>
            </div>
          </div>

          <!-- Filters -->
          <div class="sidebar-panel">
            <div class="sidebar-section-title">Filters</div>
            <div style="display: flex; flex-direction: column; gap: 6px">
              <input
                id="searchInput"
                type="search"
                placeholder="Search ID, title, description, log…"
              />

              <div style="display: flex; flex-direction: column; gap: 4px">
                <label style="font-size: 11px; color: var(--muted)">
                  Module
                  <select id="moduleFilter"></select>
                </label>
                <label style="font-size: 11px; color: var(--muted)">
                  Priority
                  <select id="priorityFilter"></select>
                </label>
                <label style="font-size: 11px; color: var(--muted)">
                  Status
                  <select id="statusFilter"></select>
                </label>
              </div>

              <div style="display: flex; flex-direction: column; gap: 4px">
                <label style="font-size: 11px; color: var(--muted)">
                  From
                  <input id="startDateFilter" type="date" />
                </label>
                <label style="font-size: 11px; color: var(--muted)">
                  To
                  <input id="endDateFilter" type="date" />
                </label>
              </div>

              <button id="resetBtn" class="btn ghost sm" type="button">
                Clear filters
              </button>
            </div>
          </div>

          <!-- Release Planner (config) -->
          <div class="sidebar-panel">
            <div class="sidebar-section-title">Release planner</div>
            <div style="display: flex; flex-direction: column; gap: 6px">
              <label style="font-size: 11px; color: var(--muted)">
                Region
                <select id="plannerRegion">
                  <option value="gulf">Gulf (KSA / UAE / Qatar)</option>
                  <option value="levant">Levant</option>
                  <option value="northafrica">North Africa</option>
                </select>
              </label>
              <label style="font-size: 11px; color: var(--muted)">
                Environment
                <select id="plannerEnv">
                  <option value="Prod">Prod</option>
                  <option value="Staging">Staging</option>
                  <option value="Dev">Dev</option>
                  <option value="Other">Other</option>
                </select>
              </label>
              <label style="font-size: 11px; color: var(--muted)">
                Modules (comma-separated)
                <input
                  id="plannerModules"
                  type="text"
                  placeholder="POS, Ordering, Payments…"
                />
              </label>
              <label style="font-size: 11px; color: var(--muted)">
                Horizon (days)
                <input
                  id="plannerHorizon"
                  type="number"
                  min="1"
                  max="30"
                  value="7"
                />
              </label>
              <label style="font-size: 11px; color: var(--muted)">
                Release type
                <select id="plannerReleaseType">
                  <option value="feature">Feature</option>
                  <option value="minor">Minor</option>
                  <option value="major">Major</option>
                </select>
              </label>
              <label style="font-size: 11px; color: var(--muted)">
                Slots per day
                <input
                  id="plannerSlotsPerDay"
                  type="number"
                  min="1"
                  max="6"
                  value="3"
                />
              </label>
              <label style="font-size: 11px; color: var(--muted)">
                Release notes / context
                <textarea
                  id="plannerDescription"
                  rows="2"
                  placeholder="Context, risk, modules…"
                ></textarea>
              </label>
              <button id="plannerRun" class="btn sm" type="button">Run planner</button>
              <button
                id="plannerAddEvent"
                class="btn ghost sm"
                type="button"
                disabled
              >
                Use top slot
              </button>
            </div>
          </div>
        </aside>

        <!-- Main -->
        <main class="main">
          <!-- Summary row -->
          <div class="summary-row">
            <span id="issuesSummaryText">0 issues</span>
            <span id="loadingStatus"></span>
          </div>

          <!-- Active filter chips -->
          <div id="activeFiltersChips"></div>

          <!-- Issues View -->
          <section
            id="issuesView"
            class="view active"
            role="tabpanel"
            aria-labelledby="issuesTab"
          >
            <!-- KPIs -->
            <div id="kpis"></div>

            <!-- Page size -->
            <div class="filters-row">
              <div class="filters-row-group"></div>
              <div class="filters-row-group">
                <label style="font-size: 11px; color: var(--muted)">
                  Page size
                  <select id="pageSize">
                    <option value="10">10</option>
                    <option value="20" selected>20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                  </select>
                </label>
              </div>
            </div>

            <!-- Table -->
            <div class="table-wrap">
              <table id="issuesTable" aria-label="Issues table">
                <thead>
                  <tr>
                    <th class="sortable" data-key="id" scope="col">ID</th>
                    <th class="sortable" data-key="module" scope="col">Module</th>
                    <th class="sortable" data-key="title" scope="col">Title</th>
                    <th class="sortable" data-key="priority" scope="col">Priority</th>
                    <th class="sortable" data-key="status" scope="col">Status</th>
                    <th class="sortable" data-key="date" scope="col">Date</th>
                    <th scope="col">Log</th>
                    <th scope="col">Link</th>
                  </tr>
                </thead>
                <tbody id="tbodySkeleton">
                  <tr>
                    <td colspan="8">Loading issues…</td>
                  </tr>
                </tbody>
                <tbody id="issuesTbody"></tbody>
              </table>

              <div class="table-footer">
                <div id="rowCount">No rows</div>
                <div class="pager">
                  <button id="firstPage" class="btn ghost sm" type="button">⏮</button>
                  <button id="prevPage" class="btn ghost sm" type="button">◀</button>
                  <span id="pageInfo">Page 1 / 1</span>
                  <button id="nextPage" class="btn ghost sm" type="button">▶</button>
                  <button id="lastPage" class="btn ghost sm" type="button">⏭</button>
                </div>
              </div>
            </div>

            <!-- Charts -->
            <div
              style="
                display: grid;
                grid-template-columns: 2fr 1.2fr 1.2fr 1.2fr;
                gap: 8px;
                min-height: 180px;
              "
            >
              <div class="card">
                <div class="sidebar-section-title">By module</div>
                <div style="position: relative; height: 160px">
                  <canvas id="byModule"></canvas>
                </div>
              </div>
              <div class="card">
                <div class="sidebar-section-title">By priority</div>
                <div style="position: relative; height: 160px">
                  <canvas id="byPriority"></canvas>
                </div>
              </div>
              <div class="card">
                <div class="sidebar-section-title">By status</div>
                <div style="position: relative; height: 160px">
                  <canvas id="byStatus"></canvas>
                </div>
              </div>
              <div class="card">
                <div class="sidebar-section-title">By type</div>
                <div style="position: relative; height: 160px">
                  <canvas id="byType"></canvas>
                </div>
              </div>
            </div>
          </section>

          <!-- Calendar View -->
          <section
            id="calendarView"
            class="view"
            role="tabpanel"
            aria-labelledby="calendarTab"
          >
            <div
              class="card"
              style="
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                align-items: center;
                justify-content: space-between;
              "
            >
              <div>
                <div class="sidebar-section-title">Change calendar</div>
                <div id="calendarTz" class="muted"></div>
              </div>
              <div
                style="
                  display: flex;
                  flex-wrap: wrap;
                  gap: 6px;
                  align-items: center;
                "
              >
                <label style="font-size: 11px; color: var(--muted)">
                  <input
                    type="checkbox"
                    id="eventFilterDeployment"
                    checked
                  />
                  Deployment
                </label>
                <label style="font-size: 11px; color: var(--muted)">
                  <input
                    type="checkbox"
                    id="eventFilterMaintenance"
                    checked
                  />
                  Maintenance
                </label>
                <label style="font-size: 11px; color: var(--muted)">
                  <input type="checkbox" id="eventFilterRelease" checked />
                  Release
                </label>
                <label style="font-size: 11px; color: var(--muted)">
                  <input type="checkbox" id="eventFilterOther" checked />
                  Other
                </label>
                <button id="addEventBtn" class="btn sm" type="button">
                  ＋ Add event
                </button>
              </div>
            </div>
            <div id="calendar"></div>
          </section>

          <!-- Insights View -->
          <section
            id="insightsView"
            class="view"
            role="tabpanel"
            aria-labelledby="insightsTab"
          >
            <!-- AI Overview -->
            <div class="card">
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  gap: 8px;
                "
              >
                <div>
                  <div class="sidebar-section-title">AI overview</div>
                  <div id="aiScopeText" class="muted">Analyzing 0 issues.</div>
                  <div id="aiSignalsText" class="muted">No signals yet.</div>
                </div>
                <div
                  id="aiAnalyzing"
                  class="muted"
                  style="display: none"
                >
                  Crunching patterns…
                </div>
              </div>
              <div
                style="
                  display: grid;
                  grid-template-columns: 1.4fr 1.4fr 1.7fr;
                  gap: 10px;
                  margin-top: 8px;
                "
              >
                <div>
                  <div class="sidebar-section-title">Patterns</div>
                  <ul id="aiPatternsList"></ul>
                  <div
                    class="sidebar-section-title"
                    style="margin-top: 6px"
                  >
                    Labels
                  </div>
                  <ul id="aiLabelsList"></ul>
                </div>
                <div>
                  <div class="sidebar-section-title">Trends</div>
                  <ul id="aiTrendsList"></ul>
                  <div
                    class="sidebar-section-title"
                    style="margin-top: 6px"
                  >
                    Emerging vs stable
                  </div>
                  <ul id="aiEmergingStable"></ul>
                </div>
                <div>
                  <div class="sidebar-section-title">Modules</div>
                  <div class="table-wrap" style="box-shadow: none">
                    <table
                      style="
                        width: 100%;
                        border-collapse: collapse;
                        font-size: 11px;
                      "
                    >
                      <thead>
                        <tr>
                          <th>Module</th>
                          <th>Open</th>
                          <th>High</th>
                          <th>Risk</th>
                          <th>Top term</th>
                        </tr>
                      </thead>
                      <tbody id="aiModulesTableBody"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Mid row: risks / ops / clusters -->
            <div
              style="
                display: grid;
                grid-template-columns: 1.3fr 1.3fr 1.6fr;
                gap: 10px;
              "
            >
              <div class="card">
                <div class="sidebar-section-title">High-risk issues</div>
                <ul id="aiRisksList"></ul>
                <div
                  class="sidebar-section-title"
                  style="margin-top: 6px"
                >
                  Incidents
                </div>
                <ul id="aiIncidentsList"></ul>
              </div>
              <div class="card">
                <div class="sidebar-section-title">Ops cockpit</div>
                <ul id="aiOpsCockpit"></ul>
                <div
                  class="sidebar-section-title"
                  style="margin-top: 6px"
                >
                  Upcoming risky events
                </div>
                <ul id="aiEventsList"></ul>
              </div>
              <div class="card">
                <div class="sidebar-section-title">
                  Similar-issue clusters
                </div>
                <div
                  id="aiClusters"
                  style="display: flex; flex-direction: column; gap: 6px"
                ></div>
              </div>
            </div>

            <!-- Triage + Query -->
            <div
              style="
                display: grid;
                grid-template-columns: 1.5fr 1.5fr;
                gap: 10px;
              "
            >
              <div class="card">
                <div class="sidebar-section-title">AI triage queue</div>
                <ul id="aiTriageList"></ul>
              </div>
              <div class="card">
                <div class="sidebar-section-title">AI query (DSL)</div>
                <div
                  style="
                    display: flex;
                    flex-direction: column;
                    gap: 6px;
                  "
                >
                  <textarea
                    id="aiQueryInput"
                    rows="3"
                    placeholder="Examples:
status:open risk>=10 last:7d
priority:H Payments timeout
cluster:auth impact>=3"
                  ></textarea>
                  <div
                    style="
                      display: flex;
                      flex-wrap: wrap;
                      gap: 6px;
                    "
                  >
                    <button id="aiQueryRun" class="btn sm" type="button">
                      Run query
                    </button>
                    <button
                      id="aiQueryApplyFilters"
                      class="btn ghost sm"
                      type="button"
                    >
                      Apply as filters
                    </button>
                    <button
                      id="aiQueryExport"
                      class="btn ghost sm"
                      type="button"
                    >
                      Export results
                    </button>
                  </div>
                  <div
                    id="aiQueryResults"
                    class="muted"
                    style="font-size: 12px"
                  ></div>
                </div>
              </div>
            </div>

            <!-- Release planner results + linking -->
            <div
              style="
                display: grid;
                grid-template-columns: 1.4fr 1.6fr;
                gap: 10px;
              "
            >
              <div class="card">
                <div class="sidebar-section-title">
                  Release planner results
                </div>
                <div id="plannerResults"></div>
              </div>
              <div class="card">
                <div class="sidebar-section-title">
                  Attach tickets to a Release
                </div>
                <div
                  style="
                    display: flex;
                    flex-direction: column;
                    gap: 6px;
                  "
                >
                  <label style="font-size: 11px; color: var(--muted)">
                    Release event
                    <select id="plannerReleasePlan"></select>
                  </label>
                  <label style="font-size: 11px; color: var(--muted)">
                    Tickets (current filters)
                    <select
                      id="plannerTickets"
                      multiple
                      size="6"
                    ></select>
                  </label>
                  <button
                    id="plannerAssignBtn"
                    class="btn sm"
                    type="button"
                  >
                    Assign tickets
                  </button>
                </div>
              </div>
            </div>
          </section>
        </main>
      </div>
    </div>

    <!-- Issue modal -->
    <div
      id="issueModal"
      class="modal-backdrop"
      role="dialog"
      aria-modal="true"
      aria-labelledby="modalTitle"
    >
      <div class="modal-panel">
        <div class="modal-header">
          <div class="modal-title" id="modalTitle"></div>
          <button
            id="modalClose"
            type="button"
            class="modal-close-icon"
            aria-label="Close issue"
          >
            ✕
          </button>
        </div>
        <div id="modalBody" class="modal-body"></div>
        <div class="modal-footer">
          <button id="copyId" class="btn ghost sm" type="button">
            Copy ID
          </button>
          <button id="copyLink" class="btn ghost sm" type="button">
            Copy suggestion
          </button>
        </div>
      </div>
    </div>

    <!-- Event modal -->
    <div
      id="eventModal"
      class="modal-backdrop"
      role="dialog"
      aria-modal="true"
      aria-labelledby="eventModalTitle"
    >
      <div class="modal-panel">
        <div class="modal-header">
          <div class="modal-title" id="eventModalTitle">Add event</div>
          <button
            id="eventModalClose"
            type="button"
            class="modal-close-icon"
            aria-label="Close event"
          >
            ✕
          </button>
        </div>
        <form id="eventForm">
          <div class="modal-body">
            <div class="event-form-grid">
              <label style="font-size: 11px; color: var(--muted)">
                Title
                <input id="eventTitle" required />
              </label>
              <label style="font-size: 11px; color: var(--muted)">
                Type
                <select id="eventType">
                  <option>Deployment</option>
                  <option>Maintenance</option>
                  <option>Release</option>
                  <option>Other</option>
                </select>
              </label>
              <label style="font-size: 11px; color: var(--muted)">
                Environment
                <select id="eventEnv">
                  <option>Prod</option>
                  <option>Staging</option>
                  <option>Dev</option>
                  <option>Other</option>
                </select>
              </label>
              <label style="font-size: 11px; color: var(--muted)">
                Status
                <select id="eventStatus">
                  <option>Planned</option>
                  <option>In progress</option>
                  <option>Completed</option>
                  <option>Cancelled</option>
                </select>
              </label>
              <label style="font-size: 11px; color: var(--muted)">
                Owner
                <input id="eventOwner" />
              </label>
              <label style="font-size: 11px; color: var(--muted)">
                Modules (comma-separated)
                <input id="eventModules" />
              </label>
              <label style="font-size: 11px; color: var(--muted)">
                Impact
                <select id="eventImpactType">
                  <option>No downtime expected</option>
                  <option>Minor user impact</option>
                  <option>High risk change</option>
                </select>
              </label>
              <label style="font-size: 11px; color: var(--muted)">
                Linked tickets (IDs)
                <input
                  id="eventIssueId"
                  placeholder="INC-123, INC-456"
                />
              </label>
              <label style="font-size: 11px; color: var(--muted)">
                All day?
                <input id="eventAllDay" type="checkbox" />
              </label>
              <label style="font-size: 11px; color: var(--muted)">
                Start
                <input id="eventStart" type="datetime-local" />
              </label>
              <label style="font-size: 11px; color: var(--muted)">
                End
                <input id="eventEnd" type="datetime-local" />
              </label>
            </div>
            <div
              id="eventIssueLinkedInfo"
              class="muted"
              style="margin-top: 6px; display: none"
            ></div>
            <label
              style="
                font-size: 11px;
                color: var(--muted);
                margin-top: 8px;
                display: block;
              "
            >
              Description
              <textarea id="eventDescription" rows="3"></textarea>
            </label>
          </div>
          <div class="modal-footer">
            <button
              id="eventDelete"
              class="btn ghost sm"
              type="button"
              style="margin-right: auto; display: none"
            >
              Delete
            </button>
            <button
              id="eventCancel"
              class="btn ghost sm"
              type="button"
            >
              Cancel
            </button>
            <button id="eventSave" class="btn sm" type="submit">
              Save
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Spinner & Toast -->
    <div id="spinner">
      <div class="spinner-inner">
        <div class="muted">Loading…</div>
      </div>
    </div>

    <div id="toast"></div>

    <!-- External libs -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

    <!-- Your app -->
    <script src="app.js"></script>
  </body>
</html>
