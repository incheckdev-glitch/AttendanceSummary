<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>InCheck Pro â€“ Issues Â· Ops Â· Release Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="data:," />
  <link rel="stylesheet" href="styles.css" />

  <!-- FullCalendar CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css"
  />

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>

  <!-- App script -->
  <script defer src="script.js"></script>
</head>
<body>
  <!-- Header / top toolbar -->
  <header>
    <div class="brand">
      <div class="logo">IC</div>
      <div class="brand-text">
        <span>InCheck Pro</span>
        <span>Issues Â· Ops Â· Release Planner</span>
      </div>
    </div>

    <div class="toolbar">
      <input
        id="searchInput"
        class="input"
        type="search"
        placeholder="Search issues (/)"
        aria-label="Search issues"
      />

      <input
        id="startDateFilter"
        class="input sm"
        type="date"
        aria-label="Start date filter"
      />
      <input
        id="endDateFilter"
        class="input sm"
        type="date"
        aria-label="End date filter"
      />

      <select id="themeSelect" class="select sm" aria-label="Theme">
        <option value="system">System</option>
        <option value="dark">Dark</option>
        <option value="light">Light</option>
      </select>

      <input
        id="accentColor"
        type="color"
        aria-label="Accent color"
      />

      <button
        id="shortcutsHelp"
        class="btn sm ghost"
        type="button"
        title="Keyboard shortcuts"
      >
        ?
      </button>

      <span id="onlineStatusChip" class="chip online">Online</span>

      <button
        id="drawerBtn"
        class="btn sm ghost drawer-toggle"
        type="button"
        aria-expanded="false"
        aria-controls="sidebar"
      >
        â˜° Filters
      </button>
    </div>
  </header>

  <div class="wrap">
    <!-- Sidebar filters -->
    <aside class="sidebar" id="sidebar">
      <h3>Filters</h3>

      <div class="filter-group">
        <div class="filter-row">
          <span class="muted">Module</span>
          <select id="moduleFilter" class="select">
            <option>All</option>
          </select>
        </div>

        <div class="filter-row">
          <span class="muted">Priority</span>
          <select id="priorityFilter" class="select">
            <option>All</option>
          </select>
        </div>

        <div class="filter-row">
          <span class="muted">Status</span>
          <select id="statusFilter" class="select">
            <option>All</option>
          </select>
        </div>
      </div>

      <div class="filter-group">
        <div class="filter-row">
          <span class="muted">Date range</span>
          <input id="startDateFilter" class="input" type="date" />
          <input id="endDateFilter" class="input" type="date" />
        </div>
      </div>

      <button
        id="resetBtn"
        class="btn sm"
        type="button"
        style="width:100%;margin-top:4px;"
      >
        Reset filters
      </button>

      <div class="divider"></div>

      <h3>Dataset</h3>
      <div class="filter-group">
        <div class="statusline">
          <span id="syncIssuesDot" class="dot err"></span>
          <span id="syncIssuesText" class="chip">Issues: never</span>
        </div>
        <div class="statusline">
          <span id="syncEventsDot" class="dot err"></span>
          <span id="syncEventsText" class="chip">Events: never</span>
        </div>
        <span id="loadingStatus" class="shortcut-chip"></span>
      </div>

      <div class="divider"></div>

      <p class="muted" style="font-size:11px;">
        Keyboard: <kbd>1</kbd> Issues Â· <kbd>2</kbd> Calendar Â·
        <kbd>/</kbd> Search Â· <kbd>Ctrl</kbd>/<kbd>Cmd</kbd> + <kbd>K</kbd> AI query (if enabled).
      </p>
    </aside>

    <!-- Main content -->
    <main class="content">
      <!-- View tabs -->
      <div class="view-tabs" role="tablist" aria-label="Main views">
        <button
          id="issuesTab"
          class="view-tab active"
          data-view="issues"
          role="tab"
          aria-selected="true"
        >
          <span class="icon">ðŸ“‹</span>
          Issues
        </button>
        <button
          id="calendarTab"
          class="view-tab"
          data-view="calendar"
          role="tab"
          aria-selected="false"
        >
          <span class="icon">ðŸ“…</span>
          Calendar &amp; Releases
        </button>
      </div>

      <!-- ISSUES VIEW -->
      <section
        id="issuesView"
        class="view active"
        role="tabpanel"
        aria-labelledby="issuesTab"
      >
        <!-- Summary + actions -->
        <div class="card">
          <div class="summary-bar">
            <div>
              <div class="label">Issues overview</div>
              <div id="issuesSummaryText" class="muted">
                Loading issuesâ€¦
              </div>
            </div>

            <div style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;">
              <button
                id="createTicketBtn"
                class="btn sm primary"
                type="button"
              >
                + New ticket
              </button>
              <button
                id="refreshNow"
                class="btn sm"
                type="button"
              >
                â†» Refresh data
              </button>
              <button
                id="exportCsv"
                class="btn sm"
                type="button"
              >
                â‡© Export CSV
              </button>
            </div>
          </div>

          <div
            id="activeFiltersChips"
            style="margin-top:8px;"
          ></div>
        </div>

        <!-- KPIs + charts â€“ each widget in its own card -->
        <div class="grid cols-4">
          <!-- KPI card -->
          <div class="card">
            <div class="label">Status breakdown</div>
            <div id="kpis" class="grid" style="margin-top:6px;"></div>
          </div>

          <!-- By module -->
          <div class="card">
            <div class="label">Issues by module</div>
            <div style="height:190px;margin-top:6px;">
              <canvas id="byModule" aria-label="Issues by module"></canvas>
            </div>
          </div>

          <!-- By priority -->
          <div class="card">
            <div class="label">Issues by priority</div>
            <div style="height:190px;margin-top:6px;">
              <canvas id="byPriority" aria-label="Issues by priority"></canvas>
            </div>
          </div>

          <!-- By status -->
          <div class="card">
            <div class="label">Issues by status</div>
            <div style="height:190px;margin-top:6px;">
              <canvas id="byStatus" aria-label="Issues by status"></canvas>
            </div>
          </div>
        </div>

        <!-- Extra chart row (by type) -->
        <div class="grid cols-4" style="margin-top:14px;">
          <div class="card">
            <div class="label">Issues by type</div>
            <div style="height:190px;margin-top:6px;">
              <canvas id="byType" aria-label="Issues by type"></canvas>
            </div>
          </div>
        </div>

        <!-- Issues table -->
        <div class="card">
          <div class="table-wrap">
            <table id="issuesTable" aria-label="Issues table">
              <thead>
                <tr>
                  <th
                    class="sortable"
                    data-key="id"
                    scope="col"
                  >
                    ID
                  </th>
                  <th
                    class="sortable"
                    data-key="module"
                    scope="col"
                  >
                    Module
                  </th>
                  <th
                    class="sortable"
                    data-key="title"
                    scope="col"
                  >
                    Title
                  </th>
                  <th
                    class="sortable"
                    data-key="priority"
                    scope="col"
                  >
                    Priority
                  </th>
                  <th
                    class="sortable"
                    data-key="status"
                    scope="col"
                  >
                    Status
                  </th>
                  <th
                    class="sortable"
                    data-key="date"
                    scope="col"
                  >
                    Date
                  </th>
                  <th scope="col">Log / Comment</th>
                  <th scope="col">Link</th>
                </tr>
              </thead>
              <tbody id="tbodySkeleton">
                <tr>
                  <td colspan="8">
                    <div class="skeleton" style="height:32px;"></div>
                  </td>
                </tr>
                <tr>
                  <td colspan="8">
                    <div class="skeleton" style="height:32px;"></div>
                  </td>
                </tr>
                <tr>
                  <td colspan="8">
                    <div class="skeleton" style="height:32px;"></div>
                  </td>
                </tr>
              </tbody>
              <tbody id="issuesTbody"></tbody>
            </table>
          </div>

          <div class="table-actions">
            <div id="rowCount" class="muted">Loadingâ€¦</div>
            <div class="pagination">
              <label style="font-size:12px;">
                Rows:
                <select id="pageSize" class="select sm">
                  <option value="10">10</option>
                  <option value="20">20</option>
                  <option value="50">50</option>
                </select>
              </label>
              <button id="firstPage" class="chip-btn" type="button">Â«</button>
              <button id="prevPage" class="chip-btn" type="button">â€¹</button>
              <span id="pageInfo" class="shortcut-chip">Page 1 / 1</span>
              <button id="nextPage" class="chip-btn" type="button">â€º</button>
              <button id="lastPage" class="chip-btn" type="button">Â»</button>
            </div>
          </div>
        </div>
      </section>

      <!-- CALENDAR VIEW -->
      <section
        id="calendarView"
        class="view"
        role="tabpanel"
        aria-labelledby="calendarTab"
      >
        <!-- Calendar card -->
        <div class="card">
          <div class="summary-bar">
            <div>
              <div class="label">Change calendar</div>
              <div id="calendarTz" class="muted">
                Times shown in local time.
              </div>
            </div>

            <div style="display:flex;flex-wrap:wrap;gap:10px;align-items:center;">
              <div class="muted" style="font-size:12px;">
                Event types:
              </div>
              <label class="muted" style="font-size:12px;">
                <input
                  type="checkbox"
                  id="eventFilterDeployment"
                  checked
                />
                Deployment
              </label>
              <label class="muted" style="font-size:12px;">
                <input
                  type="checkbox"
                  id="eventFilterMaintenance"
                  checked
                />
                Maintenance
              </label>
              <label class="muted" style="font-size:12px;">
                <input
                  type="checkbox"
                  id="eventFilterRelease"
                  checked
                />
                Release
              </label>
              <label class="muted" style="font-size:12px;">
                <input
                  type="checkbox"
                  id="eventFilterOther"
                  checked
                />
                Other
              </label>

              <button
                id="addEventBtn"
                class="btn sm primary"
                type="button"
              >
                + Add event
              </button>
            </div>
          </div>

          <div id="calendar" aria-label="Calendar"></div>
        </div>

        <!-- Release Planner under the calendar -->
        <div class="card" id="releasePlannerCard">
          <div class="summary-bar">
            <div>
              <div class="label">Release planner â€“ F&amp;B / Middle East</div>
              <div class="muted" style="font-size:12px;">
                Select relevant tickets (from the filtered list), then run the planner
                to find safer windows for Gulf / Levant / North Africa service hours.
              </div>
            </div>
            <button
              id="plannerRun"
              class="btn sm primary"
              type="button"
            >
              Run planner
            </button>
          </div>

          <div class="planner-grid" style="margin-top:10px;">
            <div>
              <label for="plannerRegion">Region profile</label>
              <select id="plannerRegion" class="select">
                <option value="gulf">Gulf (KSA / UAE / Qatar)</option>
                <option value="levant">Levant</option>
                <option value="northafrica">North Africa</option>
              </select>
            </div>

            <div>
              <label for="plannerEnv">Environment</label>
              <select id="plannerEnv" class="select">
                <option value="Prod">Prod</option>
                <option value="Staging">Staging</option>
                <option value="Dev">Dev</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div>
              <label for="plannerReleaseType">Release type</label>
              <select id="plannerReleaseType" class="select">
                <option value="feature">Feature</option>
                <option value="minor">Minor / hotfix</option>
                <option value="major">Major release</option>
              </select>
            </div>

            <div>
              <label for="plannerModules">Modules (comma separated)</label>
              <input
                id="plannerModules"
                class="input"
                type="text"
                placeholder="Ordering, Paymentsâ€¦"
              />
            </div>

            <div>
              <label for="plannerHorizon">Horizon (days)</label>
              <input
                id="plannerHorizon"
                class="input"
                type="number"
                min="1"
                max="30"
                value="7"
              />
            </div>

            <div>
              <label for="plannerSlotsPerDay">Slots per day</label>
              <input
                id="plannerSlotsPerDay"
                class="input"
                type="number"
                min="1"
                max="12"
                value="4"
              />
            </div>
          </div>

          <div style="margin-top:10px;">
            <label for="plannerDescription">Release notes / context</label>
            <textarea
              id="plannerDescription"
              class="input"
              placeholder="Short description for this change (optional)"
            ></textarea>
          </div>

          <div style="margin-top:10px;">
            <label for="plannerTickets">Tickets in scope (filtered list)</label>
            <select
              id="plannerTickets"
              class="select"
              multiple
              size="6"
            ></select>
          </div>

          <div
            id="plannerResults"
            class="muted"
            style="margin-top:10px;font-size:12px;"
          >
            Run the planner to see suggested deployment windows.
          </div>

          <div
            style="margin-top:10px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;"
          >
            <button
              id="plannerAddEvent"
              class="btn sm"
              type="button"
            >
              Add top suggestion to calendar
            </button>

            <select
              id="plannerReleasePlan"
              class="select sm"
              style="min-width:220px;"
            >
              <option value="">Select a Release eventâ€¦</option>
            </select>

            <button
              id="plannerAssignBtn"
              class="btn sm"
              type="button"
            >
              Assign selected tickets to Release plan
            </button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Issue details modal -->
  <div class="modal" id="issueModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="header">
        <h2 id="modalTitle">Issue</h2>
        <button
          id="modalClose"
          class="modal-close"
          type="button"
          aria-label="Close"
        >
          Ã—
        </button>
      </div>
      <div id="modalBody"></div>
      <div class="actions" style="margin-top:10px;">
        <button id="copyId" class="btn sm" type="button">Copy ID</button>
        <button id="copyLink" class="btn sm" type="button">Copy link</button>
      </div>
    </div>
  </div>

  <!-- Event modal -->
  <div class="modal" id="eventModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="eventModalTitle">
      <div class="header">
        <h2 id="eventModalTitle">Add event</h2>
        <button
          id="eventModalClose"
          class="modal-close"
          type="button"
          aria-label="Close"
        >
          Ã—
        </button>
      </div>

      <form id="eventForm">
        <div class="grid cols-4">
          <div>
            <label for="eventTitle">Title</label>
            <input id="eventTitle" class="input" type="text" required />
          </div>
          <div>
            <label for="eventType">Type</label>
            <select id="eventType" class="select">
              <option value="Deployment">Deployment</option>
              <option value="Maintenance">Maintenance</option>
              <option value="Release">Release</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div>
            <label for="eventEnv">Environment</label>
            <select id="eventEnv" class="select">
              <option value="Prod">Prod</option>
              <option value="Staging">Staging</option>
              <option value="Dev">Dev</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div>
            <label for="eventStatus">Change status</label>
            <select id="eventStatus" class="select">
              <option value="Planned">Planned</option>
              <option value="In progress">In progress</option>
              <option value="Completed">Completed</option>
              <option value="Cancelled">Cancelled</option>
            </select>
          </div>
          <div>
            <label for="eventOwner">Owner</label>
            <input id="eventOwner" class="input" type="text" />
          </div>
          <div>
            <label for="eventModules">Modules (comma separated)</label>
            <input id="eventModules" class="input" type="text" />
          </div>
          <div>
            <label for="eventImpactType">Impact</label>
            <select id="eventImpactType" class="select">
              <option value="No downtime expected">No downtime expected</option>
              <option value="Minor downtime">Minor downtime</option>
              <option value="Customer-facing downtime">Customer-facing downtime</option>
            </select>
          </div>
          <div>
            <label for="eventIssueId">Linked ticket IDs</label>
            <input
              id="eventIssueId"
              class="input"
              type="text"
              placeholder="Comma-separated IDs"
            />
          </div>
          <div>
            <label for="eventStart">Start</label>
            <input
              id="eventStart"
              class="input"
              type="datetime-local"
            />
          </div>
          <div>
            <label for="eventEnd">End</label>
            <input
              id="eventEnd"
              class="input"
              type="datetime-local"
            />
          </div>
          <div style="display:flex;align-items:center;margin-top:22px;">
            <input
              id="eventAllDay"
              type="checkbox"
              style="margin-right:6px;"
            />
            <label for="eventAllDay" style="font-size:12px;">All day</label>
          </div>
        </div>

        <div style="margin-top:10px;">
          <label for="eventDescription">Description</label>
          <textarea
            id="eventDescription"
            class="input"
            style="min-height:80px;"
          ></textarea>
        </div>

        <div
          id="eventIssueLinkedInfo"
          class="muted"
          style="margin-top:8px;display:none;font-size:12px;"
        ></div>

        <div class="actions" style="margin-top:12px;">
          <button
            id="eventSave"
            class="btn sm primary"
            type="button"
          >
            Save
          </button>
          <button
            id="eventCancel"
            class="btn sm ghost"
            type="button"
          >
            Cancel
          </button>
          <button
            id="eventDelete"
            class="btn sm"
            type="button"
            style="margin-left:auto;display:none;"
          >
            Delete
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Spinner + toast -->
  <div class="spinner" id="spinner">
    <div class="ring"></div>
  </div>
  <div class="toast" id="toast"></div>
</body>
</html>
