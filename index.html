<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>InCheck Pro â€“ Issues Â· Ops Â· Release Planner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- App styles -->
    <link rel="stylesheet" href="styles.css" />

    <!-- FullCalendar -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/main.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/main.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- PapaParse -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  </head>
  <body>
    <header>
      <div class="brand">
        <div class="logo">IC</div>
        <div class="brand-text">
          <span>InCheck Pro</span>
          <span>Issues Â· Ops Â· Release Planner</span>
        </div>
      </div>

      <!-- Global search -->
      <input
        id="searchInput"
        class="input"
        type="search"
        placeholder="Search issues (press /)"
        aria-label="Search issues (press /)"
        style="max-width:320px;width:100%;margin-left:16px;"
      />

      <div class="toolbar">
        <select id="themeSelect" class="select sm" aria-label="Theme">
          <option value="system">System</option>
          <option value="dark">Dark</option>
          <option value="light">Light</option>
        </select>

        <input
          type="color"
          id="accentColor"
          aria-label="Accent color"
        />

        <span id="onlineStatusChip" class="chip online">Online</span>

        <button
          type="button"
          id="shortcutsHelp"
          class="btn ghost sm"
          title="Keyboard shortcuts"
        >
          ? Shortcuts
        </button>

        <div class="statusline">
          <span class="chip" id="syncIssuesText">Issues: â€”</span>
          <span class="dot ok" id="syncIssuesDot"></span>
          <span class="chip" id="syncEventsText">Events: â€”</span>
          <span class="dot ok" id="syncEventsDot"></span>
          <span id="loadingStatus" class="muted"></span>
        </div>

        <button type="button" id="createTicketBtn" class="btn primary sm">
          + New ticket
        </button>
        <button type="button" id="refreshNow" class="btn sm">
          â†» Refresh data
        </button>
        <button type="button" id="exportCsv" class="btn sm">
          â‡© Export CSV
        </button>
      </div>
    </header>

    <div class="wrap">
      <!-- Sidebar filters -->
      <aside class="sidebar" aria-label="Filters">
        <h3>Filters</h3>

        <div class="filter-group">
          <div class="filter-row">
            <label for="moduleFilter">Module</label>
            <select id="moduleFilter" class="select">
              <option>All</option>
            </select>
          </div>

          <div class="filter-row">
            <label for="priorityFilter">Priority</label>
            <select id="priorityFilter" class="select">
              <option>All</option>
            </select>
          </div>

          <div class="filter-row">
            <label for="statusFilter">Status</label>
            <select id="statusFilter" class="select">
              <option>All</option>
            </select>
          </div>
        </div>

        <div class="divider"></div>

        <!-- Single date range (no duplication) -->
        <div class="filter-group">
          <div class="filter-row">
            <label for="startDateFilter">From date</label>
            <input
              type="date"
              id="startDateFilter"
              class="input"
              placeholder="dd-----yyyy"
            />
          </div>

          <div class="filter-row">
            <label for="endDateFilter">To date</label>
            <input
              type="date"
              id="endDateFilter"
              class="input"
              placeholder="dd-----yyyy"
            />
          </div>
        </div>

        <button type="button" id="resetBtn" class="btn sm" style="width:100%;">
          Reset filters
        </button>

        <div class="divider"></div>

        <div class="filter-group">
          <div class="filter-row">
            <label>Dataset</label>
            <div class="muted" style="font-size:12px;">
              <div>
                <span class="dot ok"></span>
                <span id="syncIssuesTextSidebar">Issues: live</span>
              </div>
              <div style="margin-top:4px;">
                <span class="dot ok"></span>
                <span id="syncEventsTextSidebar">Events: live</span>
              </div>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="muted" style="font-size:11px;">
          <div style="margin-bottom:4px;">Keyboard:</div>
          <div>1 = Issues</div>
          <div>2 = Calendar</div>
          <div>/ = Search</div>
        </div>
      </aside>

      <!-- Main content -->
      <main class="content">
        <!-- View tabs -->
        <div
          class="view-tabs"
          role="tablist"
          aria-label="Main views"
          style="margin-bottom:8px;"
        >
          <button
            id="issuesTab"
            class="view-tab active"
            data-view="issues"
            role="tab"
            aria-selected="true"
          >
            <span class="icon">ðŸ“‹</span>
            Issues
          </button>
          <button
            id="calendarTab"
            class="view-tab"
            data-view="calendar"
            role="tab"
            aria-selected="false"
          >
            <span class="icon">ðŸ“†</span>
            Calendar &amp; Releases
          </button>
        </div>

        <!-- ISSUES VIEW (Option B: stacked widgets) -->
        <section
          id="issuesView"
          class="view active"
          aria-label="Issues view"
        >
          <!-- Overview + active filter chips -->
          <div class="card">
            <div class="summary-bar">
              <div>
                <div class="label">Issues overview</div>
                <div
                  id="issuesSummaryText"
                  class="muted"
                  style="margin-top:3px;"
                >
                  Loading issuesâ€¦
                </div>
              </div>
              <div class="shortcut-chip">
                1 = Issues Â· 2 = Calendar Â· / = Search
              </div>
            </div>
            <div
              id="activeFiltersChips"
              class="filter-chips"
              style="margin-top:10px;"
            >
              <span class="muted" style="font-size:11px;"
                >No filters applied.</span
              >
            </div>
          </div>

          <!-- Status breakdown KPIs (own card, full width) -->
          <div class="card">
            <div class="label" style="margin-bottom:6px;">
              Status breakdown
            </div>
            <div id="kpis" class="grid cols-4"></div>
          </div>

          <!-- Issues by module (full width) -->
          <div class="card">
            <div class="label" style="margin-bottom:6px;">
              Issues by module
            </div>
            <div style="height:260px;">
              <canvas id="byModule"></canvas>
            </div>
          </div>

          <!-- Issues by priority (full width) -->
          <div class="card">
            <div class="label" style="margin-bottom:6px;">
              Issues by priority
            </div>
            <div style="height:260px;">
              <canvas id="byPriority"></canvas>
            </div>
          </div>

          <!-- Issues by status (full width) -->
          <div class="card">
            <div class="label" style="margin-bottom:6px;">
              Issues by status
            </div>
            <div style="height:260px;">
              <canvas id="byStatus"></canvas>
            </div>
          </div>

          <!-- Issues table -->
          <div class="card">
            <div class="table-wrap" aria-label="Issues table">
              <table id="issuesTable">
                <thead>
                  <tr>
                    <th
                      class="sortable"
                      data-key="id"
                      scope="col"
                    >
                      ID
                    </th>
                    <th
                      class="sortable"
                      data-key="module"
                      scope="col"
                    >
                      Module
                    </th>
                    <th
                      class="sortable"
                      data-key="title"
                      scope="col"
                    >
                      Title
                    </th>
                    <th
                      class="sortable"
                      data-key="priority"
                      scope="col"
                    >
                      Priority
                    </th>
                    <th
                      class="sortable"
                      data-key="status"
                      scope="col"
                    >
                      Status
                    </th>
                    <th
                      class="sortable"
                      data-key="date"
                      scope="col"
                    >
                      Date
                    </th>
                    <th scope="col">Log</th>
                    <th scope="col">Link</th>
                  </tr>
                </thead>

                <!-- Skeleton while loading -->
                <tbody id="tbodySkeleton">
                  <tr>
                    <td colspan="8">
                      <div class="skeleton" style="height:120px;"></div>
                    </td>
                  </tr>
                </tbody>

                <!-- Real rows -->
                <tbody id="issuesTbody"></tbody>
              </table>
            </div>

            <div class="table-actions">
              <span id="rowCount" class="muted">No rows</span>
              <div class="pagination">
                <label
                  for="pageSize"
                  class="muted"
                  style="margin-right:4px;"
                  >Rows per page:</label
                >
                <select
                  id="pageSize"
                  class="select sm"
                  aria-label="Rows per page"
                >
                  <option value="10">10</option>
                  <option value="20">20</option>
                  <option value="50">50</option>
                </select>

                <button
                  type="button"
                  id="firstPage"
                  class="chip-btn"
                >
                  Â« First
                </button>
                <button
                  type="button"
                  id="prevPage"
                  class="chip-btn"
                >
                  â€¹ Prev
                </button>
                <span
                  id="pageInfo"
                  class="muted"
                  style="min-width:78px;text-align:center;"
                  >Page 1 / 1</span
                >
                <button
                  type="button"
                  id="nextPage"
                  class="chip-btn"
                >
                  Next â€º
                </button>
                <button
                  type="button"
                  id="lastPage"
                  class="chip-btn"
                >
                  Last Â»
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- CALENDAR & RELEASE PLANNER VIEW -->
        <section
          id="calendarView"
          class="view"
          aria-label="Calendar & releases view"
        >
          <!-- Calendar card -->
          <div class="card" id="calendarCard">
            <div class="summary-bar">
              <div>
                <div class="label">Change calendar</div>
                <div
                  id="calendarTz"
                  class="muted"
                  style="margin-top:3px;"
                >
                  Times shown in: â€”
                </div>
              </div>

              <div
                style="
                  display:flex;
                  flex-wrap:wrap;
                  gap:8px;
                  align-items:center;
                  justify-content:flex-end;
                "
              >
                <span class="muted" style="font-size:12px;">Event types:</span>
                <label class="muted" style="font-size:12px;">
                  <input
                    type="checkbox"
                    id="eventFilterDeployment"
                    checked
                  />
                  Deployment
                </label>
                <label class="muted" style="font-size:12px;">
                  <input
                    type="checkbox"
                    id="eventFilterMaintenance"
                    checked
                  />
                  Maintenance
                </label>
                <label class="muted" style="font-size:12px;">
                  <input
                    type="checkbox"
                    id="eventFilterRelease"
                    checked
                  />
                  Release
                </label>
                <label class="muted" style="font-size:12px;">
                  <input
                    type="checkbox"
                    id="eventFilterOther"
                    checked
                  />
                  Other
                </label>

                <button
                  type="button"
                  id="addEventBtn"
                  class="btn primary sm"
                >
                  + Add event
                </button>
              </div>
            </div>

            <div id="calendar"></div>
          </div>

          <!-- Release planner card BELOW the calendar -->
          <div class="card" id="releasePlannerCard">
            <div class="summary-bar" style="margin-bottom:8px;">
              <div>
                <div class="label">
                  Release Planner â€“ F&amp;B Middle East
                </div>
                <div class="muted" style="margin-top:3px;">
                  Suggest safer release windows based on rush hours,
                  holidays and bug pressure.
                </div>
              </div>
              <button
                type="button"
                id="plannerRun"
                class="btn sm"
              >
                Suggest slots
              </button>
            </div>

            <div class="planner-grid">
              <div>
                <label for="plannerRegion">Region profile</label>
                <select
                  id="plannerRegion"
                  class="select"
                >
                  <option value="gulf" selected>
                    Gulf (KSA / UAE / Qatar)
                  </option>
                  <option value="levant">Levant</option>
                  <option value="northafrica">North Africa</option>
                </select>
              </div>

              <div>
                <label for="plannerEnv">Environment</label>
                <select
                  id="plannerEnv"
                  class="select"
                >
                  <option value="Prod" selected>Prod</option>
                  <option value="Staging">Staging</option>
                  <option value="Dev">Dev</option>
                  <option value="Other">Other</option>
                </select>
              </div>

              <div>
                <label for="plannerReleaseType">Release type</label>
                <select
                  id="plannerReleaseType"
                  class="select"
                >
                  <option value="feature" selected>Feature</option>
                  <option value="minor">Minor</option>
                  <option value="major">Major</option>
                </select>
              </div>

              <div>
                <label for="plannerModules">Modules / areas</label>
                <input
                  id="plannerModules"
                  class="input"
                  placeholder="e.g. POS, kitchen, delivery"
                />
              </div>

              <div>
                <label for="plannerHorizon">Horizon (days)</label>
                <input
                  id="plannerHorizon"
                  class="input"
                  type="number"
                  min="1"
                  max="30"
                  value="7"
                />
              </div>

              <div>
                <label for="plannerSlotsPerDay">Slots per day (max)</label>
                <input
                  id="plannerSlotsPerDay"
                  class="input"
                  type="number"
                  min="1"
                  max="8"
                  value="4"
                />
              </div>

              <div style="grid-column:1 / -1;">
                <label for="plannerDescription"
                  >Release notes / context</label
                >
                <textarea
                  id="plannerDescription"
                  class="input"
                  placeholder="Release / maintenance details, expected impact, comms notes..."
                  rows="3"
                ></textarea>
              </div>
            </div>

            <div
              style="
                margin-top:10px;
                display:flex;
                flex-wrap:wrap;
                gap:10px;
                align-items:flex-end;
              "
            >
              <div style="flex:2 1 260px;">
                <label for="plannerTickets">Tickets in scope</label>
                <select
                  id="plannerTickets"
                  class="select"
                  multiple
                  size="4"
                ></select>
              </div>

              <div style="flex:1 1 220px;">
                <label for="plannerReleasePlan">Release event</label>
                <select
                  id="plannerReleasePlan"
                  class="select"
                >
                  <option value="">
                    No Release events in horizon
                  </option>
                </select>
              </div>

              <div
                style="
                  display:flex;
                  flex-direction:column;
                  gap:6px;
                  flex:0 0 170px;
                "
              >
                <button
                  type="button"
                  id="plannerAssignBtn"
                  class="btn sm"
                >
                  Assign to plan
                </button>
                <button
                  type="button"
                  id="plannerAddEvent"
                  class="btn ghost sm"
                >
                  Create top suggestion as event
                </button>
              </div>
            </div>

            <div
              id="plannerResults"
              class="muted"
              style="margin-top:10px;font-size:12px;"
            >
              Run the planner to see suggested windows.
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Issue details modal -->
    <div
      id="issueModal"
      class="modal"
      aria-hidden="true"
      aria-labelledby="modalTitle"
    >
      <div class="modal-content">
        <div class="header">
          <h2 id="modalTitle">Issue</h2>
          <button
            type="button"
            id="modalClose"
            class="modal-close"
            aria-label="Close issue details"
          >
            Ã—
          </button>
        </div>
        <div id="modalBody"></div>
        <div class="actions" style="margin-top:10px;">
          <button
            type="button"
            id="copyId"
            class="btn sm"
          >
            Copy ID
          </button>
          <button
            type="button"
            id="copyLink"
            class="btn ghost sm"
          >
            Copy link
          </button>
        </div>
      </div>
    </div>

    <!-- Add / edit event modal (with improved field layout) -->
    <div
      id="eventModal"
      class="modal"
      aria-hidden="true"
      aria-labelledby="eventModalTitle"
    >
      <div class="modal-content">
        <div class="header">
          <h2 id="eventModalTitle">Add Event</h2>
          <button
            type="button"
            id="eventModalClose"
            class="modal-close"
            aria-label="Close event modal"
          >
            Ã—
          </button>
        </div>

        <form id="eventForm">
          <div class="grid cols-4" style="gap:10px 12px;">
            <!-- Title (full width) -->
            <div
              class="filter-row"
              style="grid-column:1 / -1;"
            >
              <label for="eventTitle">Title</label>
              <input
                id="eventTitle"
                class="input"
                placeholder="Event title"
                required
              />
            </div>

            <!-- Type / Env / Status -->
            <div class="filter-row">
              <label for="eventType">Type</label>
              <select
                id="eventType"
                class="select"
              >
                <option value="Deployment">Deployment</option>
                <option value="Maintenance">Maintenance</option>
                <option value="Release">Release</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div class="filter-row">
              <label for="eventEnv">Environment</label>
              <select
                id="eventEnv"
                class="select"
              >
                <option value="Prod">Prod</option>
                <option value="Staging">Staging</option>
                <option value="Dev">Dev</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div class="filter-row">
              <label for="eventStatus">Change status</label>
              <select
                id="eventStatus"
                class="select"
              >
                <option value="Planned">Planned</option>
                <option value="In progress">In progress</option>
                <option value="Completed">Completed</option>
                <option value="Cancelled">Cancelled</option>
              </select>
            </div>

            <!-- Owner / Modules / Impact -->
            <div class="filter-row">
              <label for="eventOwner">Owner</label>
              <input
                id="eventOwner"
                class="input"
                placeholder="On-call / team"
              />
            </div>

            <div
              class="filter-row"
              style="grid-column:span 2;"
            >
              <label for="eventModules">Modules</label>
              <input
                id="eventModules"
                class="input"
                placeholder="Comma-separated modules"
              />
            </div>

            <div class="filter-row">
              <label for="eventImpactType">Impact</label>
              <select
                id="eventImpactType"
                class="select"
              >
                <option>No downtime expected</option>
                <option>Brief customer impact</option>
                <option>High risk change</option>
                <option>Internal only</option>
              </select>
            </div>

            <!-- Linked ticket IDs -->
            <div
              class="filter-row"
              style="grid-column:span 2;"
            >
              <label for="eventIssueId">Linked ticket ID(s)</label>
              <input
                id="eventIssueId"
                class="input"
                placeholder="e.g. INC-123, INC-456"
              />
              <div
                id="eventIssueLinkedInfo"
                class="muted"
                style="display:none;font-size:11px;margin-top:2px;"
              ></div>
            </div>

            <!-- Start / End / All day -->
            <div class="filter-row">
              <label for="eventStart">Start</label>
              <input
                id="eventStart"
                type="datetime-local"
                class="input"
              />
            </div>

            <div class="filter-row">
              <label for="eventEnd">End</label>
              <input
                id="eventEnd"
                type="datetime-local"
                class="input"
              />
            </div>

            <div
              class="filter-row"
              style="margin-top:20px;"
            >
              <label
                for="eventAllDay"
                style="font-size:11px;text-transform:none;letter-spacing:0;"
              >
                <input
                  type="checkbox"
                  id="eventAllDay"
                  style="margin-right:6px;"
                />
                All day
              </label>
            </div>

            <!-- Description -->
            <div
              class="filter-row"
              style="grid-column:1 / -1;"
            >
              <label for="eventDescription">Description</label>
              <textarea
                id="eventDescription"
                class="input"
                rows="3"
                placeholder="Release / maintenance details, expected impact, comms notes..."
              ></textarea>
            </div>
          </div>
        </form>

        <div class="actions" style="margin-top:10px;">
          <button
            type="button"
            id="eventDelete"
            class="btn ghost sm"
            style="margin-right:auto;display:none;"
          >
            Delete
          </button>

          <button
            type="button"
            id="eventCancel"
            class="btn ghost sm"
          >
            Cancel
          </button>
          <button
            type="button"
            id="eventSave"
            class="btn primary sm"
          >
            Save
          </button>
        </div>
      </div>
    </div>

    <!-- Spinner + toast -->
    <div id="spinner" class="spinner" aria-hidden="true">
      <div class="ring"></div>
    </div>

    <div id="toast" class="toast" role="status"></div>

    <!-- Main app script -->
    <script src="script.js"></script>
  </body>
</html>
