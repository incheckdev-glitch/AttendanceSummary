<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>InCheck Pro ‚Äî Issues ¬∑ Ops ¬∑ AI Copilot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- FullCalendar CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css"
  />

  <!-- App styles -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <a href="#main" class="sr-only">Skip to main content</a>

  <!-- Header / toolbar -->
  <header>
    <div class="brand">
      <div class="logo">IC</div>
      <div class="brand-text">
        <span>INCHECK PRO</span>
        <span>Issues ¬∑ Ops ¬∑ AI Copilot</span>
      </div>
    </div>

    <button
      id="drawerBtn"
      class="btn ghost drawer-toggle"
      aria-label="Toggle filters panel"
      aria-expanded="false"
    >
      <span class="icon">‚ò∞</span>
    </button>

    <div class="toolbar">
      <input
        id="searchInput"
        class="input"
        type="search"
        placeholder="Search issues (/)"
        aria-label="Search issues"
      />

      <select id="themeSelect" class="select" aria-label="Theme">
        <option value="system">System</option>
        <option value="dark">Dark</option>
        <option value="light">Light</option>
      </select>

      <input
        id="accentColor"
        type="color"
        aria-label="Accent color"
      />

      <span id="onlineStatusChip" class="chip online">Online</span>

      <button id="shortcutsHelp" class="btn ghost sm" type="button">
        <span class="icon">‚å®Ô∏è</span>
        Shortcuts
      </button>

      <button id="refreshNow" class="btn sm" type="button">
        <span class="icon">‚ü≥</span>
        Refresh
      </button>

      <button id="exportCsv" class="btn ghost sm" type="button">
        <span class="icon">‚á©</span>
        Export CSV
      </button>

      <button id="createTicketBtn" class="btn primary sm" type="button">
        <span class="icon">Ôºã</span>
        New Ticket
      </button>

      <div class="statusline">
        <span class="dot" id="syncIssuesDot"></span>
        <span id="syncIssuesText" class="shortcut-chip">Issues: never</span>
        <span class="dot" id="syncEventsDot"></span>
        <span id="syncEventsText" class="shortcut-chip">Events: never</span>
        <span id="loadingStatus" class="shortcut-chip"></span>
      </div>
    </div>
  </header>

  <main id="main" class="wrap">
    <!-- Sidebar / Filters -->
    <aside id="sidebar" class="sidebar" aria-label="Filters and tools">
      <section>
        <h3>Filters</h3>
        <div class="filter-group">
          <div class="filter-row">
            <label class="muted" for="moduleFilter">Module</label>
            <select id="moduleFilter" class="select">
              <option>All</option>
            </select>
          </div>
          <div class="filter-row">
            <label class="muted" for="priorityFilter">Priority</label>
            <select id="priorityFilter" class="select">
              <option>All</option>
            </select>
          </div>
          <div class="filter-row">
            <label class="muted" for="statusFilter">Status</label>
            <select id="statusFilter" class="select">
              <option>All</option>
            </select>
          </div>
        </div>

        <div class="filter-group">
          <div class="filter-row">
            <label class="muted" for="startDateFilter">From date</label>
            <input id="startDateFilter" class="input" type="date" />
          </div>
          <div class="filter-row">
            <label class="muted" for="endDateFilter">To date</label>
            <input id="endDateFilter" class="input" type="date" />
          </div>
        </div>

        <button id="resetBtn" type="button" class="btn sm">
          Reset filters
        </button>

        <div class="divider"></div>

        <div class="filter-group">
          <span class="muted">Active filters</span>
          <div id="activeFiltersChips" class="filter-chips"></div>
        </div>
      </section>

      <div class="divider"></div>

      <!-- Small helper text -->
      <section>
        <h3>AI DSL</h3>
        <p class="muted" style="font-size:12px;">
          Try queries like:
          <br /><code>module:payments risk>=9 last:7d</code>
          <br /><code>status:open severity>=3</code>
        </p>
      </section>
    </aside>

    <!-- Main content -->
    <section class="content">
      <!-- View tabs -->
      <div class="view-tabs" role="tablist" aria-label="Views">
        <button
          id="issuesTab"
          type="button"
          class="view-tab active"
          data-view="issues"
          role="tab"
          aria-selected="true"
        >
          <span class="icon">üìã</span>
          Issues
        </button>
        <button
          id="calendarTab"
          type="button"
          class="view-tab"
          data-view="calendar"
          role="tab"
          aria-selected="false"
        >
          <span class="icon">üìÖ</span>
          Calendar
        </button>
        <button
          id="insightsTab"
          type="button"
          class="view-tab"
          data-view="insights"
          role="tab"
          aria-selected="false"
        >
          <span class="icon">ü§ñ</span>
          AI & Ops
        </button>
      </div>

      <!-- Issues view -->
      <div
        id="issuesView"
        class="view active"
        role="tabpanel"
        aria-labelledby="issuesTab"
      >
        <div class="card">
          <div class="summary-bar">
            <div>
              <div id="issuesSummaryText" class="muted">
                Loading‚Ä¶
              </div>
              <div id="aiAnalyzing" class="muted" style="display:none;font-size:11px;">
                AI analyzing patterns‚Ä¶
              </div>
            </div>
            <div>
              <label class="muted" for="pageSize" style="font-size:11px;">
                Rows per page
              </label>
              <select id="pageSize" class="select sm">
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
              </select>
            </div>
          </div>
        </div>

        <div id="kpis" class="grid cols-4"></div>

        <div class="grid cols-4">
          <div class="card">
            <h4 class="muted" style="margin-top:0;margin-bottom:6px;">By module</h4>
            <div style="height:220px;">
              <canvas id="byModule" aria-label="Issues by module"></canvas>
            </div>
          </div>
          <div class="card">
            <h4 class="muted" style="margin-top:0;margin-bottom:6px;">By priority</h4>
            <div style="height:220px;">
              <canvas id="byPriority" aria-label="Issues by priority"></canvas>
            </div>
          </div>
          <div class="card">
            <h4 class="muted" style="margin-top:0;margin-bottom:6px;">By status</h4>
            <div style="height:220px;">
              <canvas id="byStatus" aria-label="Issues by status"></canvas>
            </div>
          </div>
          <div class="card">
            <h4 class="muted" style="margin-top:0;margin-bottom:6px;">By type</h4>
            <div style="height:220px;">
              <canvas id="byType" aria-label="Issues by type"></canvas>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="summary-bar" style="margin-bottom:8px;">
            <div class="muted" style="font-size:12px;">Issues table</div>
            <div id="rowCount" class="shortcut-chip"></div>
          </div>
          <div class="table-wrap">
            <table id="issuesTable" aria-label="Issues">
              <thead>
                <tr>
                  <th
                    scope="col"
                    class="sortable"
                    data-key="id"
                  >
                    ID
                  </th>
                  <th
                    scope="col"
                    class="sortable"
                    data-key="module"
                  >
                    Module
                  </th>
                  <th
                    scope="col"
                    class="sortable"
                    data-key="title"
                  >
                    Title
                  </th>
                  <th
                    scope="col"
                    class="sortable"
                    data-key="priority"
                  >
                    Priority
                  </th>
                  <th
                    scope="col"
                    class="sortable"
                    data-key="status"
                  >
                    Status
                  </th>
                  <th
                    scope="col"
                    class="sortable"
                    data-key="date"
                  >
                    Date
                  </th>
                  <th scope="col">Log</th>
                  <th scope="col">Link</th>
                </tr>
              </thead>
              <tbody id="tbodySkeleton">
                <tr>
                  <td colspan="8">
                    <div class="skeleton" style="height:40px;"></div>
                  </td>
                </tr>
                <tr>
                  <td colspan="8">
                    <div class="skeleton" style="height:40px;"></div>
                  </td>
                </tr>
                <tr>
                  <td colspan="8">
                    <div class="skeleton" style="height:40px;"></div>
                  </td>
                </tr>
              </tbody>
              <tbody id="issuesTbody"></tbody>
            </table>
          </div>

          <div class="table-actions">
            <div class="pagination">
              <button
                id="firstPage"
                type="button"
                class="chip-btn"
                aria-label="First page"
              >
                ¬´
              </button>
              <button
                id="prevPage"
                type="button"
                class="chip-btn"
                aria-label="Previous page"
              >
                ‚Äπ
              </button>
              <span id="pageInfo" class="shortcut-chip">Page 1 / 1</span>
              <button
                id="nextPage"
                type="button"
                class="chip-btn"
                aria-label="Next page"
              >
                ‚Ä∫
              </button>
              <button
                id="lastPage"
                type="button"
                class="chip-btn"
                aria-label="Last page"
              >
                ¬ª
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Calendar view -->
      <div
        id="calendarView"
        class="view"
        role="tabpanel"
        aria-labelledby="calendarTab"
      >
        <div class="card">
          <div class="summary-bar">
            <div>
              <span class="muted" style="font-size:12px;">Change calendar</span>
              <div id="calendarTz" class="muted" style="font-size:11px;"></div>
            </div>
            <div style="display:flex;gap:6px;align-items:center;flex-wrap:wrap;">
              <label class="chip-btn" style="display:flex;align-items:center;gap:4px;">
                <input
                  id="eventFilterDeployment"
                  type="checkbox"
                  checked
                />
                Deployments
              </label>
              <label class="chip-btn" style="display:flex;align-items:center;gap:4px;">
                <input
                  id="eventFilterMaintenance"
                  type="checkbox"
                  checked
                />
                Maintenance
              </label>
              <label class="chip-btn" style="display:flex;align-items:center;gap:4px;">
                <input
                  id="eventFilterRelease"
                  type="checkbox"
                  checked
                />
                Releases
              </label>
              <label class="chip-btn" style="display:flex;align-items:center;gap:4px;">
                <input
                  id="eventFilterOther"
                  type="checkbox"
                  checked
                />
                Other
              </label>

              <button id="addEventBtn" type="button" class="btn sm">
                <span class="icon">Ôºã</span>
                Add event
              </button>
            </div>
          </div>

          <div id="calendar"></div>
        </div>
      </div>

      <!-- Insights / AI view -->
      <div
        id="insightsView"
        class="view"
        role="tabpanel"
        aria-labelledby="insightsTab"
      >
        <div class="grid cols-4">
          <div class="card">
            <h4 style="margin-top:0;">Scope & signals</h4>
            <p id="aiScopeText" class="muted" style="font-size:13px;">
              Waiting for data‚Ä¶
            </p>
            <p id="aiSignalsText" class="muted" style="font-size:13px;"></p>
          </div>
          <div class="card">
            <h4 style="margin-top:0;">Recurring terms</h4>
            <ul id="aiPatternsList" class="muted" style="padding-left:18px;font-size:13px;">
              <li>Loading‚Ä¶</li>
            </ul>
          </div>
          <div class="card">
            <h4 style="margin-top:0;">Suggested categories</h4>
            <ul id="aiLabelsList" class="muted" style="padding-left:18px;font-size:13px;">
              <li>Loading‚Ä¶</li>
            </ul>
          </div>
          <div class="card">
            <h4 style="margin-top:0;">Top risk signals</h4>
            <ul id="aiRisksList" class="muted" style="padding-left:18px;font-size:13px;">
              <li>Loading‚Ä¶</li>
            </ul>
          </div>
        </div>

        <div class="grid cols-4">
          <div class="card">
            <h4 style="margin-top:0;">Trends (upwards)</h4>
            <ul id="aiTrendsList" class="muted" style="padding-left:18px;font-size:13px;">
              <li>Loading‚Ä¶</li>
            </ul>
          </div>

          <div class="card">
            <h4 style="margin-top:0;">Emerging vs stable</h4>
            <ul id="aiEmergingStable" class="muted" style="padding-left:18px;font-size:13px;">
              <li>Loading‚Ä¶</li>
            </ul>
          </div>

          <div class="card">
            <h4 style="margin-top:0;">Ops cockpit</h4>
            <ul id="aiOpsCockpit" class="muted" style="padding-left:18px;font-size:13px;">
              <li>Loading‚Ä¶</li>
            </ul>
          </div>

          <div class="card">
            <h4 style="margin-top:0;">Incident-like issues</h4>
            <ul id="aiIncidentsList" class="muted" style="padding-left:18px;font-size:13px;">
              <li>Loading‚Ä¶</li>
            </ul>
          </div>
        </div>

        <!-- Module risk table -->
        <div class="card" id="aiModulesCard">
          <h4 style="margin-top:0;margin-bottom:6px;">Module risk snapshot</h4>
          <div class="table-wrap">
            <table aria-label="Module risk">
              <thead>
                <tr>
                  <th>Module</th>
                  <th>Open</th>
                  <th>High</th>
                  <th>Risk sum</th>
                  <th>Top term</th>
                </tr>
              </thead>
              <tbody id="aiModulesTableBody">
                <tr>
                  <td colspan="5" style="text-align:center;color:var(--muted);">
                    Loading‚Ä¶
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Clusters & triage -->
        <div class="grid cols-4">
          <div class="card">
            <h4 style="margin-top:0;">Similar issue clusters</h4>
            <div id="aiClusters" class="muted" style="font-size:13px;">
              Loading‚Ä¶
            </div>
          </div>

          <div class="card">
            <h4 style="margin-top:0;">Triage queue (metadata gaps)</h4>
            <ul id="aiTriageList" class="muted" style="padding-left:18px;font-size:13px;">
              <li>Loading‚Ä¶</li>
            </ul>
          </div>

          <div class="card">
            <h4 style="margin-top:0;">Upcoming risky events</h4>
            <ul id="aiEventsList" class="muted" style="padding-left:18px;font-size:13px;">
              <li>Loading‚Ä¶</li>
            </ul>
          </div>

          <!-- F&B Release Planner (MENA) -->
          <div class="card" id="fnbReleasePlannerCard">
            <h4 style="margin-top:0;">F&amp;B Release Planner (MENA)</h4>
            <p class="muted" style="font-size:12px;margin-bottom:6px;">
              Uses restaurant rush windows, weekends &amp; holiday signals
              plus historic incident ‚Äúbug bombs‚Äù to suggest release slots.
            </p>

            <div class="fnb-controls">
              <div class="filter-row">
                <label class="muted" for="fnbModuleSelect">Module / domain</label>
                <select id="fnbModuleSelect" class="select">
                  <option>All F&B</option>
                </select>
              </div>
              <div class="filter-row">
                <label class="muted" for="fnbDateInput">Start day</label>
                <input
                  id="fnbDateInput"
                  type="date"
                  class="input"
                />
              </div>
              <div class="filter-row">
                <label class="muted" for="fnbDurationInput">Duration (min)</label>
                <input
                  id="fnbDurationInput"
                  type="number"
                  min="5"
                  max="240"
                  step="5"
                  class="input"
                  value="30"
                />
              </div>
              <div class="filter-row">
                <label class="muted" style="visibility:hidden;">&nbsp;</label>
                <button id="fnbSuggestBtn" type="button" class="btn sm">
                  Suggest windows
                </button>
              </div>
            </div>

            <ul id="fnbSlotsList" class="fnb-slots-list">
              <li class="fnb-slot-row">
                <span class="muted">Planner will populate once issues are loaded.</span>
              </li>
            </ul>
          </div>
        </div>

        <!-- DSL query runner -->
        <div class="card">
          <div class="summary-bar">
            <div>
              <h4 style="margin-top:0;margin-bottom:4px;">AI query (DSL)</h4>
              <p class="muted" style="font-size:11px;margin:0;">
                Examples:
                <code>status:open risk>=9 last:7d</code>,
                <code>module:payments severity>=3</code>.
              </p>
            </div>
            <div style="display:flex;gap:6px;flex-wrap:wrap;align-items:center;">
              <button
                id="aiQueryApplyFilters"
                type="button"
                class="btn ghost sm"
              >
                Apply to Issues view
              </button>
              <button
                id="aiQueryExport"
                type="button"
                class="btn ghost sm"
              >
                Export results
              </button>
            </div>
          </div>

          <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;">
            <input
              id="aiQueryInput"
              class="input"
              type="text"
              placeholder="Type DSL query (Ctrl+K)‚Ä¶"
              style="flex:1;min-width:220px;"
            />
            <button id="aiQueryRun" type="button" class="btn sm">
              Run
            </button>
          </div>

          <div
            id="aiQueryResults"
            class="muted"
            style="margin-top:10px;font-size:13px;"
          >
            Type a query with keywords and filters like <code>module:</code>,
            <code>status:</code>, <code>risk>=9</code>.
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Spinner overlay -->
  <div id="spinner" class="spinner" aria-hidden="true">
    <div class="ring"></div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Issue modal -->
  <div
    id="issueModal"
    class="modal"
    role="dialog"
    aria-modal="true"
    aria-labelledby="modalTitle"
    style="display:none;"
  >
    <div class="modal-content">
      <div class="header">
        <h2 id="modalTitle" style="margin:0;font-size:16px;"></h2>
        <button
          id="modalClose"
          type="button"
          class="modal-close"
          aria-label="Close"
        >
          √ó
        </button>
      </div>
      <div id="modalBody" style="font-size:14px;"></div>
      <div class="actions" style="margin-top:10px;">
        <button id="copyId" type="button" class="btn sm">
          Copy ID
        </button>
        <button id="copyLink" type="button" class="btn ghost sm">
          Copy link
        </button>
      </div>
    </div>
  </div>

  <!-- Event modal -->
  <div
    id="eventModal"
    class="modal"
    role="dialog"
    aria-modal="true"
    aria-labelledby="eventModalTitle"
    style="display:none;"
  >
    <div class="modal-content">
      <div class="header">
        <h2 id="eventModalTitle" style="margin:0;font-size:16px;">Add Event</h2>
        <button
          id="eventModalClose"
          type="button"
          class="modal-close"
          aria-label="Close"
        >
          √ó
        </button>
      </div>

      <form id="eventForm">
        <div class="grid" style="grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;">
          <div class="filter-row">
            <label class="muted" for="eventTitle">Title</label>
            <input id="eventTitle" class="input" type="text" required />
          </div>

          <div class="filter-row">
            <label class="muted" for="eventType">Type</label>
            <select id="eventType" class="select">
              <option value="Deployment">Deployment</option>
              <option value="Maintenance">Maintenance</option>
              <option value="Release">Release</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div class="filter-row">
            <label class="muted" for="eventEnv">Environment</label>
            <select id="eventEnv" class="select">
              <option value="Prod">Prod</option>
              <option value="Staging">Staging</option>
              <option value="Dev">Dev</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div class="filter-row">
            <label class="muted" for="eventStatus">Change status</label>
            <select id="eventStatus" class="select">
              <option value="Planned">Planned</option>
              <option value="In progress">In progress</option>
              <option value="Completed">Completed</option>
              <option value="Cancelled">Cancelled</option>
            </select>
          </div>

          <div class="filter-row">
            <label class="muted" for="eventOwner">Owner</label>
            <input id="eventOwner" class="input" type="text" />
          </div>

          <div class="filter-row">
            <label class="muted" for="eventModules">Modules</label>
            <input
              id="eventModules"
              class="input"
              type="text"
              placeholder="Comma-separated"
            />
          </div>

          <div class="filter-row">
            <label class="muted" for="eventImpactType">Impact</label>
            <select id="eventImpactType" class="select">
              <option>No downtime expected</option>
              <option>Short read-only window</option>
              <option>Partial downtime</option>
              <option>Full downtime</option>
            </select>
          </div>

          <div class="filter-row">
            <label class="muted" for="eventIssueId">Linked issue ID</label>
            <input
              id="eventIssueId"
              class="input"
              type="text"
              placeholder="e.g. INC-123"
            />
          </div>
        </div>

        <div class="divider"></div>

        <div class="grid" style="grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;">
          <div class="filter-row">
            <label class="muted" for="eventStart">Start</label>
            <input id="eventStart" class="input" type="datetime-local" required />
          </div>
          <div class="filter-row">
            <label class="muted" for="eventEnd">End</label>
            <input id="eventEnd" class="input" type="datetime-local" />
          </div>
          <div class="filter-row" style="grid-column:1 / -1;">
            <label class="muted" for="eventAllDay">
              <input
                id="eventAllDay"
                type="checkbox"
                style="margin-right:6px;"
              />
              All-day event
            </label>
          </div>
        </div>

        <div class="filter-row" style="margin-top:8px;">
          <label class="muted" for="eventDescription">Description</label>
          <textarea
            id="eventDescription"
            class="input"
            rows="3"
            style="border-radius:12px;"
          ></textarea>
        </div>

        <div
          id="eventIssueLinkedInfo"
          class="muted"
          style="margin-top:8px;font-size:12px;display:none;"
        ></div>

        <div class="actions" style="margin-top:10px;">
          <button
            id="eventSave"
            type="submit"
            class="btn primary sm"
          >
            Save
          </button>
          <button
            id="eventCancel"
            type="button"
            class="btn ghost sm"
          >
            Cancel
          </button>
          <button
            id="eventDelete"
            type="button"
            class="btn ghost sm"
            style="margin-left:auto;display:none;"
          >
            Delete
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- External libraries -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js" defer></script>

  <!-- App logic -->
  <script src="app.js" defer></script>
</body>
</html>
