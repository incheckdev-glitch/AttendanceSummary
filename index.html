<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>InCheck Pro Dashboard â€” Issues Â· Ops Â· AI Copilot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Your main CSS (the big :root / cards / table / planner styles you pasted) -->
  <link rel="stylesheet" href="styles.css" />

  <!-- FullCalendar CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css"
  />
</head>
<body>
  <!-- Header -->
  <header>
    <div class="brand">
      <div class="logo">IC</div>
      <div class="brand-text">
        <span>InCheck Pro</span>
        <span>Issues Â· Ops Â· AI Copilot</span>
      </div>
    </div>

    <button
      id="drawerBtn"
      class="btn sm drawer-toggle"
      type="button"
      aria-expanded="false"
      aria-controls="sidebar"
    >
      <span class="icon">â˜°</span>
      Filters
    </button>

    <div class="toolbar">
      <div class="statusline">
        <span id="syncIssuesDot" class="dot ok"></span>
        <span id="syncIssuesText" class="shortcut-chip">Issues: never</span>
        <span id="syncEventsDot" class="dot ok"></span>
        <span id="syncEventsText" class="shortcut-chip">Events: never</span>
        <span id="loadingStatus" class="shortcut-chip"></span>
      </div>

      <span id="onlineStatusChip" class="chip online">Online</span>

      <select id="themeSelect" class="select sm" aria-label="Theme">
        <option value="system">System</option>
        <option value="dark">Dark</option>
        <option value="light">Light</option>
      </select>

      <input
        type="color"
        id="accentColor"
        aria-label="Accent color"
      />

      <button id="shortcutsHelp" class="btn sm ghost" type="button">
        ?
      </button>
    </div>
  </header>

  <main class="wrap">
    <!-- Sidebar: filters & actions -->
    <aside id="sidebar" class="sidebar" aria-label="Filters">
      <h3>Search</h3>
      <div class="filter-group">
        <div class="filter-row">
          <input
            id="searchInput"
            class="input"
            type="search"
            placeholder="Search issues (/)"
          />
        </div>
      </div>

      <h3>Date range</h3>
      <div class="filter-group">
        <div class="filter-row">
          <span class="muted">From</span>
          <input id="startDateFilter" class="input" type="date" />
        </div>
        <div class="filter-row">
          <span class="muted">To</span>
          <input id="endDateFilter" class="input" type="date" />
        </div>
      </div>

      <div class="divider"></div>

      <h3>Filters</h3>
      <div class="filter-group">
        <div class="filter-row">
          <span class="muted">Module</span>
          <select id="moduleFilter" class="select"></select>
        </div>
        <div class="filter-row">
          <span class="muted">Priority</span>
          <select id="priorityFilter" class="select"></select>
        </div>
        <div class="filter-row">
          <span class="muted">Status</span>
          <select id="statusFilter" class="select"></select>
        </div>

        <!-- âœ… NEW: Category filter (wired to r.type in JS) -->
        <div class="filter-row">
          <span class="muted">Category</span>
          <select id="categoryFilter" class="select">
            <option>All</option>
          </select>
        </div>

        <div
          class="filter-row"
          style="margin-top:6px;display:flex;gap:6px;flex-wrap:wrap;"
        >
          <button id="resetBtn" class="btn sm ghost" type="button">
            Reset
          </button>
          <button id="refreshNow" class="btn sm" type="button">
            Refresh
          </button>
        </div>
      </div>

      <div class="divider"></div>

      <h3>Export &amp; create</h3>
      <div class="filter-group">
        <div
          class="filter-row"
          style="display:flex;gap:6px;flex-wrap:wrap;"
        >
          <button id="exportCsv" class="btn sm" type="button">
            Export CSV
          </button>
          <button id="createTicketBtn" class="btn sm ghost" type="button">
            New ticket
          </button>
        </div>
      </div>
    </aside>

    <!-- Main content -->
    <section class="content">
      <!-- Tabs -->
      <div class="view-tabs" role="tablist">
        <button
          id="issuesTab"
          class="view-tab active"
          data-view="issues"
          role="tab"
          aria-selected="true"
        >
          <span class="icon">ðŸ“‹</span>
          Issues
        </button>
        <button
          id="calendarTab"
          class="view-tab"
          data-view="calendar"
          role="tab"
          aria-selected="false"
        >
          <span class="icon">ðŸ“…</span>
          Calendar
        </button>
        <button
          id="insightsTab"
          class="view-tab"
          data-view="insights"
          role="tab"
          aria-selected="false"
        >
          <span class="icon">ðŸ§ </span>
          AI Insights
        </button>
      </div>

      <!-- Issues view -->
      <div
        id="issuesView"
        class="view active"
        role="tabpanel"
        aria-labelledby="issuesTab"
      >
        <div class="grid cols-4">
          <!-- Summary & active filters -->
          <div class="card" style="grid-column:1 / -1;">
            <div class="summary-bar">
              <div>
                <div class="label">Issues summary</div>
                <div id="issuesSummaryText" class="muted">
                  Loadingâ€¦
                </div>
              </div>
              <div class="table-actions" style="margin-top:0;">
                <div
                  id="activeFiltersChips"
                  class="filter-chips"
                ></div>
                <div
                  style="display:flex;align-items:center;gap:6px;"
                >
                  <span class="muted">Rows</span>
                  <select
                    id="pageSize"
                    class="select sm"
                    aria-label="Rows per page"
                  >
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- KPIs card (clickable) -->
          <div class="card" style="grid-column:1 / -1;">
            <div id="kpis" class="grid cols-4"></div>
          </div>

          <!-- Charts -->
          <div class="card" style="grid-column:1 / -1;">
            <div class="charts">
              <div style="height:220px;">
                <canvas id="byModule"></canvas>
              </div>
              <div style="height:220px;">
                <canvas id="byPriority"></canvas>
              </div>
            </div>
            <div style="height:220px;margin-top:14px;">
              <canvas id="byStatus"></canvas>
            </div>
            <div style="height:220px;margin-top:14px;">
              <canvas id="byType"></canvas>
            </div>
          </div>

          <!-- Issues table -->
          <div class="card" style="grid-column:1 / -1;">
            <div class="summary-bar">
              <div>Issues table</div>
              <div class="table-actions">
                <span id="rowCount" class="muted"></span>
                <div class="pagination">
                  <button
                    id="firstPage"
                    class="chip-btn"
                    type="button"
                  >
                    Â«
                  </button>
                  <button
                    id="prevPage"
                    class="chip-btn"
                    type="button"
                  >
                    â€¹
                  </button>
                  <span id="pageInfo" class="muted"></span>
                  <button
                    id="nextPage"
                    class="chip-btn"
                    type="button"
                  >
                    â€º
                  </button>
                  <button
                    id="lastPage"
                    class="chip-btn"
                    type="button"
                  >
                    Â»
                  </button>
                </div>
              </div>
            </div>

            <div class="table-wrap">
              <table id="issuesTable">
                <thead>
                  <tr>
                    <th
                      class="sortable"
                      data-key="id"
                    >
                      ID
                    </th>
                    <th
                      class="sortable"
                      data-key="module"
                    >
                      Module
                    </th>
                    <th
                      class="sortable"
                      data-key="title"
                    >
                      Title
                    </th>
                    <th
                      class="sortable"
                      data-key="priority"
                    >
                      Priority
                    </th>
                    <th
                      class="sortable"
                      data-key="status"
                    >
                      Status
                    </th>
                    <th
                      class="sortable"
                      data-key="date"
                    >
                      Date
                    </th>
                    <th>Log</th>
                    <th>Link</th>
                  </tr>
                </thead>
                <!-- Loading skeleton -->
                <tbody id="tbodySkeleton">
                  <tr>
                    <td colspan="8">
                      <div
                        class="skeleton"
                        style="height:24px;"
                      ></div>
                    </td>
                  </tr>
                  <tr>
                    <td colspan="8">
                      <div
                        class="skeleton"
                        style="height:24px;"
                      ></div>
                    </td>
                  </tr>
                  <tr>
                    <td colspan="8">
                      <div
                        class="skeleton"
                        style="height:24px;"
                      ></div>
                    </td>
                  </tr>
                </tbody>
                <tbody id="issuesTbody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Calendar view -->
      <div
        id="calendarView"
        class="view"
        role="tabpanel"
        aria-labelledby="calendarTab"
      >
        <div class="card">
          <div class="summary-bar">
            <div>
              <div>Release &amp; change calendar</div>
              <div id="calendarTz" class="muted"></div>
            </div>
            <div class="table-actions">
              <div class="filter-chips">
                <label class="filter-chip">
                  <input
                    type="checkbox"
                    id="eventFilterDeployment"
                    checked
                  />
                  Deployments
                </label>
                <label class="filter-chip">
                  <input
                    type="checkbox"
                    id="eventFilterMaintenance"
                    checked
                  />
                  Maintenance
                </label>
                <label class="filter-chip">
                  <input
                    type="checkbox"
                    id="eventFilterRelease"
                    checked
                  />
                  Releases
                </label>
                <label class="filter-chip">
                  <input
                    type="checkbox"
                    id="eventFilterOther"
                    checked
                  />
                  Other
                </label>
              </div>
              <button
                id="addEventBtn"
                class="btn sm"
                type="button"
              >
                Add event
              </button>
            </div>
          </div>
          <div id="calendar"></div>
        </div>
      </div>

      <!-- Insights view -->
      <div
        id="insightsView"
        class="view"
        role="tabpanel"
        aria-labelledby="insightsTab"
      >
        <div class="grid cols-4">
          <!-- AI query -->
          <div class="card" style="grid-column:1 / -1;">
            <div class="summary-bar">
              <div>
                <div>AI Query</div>
                <div id="aiScopeText" class="muted"></div>
                <div id="aiSignalsText" class="muted"></div>
              </div>
              <div
                style="display:flex;gap:6px;flex-wrap:wrap;"
              >
                <input
                  id="aiQueryInput"
                  class="input sm"
                  type="text"
                  placeholder="status:open priority:h risk&gt;=10 last:7d"
                  style="min-width:260px;"
                />
                <button
                  id="aiQueryRun"
                  class="btn sm"
                  type="button"
                >
                  Run
                </button>
                <button
                  id="aiQueryApplyFilters"
                  class="btn sm ghost"
                  type="button"
                >
                  Apply to filters
                </button>
                <button
                  id="aiQueryExport"
                  class="btn sm ghost"
                  type="button"
                >
                  Export
                </button>
              </div>
            </div>
            <div
              id="aiQueryResults"
              style="margin-top:8px;font-size:13px;"
            ></div>
          </div>

          <!-- AI side cards -->
          <div class="card">
            <h3>Patterns</h3>
            <ul
              id="aiPatternsList"
              class="muted"
              style="font-size:13px;margin:6px 0 0 18px;"
            ></ul>
          </div>

          <div class="card">
            <h3>Categories</h3>
            <ul
              id="aiLabelsList"
              class="muted"
              style="font-size:13px;margin:6px 0 0 18px;"
            ></ul>
          </div>

          <div class="card">
            <h3>Trends</h3>
            <ul
              id="aiTrendsList"
              class="muted"
              style="font-size:13px;margin:6px 0 0 18px;"
            ></ul>
          </div>

          <div class="card">
            <h3>Emerging vs stable</h3>
            <ul
              id="aiEmergingStable"
              class="muted"
              style="font-size:13px;margin:6px 0 0 18px;"
            ></ul>
          </div>

          <!-- Module risk table -->
          <div class="card" style="grid-column:1 / -1;">
            <div class="summary-bar">
              <div>Per-module risk</div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Module</th>
                  <th>Open</th>
                  <th>High</th>
                  <th>Risk</th>
                  <th>Top term</th>
                </tr>
              </thead>
              <tbody id="aiModulesTableBody"></tbody>
            </table>
          </div>

          <div class="card">
            <h3>Top risks</h3>
            <ul
              id="aiRisksList"
              class="muted"
              style="font-size:13px;margin:6px 0 0 18px;"
            ></ul>
          </div>

          <div class="card">
            <h3>Incidents</h3>
            <ul
              id="aiIncidentsList"
              class="muted"
              style="font-size:13px;margin:6px 0 0 18px;"
            ></ul>
          </div>

          <div class="card">
            <h3>Ops cockpit</h3>
            <ul
              id="aiOpsCockpit"
              class="muted"
              style="font-size:13px;margin:6px 0 0 18px;"
            ></ul>
          </div>

          <div class="card">
            <h3>Clusters</h3>
            <div id="aiClusters"></div>
          </div>

          <div class="card" style="grid-column:1 / -1;">
            <h3>AI triage queue</h3>
            <ul
              id="aiTriageList"
              class="muted"
              style="font-size:13px;margin:6px 0 0 18px;"
            ></ul>
          </div>

          <div class="card" style="grid-column:1 / -1;">
            <h3>Upcoming risky events</h3>
            <ul
              id="aiEventsList"
              class="muted"
              style="font-size:13px;margin:6px 0 0 18px;"
            ></ul>
          </div>

          <!-- Release Planner card -->
          <div
            class="card"
            id="releasePlannerCard"
            style="grid-column:1 / -1;"
          >
            <div class="summary-bar">
              <div>Release Planner â€“ F&amp;B Middle East</div>
            </div>

            <div class="planner-grid">
              <div>
                <label for="plannerRegion">Region profile</label>
                <select id="plannerRegion" class="select">
                  <option value="gulf">Gulf (KSA / UAE / Qatar)</option>
                  <option value="levant">Levant</option>
                  <option value="northafrica">North Africa</option>
                </select>
              </div>

              <div>
                <label for="plannerEnv">Environment</label>
                <select id="plannerEnv" class="select">
                  <option>Prod</option>
                  <option>Staging</option>
                  <option>Dev</option>
                  <option>Other</option>
                </select>
              </div>

              <div>
                <label for="plannerModules">Modules</label>
                <input
                  id="plannerModules"
                  class="input"
                  placeholder="e.g. Payments, Orders"
                />
              </div>

              <div>
                <label for="plannerHorizon">Horizon (days)</label>
                <input
                  id="plannerHorizon"
                  class="input"
                  type="number"
                  min="1"
                  max="30"
                  value="7"
                />
              </div>

              <div>
                <label for="plannerReleaseType">Release type</label>
                <select id="plannerReleaseType" class="select">
                  <option value="feature">Feature</option>
                  <option value="minor">Minor patch</option>
                  <option value="major">Major</option>
                </select>
              </div>

              <div>
                <label for="plannerSlotsPerDay">Slots per day</label>
                <input
                  id="plannerSlotsPerDay"
                  class="input"
                  type="number"
                  min="1"
                  max="8"
                  value="4"
                />
              </div>

              <div>
                <label for="plannerDescription">Release description</label>
                <textarea
                  id="plannerDescription"
                  class="input"
                  placeholder="Scope, risk notes, etc."
                ></textarea>
              </div>

              <div>
                <label for="plannerTickets">Tickets in scope</label>
                <select
                  id="plannerTickets"
                  class="select"
                  multiple
                  size="6"
                ></select>
              </div>

              <div>
                <label for="plannerReleasePlan">Release plan event</label>
                <select id="plannerReleasePlan" class="select"></select>
                <div
                  style="margin-top:6px;display:flex;gap:6px;flex-wrap:wrap;"
                >
                  <button
                    id="plannerAssignBtn"
                    class="btn sm"
                    type="button"
                  >
                    Assign tickets
                  </button>
                  <button
                    id="plannerRun"
                    class="btn sm"
                    type="button"
                  >
                    Run planner
                  </button>
                  <button
                    id="plannerAddEvent"
                    class="btn sm ghost"
                    type="button"
                  >
                    Add top slot as event
                  </button>
                </div>
              </div>
            </div>

            <div id="plannerResults" style="margin-top:10px;"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Spinner -->
  <div id="spinner" class="spinner">
    <div class="ring"></div>
  </div>

  <!-- Toast & AI analyzing indicator -->
  <div id="toast" class="toast"></div>
  <div
    id="aiAnalyzing"
    class="toast"
    style="top:80px;bottom:auto;display:none;"
  >
    Analyzingâ€¦
  </div>

  <!-- Issue modal -->
  <div id="issueModal" class="modal" aria-hidden="true">
    <div
      class="modal-content"
      role="dialog"
      aria-modal="true"
      aria-labelledby="modalTitle"
    >
      <div class="header">
        <h2 id="modalTitle"></h2>
        <button
          id="modalClose"
          class="modal-close"
          type="button"
          aria-label="Close"
        >
          Ã—
        </button>
      </div>
      <div id="modalBody"></div>
      <div class="actions" style="margin-top:10px;">
        <button id="copyId" class="btn sm" type="button">
          Copy ID
        </button>
        <button id="copyLink" class="btn sm ghost" type="button">
          Copy link
        </button>
      </div>
    </div>
  </div>

  <!-- Event modal -->
  <div id="eventModal" class="modal" aria-hidden="true">
    <div
      class="modal-content"
      role="dialog"
      aria-modal="true"
      aria-labelledby="eventModalTitle"
    >
      <div class="header">
        <h2 id="eventModalTitle"></h2>
        <button
          id="eventModalClose"
          class="modal-close"
          type="button"
          aria-label="Close"
        >
          Ã—
        </button>
      </div>

      <form id="eventForm">
        <div
          class="grid"
          style="grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;"
        >
          <div>
            <span class="muted">Title</span>
            <input id="eventTitle" class="input" required />
          </div>

          <div>
            <span class="muted">Type</span>
            <select id="eventType" class="select">
              <option>Deployment</option>
              <option>Maintenance</option>
              <option>Release</option>
              <option>Other</option>
            </select>
          </div>

          <div>
            <span class="muted">Environment</span>
            <select id="eventEnv" class="select">
              <option>Prod</option>
              <option>Staging</option>
              <option>Dev</option>
              <option>Other</option>
            </select>
          </div>

          <div>
            <span class="muted">Change status</span>
            <select id="eventStatus" class="select">
              <option>Planned</option>
              <option>In progress</option>
              <option>Completed</option>
              <option>Cancelled</option>
            </select>
          </div>

          <div>
            <span class="muted">Owner</span>
            <input id="eventOwner" class="input" />
          </div>

          <div>
            <span class="muted">Modules</span>
            <input
              id="eventModules"
              class="input"
              placeholder="Comma-separated"
            />
          </div>

          <div>
            <span class="muted">Impact</span>
            <input
              id="eventImpactType"
              class="input"
              placeholder="No downtime expected"
            />
          </div>

          <div>
            <span class="muted">Linked ticket IDs</span>
            <input
              id="eventIssueId"
              class="input"
              placeholder="e.g. INC-123, INC-456"
            />
          </div>

          <div>
            <span class="muted">Start</span>
            <input
              id="eventStart"
              class="input"
              type="datetime-local"
            />
          </div>

          <div>
            <span class="muted">End</span>
            <input
              id="eventEnd"
              class="input"
              type="datetime-local"
            />
          </div>

          <div style="grid-column:1 / -1;">
            <span class="muted">Description</span>
            <textarea
              id="eventDescription"
              class="input"
              style="min-height:80px;"
            ></textarea>
          </div>

          <div style="grid-column:1 / -1;">
            <label class="muted">
              <input type="checkbox" id="eventAllDay" />
              All-day event
            </label>
          </div>

          <div
            id="eventIssueLinkedInfo"
            class="muted"
            style="grid-column:1 / -1;display:none;"
          ></div>
        </div>

        <div
          class="actions"
          style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;"
        >
          <button
            id="eventSave"
            class="btn primary sm"
            type="submit"
          >
            Save
          </button>
          <button
            id="eventCancel"
            class="btn ghost sm"
            type="button"
          >
            Cancel
          </button>
          <button
            id="eventDelete"
            class="btn sm"
            type="button"
          >
            Delete
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Vendor libs (needed by your app.js) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

  <!-- Your big JS file (the one you pasted with CONFIG/DataStore/Risk/DSL/Planner/etc)
       Make sure you've applied the "category" changes there as we discussed. -->
  <script src="app.js"></script>
</body>
</html>
